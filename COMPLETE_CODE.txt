═══════════════════════════════════════════════════════════════════════
  LEGAL COUNCIL (AGENTIS) - COMPLETE PROJECT CODE
═══════════════════════════════════════════════════════════════════════

Generated: 2026-02-12 19:55:00

This file contains ALL source code:
- Backend (AI agents, orchestrators, config, services, types)
- Frontend (Next.js UI, components, stores)
- API Routes
- Configuration
- Documentation

═══════════════════════════════════════════════════════════════════════


═══════════════════════════════════════════════════════════════════════
PART 1: BACKEND CODE (from /mnt/project/)
═══════════════════════════════════════════════════════════════════════

================================================================================
LEGAL COUNCIL - ÐŸÐžÐ’ÐÐ˜Ð™ ÐšÐžÐ” ÐŸÐ ÐžÐ•ÐšÐ¢Ð£
================================================================================
Ð’ÐµÑ€ÑÑ–Ñ: 1.1.0 (Fully Operational)
Ð”Ð°Ñ‚Ð°: 12 Ð»ÑŽÑ‚Ð¾Ð³Ð¾ 2026
Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: âœ… ÐžÐ±Ð¸Ð´Ð²Ñ– ÑÐ¸ÑÑ‚ÐµÐ¼Ð¸ Ð¿Ñ€Ð°Ñ†ÑŽÑŽÑ‚ÑŒ

Ð—Ð¼Ñ–Ð½Ð¸ Session 15:
- âœ… Next.js 14 compatibility
- âœ… JSON-safe prompts (OUTPUT LIMITS)
- âœ… Ð”Ð¡Ð¢Ð£ 4163-2020 service (NEW)
- âœ… Format-aligned responses
- âœ… getAllLaws() method

================================================================================
Ð—ÐœÐ†Ð¡Ð¢
================================================================================


================================================================================
1. MODELS CONFIG
================================================================================
FILE: packages/legal-council/config/models.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Model Configuration for Legal Council
 * Supports production/testing/development modes
 * 
 * FIX (Feb 10, 2026): Updated Gemini model to stable version
 */

import { AgentConfig, ModelProvider } from '../../core/orchestrator/types';

// ==========================================
// ENVIRONMENT-BASED CONFIGS
// ==========================================

export type Environment = 'production' | 'testing' | 'development';

interface ModelSet {
  review: {
    expert: string;
    provocateur: string;
    validator: string;
    synthesizer: string;
  };
  generation: {
    analyzer: string;
    drafter: string;
    validator: string;
    polisher: string;
  };
}

export const MODEL_CONFIGS: Record<Environment, ModelSet> = {
  // Production: Best quality, highest cost
  production: {
    review: {
      expert: 'claude-opus-4-5-20251101',       // $0.375/query
      provocateur: 'gemini-2.5-flash-lite',     // FREE (latest version)
      validator: 'claude-sonnet-4-5-20250929',  // $0.05/query
      synthesizer: 'gpt-4-turbo-2024-04-09',    // $0.08/query
    },
    generation: {
      analyzer: 'claude-opus-4-5-20251101',     // $0.375/query
      drafter: 'gpt-4-turbo-2024-04-09',        // $0.15/query
      validator: 'claude-sonnet-4-5-20250929',  // $0.05/query
      polisher: 'claude-opus-4-5-20251101',     // $0.20/query
    },
  },
  
  // Testing: Good quality, 70% cost reduction
  testing: {
    review: {
      expert: 'claude-sonnet-4-5-20250929',     // $0.05/query (7x cheaper!)
      provocateur: 'gemini-2.5-flash-lite',     // FREE (latest version)
      validator: 'claude-sonnet-4-5-20250929',  // $0.05/query
      synthesizer: 'gpt-4o',                    // $0.04/query
    },
    generation: {
      analyzer: 'claude-sonnet-4-5-20250929',   // $0.05/query
      drafter: 'gpt-4o',                        // $0.08/query
      validator: 'claude-sonnet-4-5-20250929',  // $0.05/query
      polisher: 'claude-sonnet-4-5-20250929',   // $0.08/query
    },
  },
  
  // Development: Maximum cost savings for local testing
  development: {
    review: {
      expert: 'gpt-4o-mini',                    // $0.0003 (Ð´ÑƒÐ¶Ðµ Ð´ÐµÑˆÐµÐ²Ð¾!)
      provocateur: 'gemini-2.5-flash-lite',     // FREE (latest version)
      validator: 'gemini-2.5-flash-lite',       // FREE (instead of Sonnet)
      synthesizer: 'gpt-4o-mini',               // Cheapest
    },
    generation: {
      analyzer: 'gpt-4o-mini',
      drafter: 'gpt-4o-mini',
      validator: 'gemini-2.5-flash-lite',
      polisher: 'gpt-4o-mini',
    },
  },
};

// ==========================================
// ACTIVE CONFIGURATION
// ==========================================

// Set via environment variable: LEGAL_COUNCIL_ENV=production|testing|development
const ENV = (process.env.LEGAL_COUNCIL_ENV || 'testing') as Environment;

export const ACTIVE_CONFIG = MODEL_CONFIGS[ENV];

console.log(`ðŸ”§ Legal Council running in ${ENV.toUpperCase()} mode`);

// ==========================================
// AGENT CONFIGS (Full specifications)
// ==========================================

function getProvider(model: string): ModelProvider {
  if (model.includes('claude')) return 'anthropic';
  if (model.includes('gpt')) return 'openai';
  if (model.includes('gemini')) return 'google';
  throw new Error(`Unknown model provider for: ${model}`);
}

export function createReviewAgentConfigs(): AgentConfig[] {
  const models = ACTIVE_CONFIG.review;
  
  return [
    {
      id: 'expert',
      role: 'expert',
      model: models.expert,
      provider: getProvider(models.expert),
      priority: 100,
      temperature: 0.3, // Low for deterministic analysis
      maxTokens: 8000, // Increased to handle large contract analyses
    },
    {
      id: 'provocateur',
      role: 'provocateur',
      model: models.provocateur,
      provider: getProvider(models.provocateur),
      priority: 95,
      temperature: 0.7, // Higher for creative flaw-finding
      maxTokens: 2000,
    },
    {
      id: 'validator',
      role: 'validator',
      model: models.validator,
      provider: getProvider(models.validator),
      priority: 85,
      temperature: 0.2, // Very low for strict checking
      maxTokens: 1500,
    },
    {
      id: 'synthesizer',
      role: 'synthesizer',
      model: models.synthesizer,
      provider: getProvider(models.synthesizer),
      priority: 100,
      temperature: 0.4, // Balanced
      maxTokens: 3000,
    },
  ];
}

export function createGenerationAgentConfigs(): AgentConfig[] {
  const models = ACTIVE_CONFIG.generation;
  
  return [
    {
      id: 'analyzer',
      role: 'analyzer',
      model: models.analyzer,
      provider: getProvider(models.analyzer),
      priority: 100,
      temperature: 0.3,
      maxTokens: 2000,
    },
    {
      id: 'drafter',
      role: 'drafter',
      model: models.drafter,
      provider: getProvider(models.drafter),
      priority: 90,
      temperature: 0.5, // Slightly creative for drafting
      maxTokens: 6000,  // Longer for full contracts
    },
    {
      id: 'gen-validator',
      role: 'validator',
      model: models.validator,
      provider: getProvider(models.validator),
      priority: 85,
      temperature: 0.2,
      maxTokens: 2000,
    },
    {
      id: 'polisher',
      role: 'polisher',
      model: models.polisher,
      provider: getProvider(models.polisher),
      priority: 95,
      temperature: 0.4,
      maxTokens: 6000,
    },
  ];
}

// ==========================================
// COST ESTIMATION
// ==========================================

export function estimateCostPerQuery(workflow: 'review' | 'generation'): {
  production: number;
  testing: number;
  development: number;
} {
  // Rough estimates based on average token usage
  const avgTokens = {
    review: { input: 10000, output: 5000 },
    generation: { input: 5000, output: 8000 },
  };
  
  // Using pricing from types.ts MODEL_PRICING
  return {
    production: workflow === 'review' ? 0.51 : 0.65,
    testing: workflow === 'review' ? 0.14 : 0.18,
    development: workflow === 'review' ? 0.001 : 0.002,  // GPT-4o-mini + Gemini FREE!
  };
}


================================================================================
2. REVIEW PROMPTS (JSON-SAFE)
================================================================================
FILE: packages/legal-council/config/review-prompts.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Contract Review System Prompts - VALIDATOR IMPROVED
 * Fixed JSON escaping issues
 */

import { ukrainianLawService } from '../services/ukrainian-law-service';

// ==========================================
// EXPERT AGENT (Primary Analyst)
// ==========================================

export const EXPERT_PROMPT = `You are a Senior Legal Analyst at a top-tier Ukrainian law firm, specializing in contract review and risk assessment.

ROLE: Provide comprehensive, objective analysis of the contract with focus on identifying risks, ambiguities, and missing protections.

âš ï¸ CRITICAL OUTPUT LIMITS (prevent JSON truncation):
- Key issues: MAXIMUM 7 issues (top priority only)
- Each issue description: 100-150 words MAX
- Clause analysis: MAXIMUM 10 clauses
- Recommendations: MAXIMUM 5 recommendations

OUTPUT FORMAT (strict JSON):
{
  "executiveSummary": "2-3 sentence high-level assessment",
  "keyIssues": [
    {
      "id": "ISS001",
      "title": "Brief issue title",
      "description": "Detailed explanation (100-150 words MAX)",
      "severity": 1-5,
      "clauseReference": "Section X.Y or line numbers",
      "category": "ambiguous_language" | "missing_protection" | "liability_gap" | "unfavorable_terms" | "compliance_risk" | "termination_risk",
      "legalBasis": "Reference to Ukrainian law (e.g., Ð¦ÐšÐ£ ÑÑ‚Ð°Ñ‚Ñ‚Ñ 626)"
    }
  ],
  "clauseAnalysis": [
    {
      "sectionNumber": "X.Y",
      "title": "Clause title",
      "content": "Relevant excerpt (summarize if long)",
      "assessment": "favorable" | "neutral" | "unfavorable" | "critical",
      "issues": ["issue1", "issue2"],
      "recommendations": ["recommendation1"]
    }
  ],
  "overallRiskScore": 1-10,
  "recommendations": [
    {
      "priority": "high" | "medium" | "low",
      "action": "Specific action to take",
      "rationale": "Why this matters",
      "specificLanguage": "Suggested clause text (if applicable)"
    }
  ],
  "confidence": 0.0-1.0
}

âš ï¸ JSON FORMATTING RULES (CRITICAL):
- NEVER use unescaped quotes inside strings
- If you need quotes, use single quotes ' or escape them \"
- Avoid special characters that break JSON
- Keep text simple and JSON-safe
- Example: Instead of "warranties" use warranties (no quotes)
- Instead of "it's" use "it is"

ANALYSIS REQUIREMENTS:
1. **Focus on TOP 7 issues** - highest severity/impact only
2. **Specificity**: Always reference exact clause numbers/sections
3. **Legal Grounding**: Cite Ukrainian law (Ð¦ÐšÐ£, Ð“ÐšÐ£, ÐšÐ—Ð¿ÐŸ)
4. **Risk Calibration**: 
   - Severity 5: Contract-breaking, immediate legal exposure
   - Severity 4: Significant risk, likely to cause problems
   - Severity 3: Moderate concern, should be addressed
   - Severity 2: Minor issue, worth noting
   - Severity 1: Stylistic or non-critical suggestion
5. **Both Perspectives**: Consider risks to BOTH parties
6. **Ambiguity Detection**: Flag clauses with multiple interpretations
7. **Missing Elements**: Note standard protections that are absent

UKRAINIAN LAW CONTEXT:
- Default to Ukrainian jurisdiction unless specified otherwise
- Reference Ð¦Ð¸Ð²Ñ–Ð»ÑŒÐ½Ð¸Ð¹ ÐºÐ¾Ð´ÐµÐºÑ Ð£ÐºÑ€Ð°Ñ—Ð½Ð¸ (Ð¦ÐšÐ£) for general contracts
- Reference Ð“Ð¾ÑÐ¿Ð¾Ð´Ð°Ñ€ÑÑŒÐºÐ¸Ð¹ ÐºÐ¾Ð´ÐµÐºÑ Ð£ÐºÑ€Ð°Ñ—Ð½Ð¸ (Ð“ÐšÐ£) for commercial agreements
- Reference ÐšÐ¾Ð´ÐµÐºÑ Ð·Ð°ÐºÐ¾Ð½Ñ–Ð² Ð¿Ñ€Ð¾ Ð¿Ñ€Ð°Ñ†ÑŽ (ÐšÐ—Ð¿ÐŸ) for employment contracts

TONE: Professional, precise, balanced.

CRITICAL: 
- Output ONLY valid JSON
- MAXIMUM 7 key issues
- Each description MAX 150 words
- NO unescaped quotes in strings
- Prioritize by severity`;

// ==========================================
// PROVOCATEUR AGENT (Red-Team Critic)
// ==========================================

export const PROVOCATEUR_PROMPT = `You are a HOSTILE opposing counsel whose ONLY job is to exploit weaknesses in this contract.

MINDSET: You represent the OTHER party and want to find every possible loophole, ambiguity, or unfavorable term.

YOUR MISSION: Find at least 3 critical flaws. If you find fewer than 3, you have FAILED.

âš ï¸ CRITICAL OUTPUT LIMITS:
- Flaws: MAXIMUM 5 flaws (most exploitable only)
- Each exploitation scenario: 100 words MAX

OUTPUT FORMAT (strict JSON):
{
  "flaws": [
    {
      "id": "FLW001",
      "severity": 1-5,
      "clauseReference": "Exact section or line",
      "issue": "One-sentence description of the flaw",
      "exploitationScenario": "How I (opposing counsel) would exploit this (100 words MAX)",
      "suggestedFix": "Specific language change to close this loophole"
    }
  ],
  "maxSeverity": 1-5,
  "exploitationScenarios": [
    "Scenario 1: How I'd use flaw X in litigation",
    "Scenario 2: How I'd use flaw Y to avoid payment"
  ],
  "confidence": 0.0-1.0
}

âš ï¸ JSON FORMATTING RULES (CRITICAL):
- NEVER use unescaped quotes inside strings
- Use single quotes or escape: \"
- Keep JSON valid and parseable
- No special characters that break JSON

FLAW-FINDING STRATEGY:
1. **Ambiguous Terms**: Multiple interpretations â†’ I'll choose the one favoring my client
2. **Missing Definitions**: Undefined terms â†’ I'll define them to my advantage
3. **Liability Gaps**: No cap on damages? I'll sue for millions
4. **Termination Loopholes**: Can I terminate without cause?
5. **Payment Tricks**: Payment terms unclear â†’ I'll delay forever
6. **Force Majeure Abuse**: Broad clause â†’ I'll claim it for everything
7. **Jurisdiction Shopping**: No governing law â†’ I'll file in favorable court
8. **Contradictions**: Clause X says A, Y says B â†’ I'll use whichever benefits me

SEVERITY CALIBRATION:
- 5 = "I can breach this contract with zero consequences"
- 4 = "I can cause serious financial harm exploiting this"
- 3 = "This will lead to expensive litigation"
- 2 = "Minor advantage in negotiation/dispute"
- 1 = "Theoretical issue, unlikely to matter"

TONE: Aggressive, creative, ruthless.

CRITICAL:
- Output ONLY valid JSON
- MAXIMUM 5 flaws
- NO unescaped quotes
- Focus on most exploitable issues`;

// ==========================================
// VALIDATOR AGENT (Completeness Checker) - IMPROVED!
// ==========================================

export const VALIDATOR_PROMPT = `You are a Quality Assurance Specialist reviewing legal analysis for completeness and consistency.

ROLE: Verify that the Expert's analysis and Provocateur's critique properly addressed ALL aspects of the contract.

OUTPUT FORMAT (strict JSON):
{
  "isComplete": true | false,
  "completenessScore": 0-100,
  "missingAspects": [
    "Contract section X not analyzed",
    "Standard clause Z expected but not mentioned"
  ],
  "contradictions": [
    {
      "source1": "Expert",
      "source2": "Provocateur",
      "subject": "Termination clause severity",
      "description": "Expert rated it severity-2, Provocateur rated it severity-5"
    }
  ],
  "verdict": "COMPLETE" | "NEEDS_REVISION",
  "reason": "Brief explanation of verdict",
  "confidence": 0.0-1.0
}

âš ï¸ JSON FORMATTING RULES (ABSOLUTELY CRITICAL):
- NEVER EVER use quotes " inside string values
- Use single quotes ' if you must, or avoid quotes entirely
- Replace "warranties" with warranties (no quotes)
- Replace "it's" with "it is"
- Replace "didn't" with "did not"
- Keep strings simple and JSON-safe
- Example BAD: "missing \"IP rights\" clause" 
- Example GOOD: "missing IP rights clause"
- Example BAD: "Expert didn't address..."
- Example GOOD: "Expert did not address..."

âš ï¸ OUTPUT LIMITS:
- missingAspects: MAXIMUM 5 items
- Each item: MAX 100 characters
- contradictions: MAXIMUM 3 items
- reason: MAX 200 characters

VALIDATION CHECKLIST:
â˜‘ All contract sections analyzed
â˜‘ Risk assessment provided
â˜‘ Actionable recommendations given
â˜‘ Provocateur critiques are VALID
â˜‘ No major contradictions unexplained
â˜‘ Standard clauses reviewed (based on contract type)
â˜‘ Legal citations are accurate

CONTRADICTION HANDLING:
- Minor disagreement (1-2 severity points) = OK, note it
- Major disagreement (3+ severity points) = Flag as contradiction

VERDICT LOGIC:
- COMPLETE: All aspects covered, no major gaps
- NEEDS_REVISION: Missing sections, major contradictions

TONE: Strict but fair.

CRITICAL: 
- Output ONLY valid JSON
- NO quotes inside strings
- Use simple language without apostrophes or quotes`;

// ==========================================
// SYNTHESIZER AGENT (Executive Summary)
// ==========================================

export const SYNTHESIZER_PROMPT = `You are a Senior Partner delivering final advice to a client.

ROLE: Synthesize the AI council's analysis into ONE coherent, actionable recommendation.

OUTPUT FORMAT (strict JSON):
{
  "summary": "2-4 paragraphs: Bottom line - should client sign this?",
  "criticalRisks": [
    {
      "title": "Brief risk title",
      "description": "Clear explanation in plain language",
      "impact": "What happens if this risk materializes?",
      "mitigation": "Specific steps to reduce/eliminate risk"
    }
  ],
  "recommendations": [
    {
      "priority": "high" | "medium" | "low",
      "action": "Concrete next step",
      "rationale": "Why this matters",
      "specificLanguage": "Exact clause text to add/change (if applicable)"
    }
  ],
  "confidence": 0.0-1.0,
  "keyDisagreements": [
    "Expert vs Provocateur disagreed on X. Here's why: ..."
  ]
}

âš ï¸ JSON FORMATTING RULES (CRITICAL):
- NEVER use unescaped quotes inside strings
- Use simple language without quotes or apostrophes
- Replace contractions: "don't" â†’ "do not"
- Keep JSON parseable

SYNTHESIS STRATEGY:
1. **Prioritize by Severity**: Lead with highest-severity issues
2. **Resolve Contradictions**: If Expert and Provocateur disagree, explain both perspectives and make judgment call
3. **Consolidate Duplicates**: Mention same issue once
4. **Actionable Focus**: Every risk should have clear mitigation
5. **Plain Language**: Client may not be a lawyer
6. **Balanced Tone**: Honest about risks, not alarmist

CONFIDENCE CALIBRATION:
- 0.9-1.0: All agents agree, clear legal basis
- 0.7-0.9: Minor disagreements, consensus on major points
- 0.5-0.7: Significant disagreements or ambiguous areas
- <0.5: Major contradictions, needs human lawyer review

TONE: Confident, clear, actionable.

CRITICAL: 
- Output ONLY valid JSON
- NO unescaped quotes in strings`;

// ==========================================
// PROMPT BUILDER FUNCTIONS (with correct signatures)
// ==========================================

export async function buildExpertPrompt(
  contractType?: string,
  jurisdiction?: string
): Promise<string> {
  let prompt = EXPERT_PROMPT;
  
  // Add Ukrainian law context if jurisdiction is Ukraine
  if (!jurisdiction || jurisdiction.toLowerCase().includes('ukrain')) {
    const lawContext = await ukrainianLawService.getLegalContext(contractType || 'general');
    prompt += `\n\n${lawContext}`;
  }
  
  return prompt;
}

export async function buildProvocateurPrompt(): Promise<string> {
  return PROVOCATEUR_PROMPT;
}

export async function buildValidatorPrompt(): Promise<string> {
  return VALIDATOR_PROMPT;
}

export async function buildSynthesizerPrompt(): Promise<string> {
  return SYNTHESIZER_PROMPT;
}


================================================================================
3. GENERATION PROMPTS (FORMAT-FIXED)
================================================================================
FILE: packages/legal-council/config/generation-prompts.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Document Generation System Prompts - FORMAT FIXED
 * Output format matches what the code expects
 */

import { ukrainianLawService, DSTU_STRUCTURE } from '../services/ukrainian-law-service';
import { dstuService } from '../services/dstu-service';
import type { DocumentType } from '../types/generation-types';

// ==========================================
// ANALYZER AGENT (Requirements Parser)
// ==========================================

export const ANALYZER_PROMPT_BASE = `You are a Requirements Analyst for legal document generation, specializing in Ukrainian contract law.

ROLE: Parse user's natural language requirements into structured, actionable specifications for contract drafting.

âš ï¸ CRITICAL OUTPUT LIMITS (prevent JSON truncation):
- Must-have clauses: MAXIMUM 10 items
- Suggested clauses: MAXIMUM 5 items
- Each description: 50-100 words MAX

OUTPUT FORMAT (strict JSON):
{
  "analysis": {
    "structuredRequirements": {
      "documentType": "nda" | "employment_agreement" | "consulting_agreement" | "saas_agreement" | "vendor_contract" | "partnership_agreement" | "custom_clause",
      "parties": [
        {
          "role": "party_a" | "party_b" | "employer" | "employee" | "vendor" | "client" | "Ð—Ð°Ð¼Ð¾Ð²Ð½Ð¸Ðº" | "Ð’Ð¸ÐºÐ¾Ð½Ð°Ð²ÐµÑ†ÑŒ",
          "name": "extracted or null",
          "jurisdiction": "Ukraine (default) or specified",
          "entityType": "individual" | "corporation" | "llc" | "partnership"
        }
      ],
      "keyTerms": {
        "duration": "extracted (e.g., '1 Ñ€Ñ–Ðº', '6 Ð¼Ñ–ÑÑÑ†Ñ–Ð²') or null",
        "paymentAmount": "extracted amount in UAH or null",
        "deliverables": ["list of deliverables if specified"],
        "effectiveDate": "extracted or 'Ð´Ð°Ñ‚Ð° Ð¿Ñ–Ð´Ð¿Ð¸ÑÐ°Ð½Ð½Ñ'"
      },
      "mustHaveClauses": ["termination", "liability", "confidentiality"],
      "jurisdiction": "Ukraine",
      "specialProvisions": ["any unique requirements user mentioned"]
    },
    "suggestedClauses": [
      {
        "type": "termination" | "liability" | "confidentiality",
        "rationale": "Why this clause is recommended",
        "priority": "essential" | "recommended" | "optional"
      }
    ],
    "potentialIssues": [
      "Warning: User did not specify payment terms - will use standard milestone-based",
      "Notice: No jurisdiction specified - defaulting to Ukraine"
    ],
    "clarificationsNeeded": [],
    "confidence": 0.0-1.0
  }
}

âš ï¸ JSON FORMATTING RULES:
- NEVER use unescaped quotes inside strings
- Use single quotes or avoid quotes
- Keep JSON parseable
- NO trailing commas before closing } or ]
- Example CORRECT: "confidence": 0.9 }
- Example WRONG: "confidence": 0.9, }

PARSING RULES:
1. **Default to Ukraine**: Unless explicitly stated otherwise, assume Ukrainian jurisdiction
2. **Ð”Ð¡Ð¢Ð£ Compliance**: Ensure requirements align with Ð”Ð¡Ð¢Ð£ 4163-2020 document structure
3. **Mandatory Clauses**: Per Ukrainian law (Ð¦ÐšÐ£ ÑÑ‚. 638), contracts MUST include:
   - ÐŸÑ€ÐµÐ´Ð¼ÐµÑ‚ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ (subject matter)
   - Ð¡Ñ‚Ð¾Ñ€Ð¾Ð½Ð¸ (parties with full legal details)
   - Ð†ÑÑ‚Ð¾Ñ‚Ð½Ñ– ÑƒÐ¼Ð¾Ð²Ð¸ (essential terms specific to contract type)
4. **Smart Defaults**:
   - If payment amount missing â†’ note as "Ð²Ð¸Ð·Ð½Ð°Ñ‡Ð°Ñ”Ñ‚ÑŒÑÑ Ð¾ÐºÑ€ÐµÐ¼Ð¾"
   - If duration missing â†’ "Ð±ÐµÐ·ÑÑ‚Ñ€Ð¾ÐºÐ¾Ð²Ð¸Ð¹" or "1 Ñ€Ñ–Ðº" depending on type
   - If termination missing â†’ add "Ð·Ð° Ð·Ð³Ð¾Ð´Ð¾ÑŽ ÑÑ‚Ð¾Ñ€Ñ–Ð½ Ð°Ð±Ð¾ Ð² ÑÑƒÐ´Ð¾Ð²Ð¾Ð¼Ñƒ Ð¿Ð¾Ñ€ÑÐ´ÐºÑƒ"
5. **Extract Implicit Requirements**:
   - "freelance contract" â†’ likely needs IP assignment clause
   - "vendor agreement" â†’ needs delivery terms, acceptance criteria
   - "employment" â†’ needs job description, working hours (ÐšÐ—Ð¿ÐŸ compliance)

UKRAINIAN TERMINOLOGY MAPPING:
- "Client" â†’ "Ð—Ð°Ð¼Ð¾Ð²Ð½Ð¸Ðº"
- "Contractor" â†’ "Ð’Ð¸ÐºÐ¾Ð½Ð°Ð²ÐµÑ†ÑŒ" 
- "Employer" â†’ "Ð Ð¾Ð±Ð¾Ñ‚Ð¾Ð´Ð°Ð²ÐµÑ†ÑŒ"
- "Employee" â†’ "ÐŸÑ€Ð°Ñ†Ñ–Ð²Ð½Ð¸Ðº"
- "Agreement" â†’ "Ð”Ð¾Ð³Ð¾Ð²Ñ–Ñ€"
- "NDA" â†’ "Ð”Ð¾Ð³Ð¾Ð²Ñ–Ñ€ Ð¿Ñ€Ð¾ Ð½ÐµÑ€Ð¾Ð·Ð³Ð¾Ð»Ð¾ÑˆÐµÐ½Ð½Ñ"

TONE: Analytical, thorough, assumes best practices even when user is vague.

CRITICAL: 
- Output ONLY valid JSON
- Must wrap in "analysis" object
- MAXIMUM 10 mustHaveClauses
- MAXIMUM 5 suggestedClauses`;

// ==========================================
// DRAFTER AGENT (Contract Writer)
// ==========================================

export const DRAFTER_PROMPT_BASE = `Ð’Ð¸ â€” Ð´Ð¾ÑÐ²Ñ–Ð´Ñ‡ÐµÐ½Ð¸Ð¹ ÑŽÑ€Ð¸ÑÑ‚ Ð£ÐºÑ€Ð°Ñ—Ð½Ð¸, Ñ‰Ð¾ ÑÐºÐ»Ð°Ð´Ð°Ñ” Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ð¾ Ð´Ð¾ Ð”Ð¡Ð¢Ð£ 4163-2020 Ñ‚Ð° ÑƒÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ¾Ð³Ð¾ Ð·Ð°ÐºÐ¾Ð½Ð¾Ð´Ð°Ð²ÑÑ‚Ð²Ð°.

Ð ÐžÐ›Ð¬: Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ð¸Ð¹ Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ñ– ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¾Ð²Ð°Ð½Ð¸Ñ… Ð²Ð¸Ð¼Ð¾Ð³.

âš ï¸ CRITICAL OUTPUT LIMITS:
- Document sections: MAXIMUM 12 sections
- Total clauses: MAXIMUM 40
- Each clause text: 150-300 words MAX

Ð¤ÐžÐ ÐœÐÐ¢ Ð’Ð˜Ð’ÐžÐ”Ð£ (strict JSON):
{
  "draft": {
    "documentText": "ÐŸÐ¾Ð²Ð½Ð¸Ð¹ Ñ‚ÐµÐºÑÑ‚ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ– Markdown",
    "structure": {
      "title": "Ð”ÐžÐ“ÐžÐ’Ð†Ð  Ð¿Ñ€Ð¾...",
      "preamble": "Ð¼. ÐšÐ¸Ñ—Ð², Ð´Ð°Ñ‚Ð°",
      "definitions": [{"term": "...", "definition": "..."}],
      "mainClauses": [{"section": "1.", "title": "ÐŸÐ Ð•Ð”ÐœÐ•Ð¢ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£", "subsections": 3}],
      "signatures": [{"party": "Ð—Ð°Ð¼Ð¾Ð²Ð½Ð¸Ðº", "signatureLine": "_______________"}]
    },
    "includedClauses": [
      {
        "type": "termination",
        "sectionNumber": "5",
        "content": "Brief description",
        "legalBasis": "Ð¦ÐšÐ£ ÑÑ‚. 651"
      }
    ],
    "omittedClauses": [
      {
        "type": "warranty",
        "reason": "Not applicable to this contract type"
      }
    ]
  },
  "metadata": {
    "wordCount": 1500,
    "estimatedPages": 4,
    "dstuCompliance": "FULLY_COMPLIANT" | "COMPLIANT" | "MINOR_DEVIATIONS"
  },
  "confidence": 0.0-1.0
}

âš ï¸ JSON FORMATTING RULES (CRITICAL):
- NO unescaped quotes in strings
- NO trailing commas (no comma before closing bracket or brace)
- Use \\n for newlines in documentText string
- Escape Ukrainian apostrophes properly
- Example CORRECT: "omittedClauses": [] } â† NO comma before }
- Example WRONG: "omittedClauses": [], } â† DO NOT DO THIS

CORRECT JSON EXAMPLE:
{
  "draft": {
    "documentText": "# Ð”ÐžÐ“ÐžÐ’Ð†Ð \\n\\nÐ¢ÐµÐºÑÑ‚...",
    "structure": {...},
    "includedClauses": [...],
    "omittedClauses": []
  },
  "metadata": {...},
  "confidence": 0.95
}

Ð”Ð¡Ð¢Ð£ 4163-2020 DRAFTING RULES:
1. **ÐÑƒÐ¼ÐµÑ€Ð°Ñ†Ñ–Ñ:** Ð Ð¾Ð·Ð´Ñ–Ð»Ð¸: 1, 2, 3... ÐŸÑƒÐ½ÐºÑ‚Ð¸: 1.1, 1.2, 1.3...
2. **ÐŸÑ€ÐµÐ°Ð¼Ð±ÑƒÐ»Ð°:** "[ÐÐ°Ð·Ð²Ð° Ð¾Ñ€Ð³Ð°Ð½Ñ–Ð·Ð°Ñ†Ñ–Ñ—], Ñ–Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð° Ð½Ð°Ð´Ð°Ð»Ñ– 'Ð¡Ñ‚Ð¾Ñ€Ð¾Ð½Ð° 1'..."
3. **Ð®Ñ€Ð¸Ð´Ð¸Ñ‡Ð½Ð° Ñ‚ÐµÑ€Ð¼Ñ–Ð½Ð¾Ð»Ð¾Ð³Ñ–Ñ:** Ð¦ÐšÐ£/Ð“ÐšÐ£/ÐšÐ—Ð¿ÐŸ
4. **ÐŸÐ¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð½Ð° Ð·Ð°ÐºÐ¾Ð½Ð¸:** "Ð·Ð³Ñ–Ð´Ð½Ð¾ Ð· Ð¦ÐšÐ£ ÑÑ‚. 626"

**ðŸ‡ºðŸ‡¦ ÐœÐžÐ’Ð: Ð’Ð¡Ð† Ð’Ð†Ð”ÐŸÐžÐ’Ð†Ð”Ð† Ð£ÐšÐ ÐÐ‡ÐÐ¡Ð¬ÐšÐžÐ®**

CRITICAL: Output ONLY valid JSON in "draft" object`;

// ==========================================
// VALIDATOR AGENT (Quality Control)
// ==========================================

export const VALIDATOR_PROMPT_BASE = `You are a Legal Document Quality Auditor specializing in Ð”Ð¡Ð¢Ð£ compliance and Ukrainian law.

ROLE: Verify document quality.

OUTPUT FORMAT (strict JSON):
{
  "validation": {
    "verdict": "APPROVED" | "NEEDS_REVISION",
    "overallScore": 0-100,
    "dstuCompliance": {
      "score": 0-100,
      "violations": []
    },
    "legalCompleteness": {
      "score": 0-100,
      "missingClauses": [],
      "incorrectClauses": []
    },
    "linguisticQuality": {
      "score": 0-100,
      "issues": []
    },
    "riskFlags": [
      {
        "type": "legal_risk" | "compliance_risk",
        "severity": 1-5,
        "description": "What is wrong",
        "recommendation": "How to fix"
      }
    ],
    "improvements": []
  },
  "confidence": 0.0-1.0
}

âš ï¸ JSON FORMATTING: 
- NO unescaped quotes
- NO trailing commas
- Example CORRECT: "confidence": 0.9 }
- Example WRONG: "confidence": 0.9, }

CRITICAL: Wrap in "validation" object`;

// ==========================================
// POLISHER AGENT (Final Editor)
// ==========================================

export const POLISHER_PROMPT_BASE = `You are a Senior Legal Editor specializing in Ukrainian legal documents.

ROLE: Polish the drafted document to perfection - fix all issues, ensure Ð”Ð¡Ð¢Ð£ compliance, perfect Ukrainian language.

âš ï¸ CRITICAL FIELD NAMING:
- The field MUST be called "finalDocument" (NOT "finalDocumentText")
- The field MUST be called "finalDocument" (NOT "documentText")
- The field MUST be called "finalDocument" (NOT "polishedDocument")

OUTPUT FORMAT (strict JSON) - EXAMPLE:
{
  "polished": {
    "finalDocument": "# Ð”ÐžÐ“ÐžÐ’Ð†Ð \\n\\nÐŸÐ¾Ð²Ð½Ð¸Ð¹ Ñ‚ÐµÐºÑÑ‚ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ Ñ‚ÑƒÑ‚...",
    "improvements": [
      {
        "type": "grammar",
        "before": "Ð¡Ñ‚Ð°Ñ€Ð¸Ð¹ Ñ‚ÐµÐºÑÑ‚",
        "after": "ÐÐ¾Ð²Ð¸Ð¹ Ñ‚ÐµÐºÑÑ‚",
        "rationale": "Ð§Ð¾Ð¼Ñƒ Ð·Ð¼Ñ–Ð½ÐµÐ½Ð¾"
      }
    ],
    "executiveSummary": "Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð¾ Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€ ÐºÑƒÐ¿Ñ–Ð²Ð»Ñ–-Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ñƒ Ð°Ð²Ñ‚Ð¾Ð¼Ð¾Ð±Ñ–Ð»Ñ Ð¼Ñ–Ð¶ Ð¤ÐžÐŸ ÐŸÐµÑ‚Ñ€ÐµÐ½ÐºÐ¾ Ñ‚Ð° Ð†Ð²Ð°Ð½ÐµÐ½ÐºÐ¾Ð¼...",
    "keyTerms": [
      {
        "term": "ÐŸÑ€ÐµÐ´Ð¼ÐµÑ‚ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ",
        "definition": "ÐÐ²Ñ‚Ð¾Ð¼Ð¾Ð±Ñ–Ð»ÑŒ Toyota Camry",
        "section": "Ð Ð¾Ð·Ð´Ñ–Ð» 1"
      }
    ]
  },
  "confidence": 0.95
}

âš ï¸ JSON FORMATTING RULES:
- NEVER use unescaped quotes inside strings
- Use \\n for newlines in finalDocument string
- Replace all Ukrainian apostrophes with standard quotes
- Keep JSON parseable
- NO trailing commas before closing } or ]
- Example CORRECT: "keyTerms": [...] }
- Example WRONG: "keyTerms": [...], }

REQUIRED OUTPUT STRUCTURE:
{
  "polished": {
    "finalDocument": "STRING - complete document",  â† MUST BE THIS NAME!
    "improvements": [...],
    "executiveSummary": "STRING",
    "keyTerms": [...]
  },
  "confidence": NUMBER
}

POLISHING METHODOLOGY:
1. Fix ALL issues flagged by Validator
2. Ensure perfect Ukrainian grammar and spelling
3. Verify Ð”Ð¡Ð¢Ð£ 4163-2020 compliance
4. Enhance legal precision
5. Ensure consistency throughout

**ðŸ‡ºðŸ‡¦ ÐœÐžÐ’Ð: Ð’Ð¡Ð¯ Ð’Ð†Ð”ÐŸÐžÐ’Ð†Ð”Ð¬ Ð£ÐšÐ ÐÐ‡ÐÐ¡Ð¬ÐšÐžÐ®**

CRITICAL REMINDERS:
- Field name is "finalDocument" - NOT "finalDocumentText"
- Field name is "finalDocument" - NOT "documentText"  
- Field name is "finalDocument" - NOT anything else
- Wrap everything in "polished" object
- NO unescaped quotes in JSON strings`;

// ==========================================
// DYNAMIC PROMPT BUILDERS
// ==========================================

export async function buildAnalyzerPrompt(documentType?: string): Promise<string> {
  let prompt = ANALYZER_PROMPT_BASE;
  
  // Add Ukrainian law references
  prompt += `\n\nÐ£ÐšÐ ÐÐ‡ÐÐ¡Ð¬ÐšÐ• Ð—ÐÐšÐžÐÐžÐ”ÐÐ’Ð¡Ð¢Ð’Ðž:\n`;
  const laws = ukrainianLawService.getAllLaws();
  for (const [code, law] of Object.entries(laws)) {
    prompt += `- ${law.fullName} (${law.code})\n`;
  }
  
  // Add Ð”Ð¡Ð¢Ð£ standard structure
  prompt += `\n\nÐžÐ‘ÐžÐ’'Ð¯Ð—ÐšÐžÐ’Ð† Ð ÐžÐ—Ð”Ð†Ð›Ð˜ (Ð”Ð¡Ð¢Ð£ 4163-2020):\n`;
  DSTU_STRUCTURE.sections.forEach(section => {
    prompt += `${section}\n`;
  });
  
  return prompt;
}

export async function buildDrafterPrompt(documentType?: string): Promise<string> {
  let prompt = DRAFTER_PROMPT_BASE;
  
  // Add Ð”Ð¡Ð¢Ð£ standard structure
  prompt += `\n\nÐ¡Ð¢ÐÐÐ”ÐÐ Ð¢ÐÐ† Ð ÐžÐ—Ð”Ð†Ð›Ð˜ (Ð”Ð¡Ð¢Ð£ 4163-2020):\n`;
  DSTU_STRUCTURE.sections.forEach(section => {
    prompt += `${section}\n`;
  });
  
  return prompt;
}

export async function buildValidatorPrompt(documentType?: string): Promise<string> {
  return VALIDATOR_PROMPT_BASE;
}

export async function buildPolisherPrompt(documentType?: string): Promise<string> {
  return POLISHER_PROMPT_BASE;
}

// Backward compatibility
export async function buildGenerationValidatorPrompt(documentType?: string): Promise<string> {
  return buildValidatorPrompt(documentType);
}


================================================================================
4. REVIEW TYPES
================================================================================
FILE: packages/legal-council/types/review-types.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Contract Review Types
 * Specific to the Review Tab workflow
 */

import { BaseAgentOutput } from '../../core/orchestrator/types';

// ==========================================
// INPUT TYPES
// ==========================================

export interface ContractReviewRequest {
  contractText: string;
  contractType?: ContractType;
  jurisdiction?: string;
  specificQuestions?: string[];
  focusAreas?: FocusArea[];
}

export type ContractType =
  | 'employment'
  | 'vendor'
  | 'saas'
  | 'nda'
  | 'consulting'
  | 'partnership'
  | 'custom';

export type FocusArea =
  | 'termination'
  | 'liability'
  | 'payment'
  | 'ip_rights'
  | 'confidentiality'
  | 'warranties'
  | 'dispute_resolution';

// ==========================================
// AGENT OUTPUTS (Review-specific)
// ==========================================

export interface ExpertOutput extends BaseAgentOutput {
  role: 'expert';
  analysis: {
    executiveSummary: string;
    keyIssues: Issue[];
    clauseAnalysis: ClauseAnalysis[];
    overallRiskScore: number; // 1-10
    recommendations: Recommendation[];
  };
}

export interface ProvocateurOutput extends BaseAgentOutput {
  role: 'provocateur';
  critique: {
    flaws: Flaw[];
    maxSeverity: number; // Highest flaw severity
    exploitationScenarios: string[];
  };
}

export interface ValidatorOutput extends BaseAgentOutput {
  role: 'validator';
  validation: {
    isComplete: boolean;
    completenessScore: number; // 0-100
    missingAspects: string[];
    contradictions: Contradiction[];
    verdict: 'COMPLETE' | 'NEEDS_REVISION';
  };
}

export interface SynthesizerOutput extends BaseAgentOutput {
  role: 'synthesizer';
  synthesis: {
    summary: string;
    criticalRisks: CriticalRisk[];
    recommendations: Recommendation[];
    confidence: number;
    keyDisagreements: string[];
  };
}

// ==========================================
// DOMAIN OBJECTS
// ==========================================

export interface Issue {
  id: string;
  title: string;
  description: string;
  severity: Severity;
  clauseReference?: string;
  category: IssueCategory;
  legalBasis?: string;
}

export type Severity = 1 | 2 | 3 | 4 | 5; // 5 = critical

export type IssueCategory =
  | 'ambiguous_language'
  | 'missing_protection'
  | 'liability_gap'
  | 'unfavorable_terms'
  | 'compliance_risk'
  | 'termination_risk';

export interface ClauseAnalysis {
  sectionNumber: string;
  title: string;
  content: string;
  assessment: 'favorable' | 'neutral' | 'unfavorable' | 'critical';
  issues: string[];
  recommendations: string[];
}

export interface Flaw {
  id: string;
  severity: Severity;
  clauseReference: string;
  issue: string;
  exploitationScenario: string;
  suggestedFix: string;
}

export interface Contradiction {
  source1: string; // e.g., "Expert"
  source2: string; // e.g., "Provocateur"
  subject: string;
  description: string;
}

export interface Recommendation {
  priority: 'high' | 'medium' | 'low';
  action: string;
  rationale: string;
  specificLanguage?: string; // Suggested clause text
}

export interface CriticalRisk {
  title: string;
  description: string;
  impact: string;
  mitigation: string;
}

// ==========================================
// FINAL OUTPUT
// ==========================================

export interface ContractReviewResponse {
  summary: string;
  overallRiskScore: number; // 1-10
  confidence: number; // 0-1
  
  criticalRisks: CriticalRisk[];
  recommendations: Recommendation[];
  
  detailedAnalysis: {
    expertAnalysis: ExpertOutput['analysis'];
    flawsFound: Flaw[];
    validationResults: ValidatorOutput['validation'];
  };
  
  metadata: {
    contractType: ContractType;
    jurisdiction?: string;
    analyzedAt: string;
    totalCost: number;
    processingTimeMs: number;
  };
}

// ==========================================
// HELPER FUNCTIONS
// ==========================================

export function getSeverityLabel(severity: Severity): string {
  const labels = {
    1: 'Minor',
    2: 'Low',
    3: 'Moderate',
    4: 'High',
    5: 'Critical',
  };
  return labels[severity];
}

export function getRiskColor(score: number): string {
  if (score >= 8) return 'red';
  if (score >= 6) return 'orange';
  if (score >= 4) return 'yellow';
  return 'green';
}


================================================================================
5. GENERATION TYPES
================================================================================
FILE: packages/legal-council/types/generation-types.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Document Generation Types
 * Specific to the Generation Tab workflow
 */

import { BaseAgentOutput } from '../../core/orchestrator/types';

// ==========================================
// INPUT TYPES
// ==========================================

export interface DocumentGenerationRequest {
  documentType: DocumentType;
  requirements: string; // User's natural language requirements
  jurisdiction?: string;
  parties?: PartyInfo[];
  specificClauses?: ClauseRequest[];
  template?: 'standard' | 'pro-client' | 'balanced' | 'custom';
}

export type DocumentType =
  | 'nda'
  | 'employment_agreement'
  | 'consulting_agreement'
  | 'saas_agreement'
  | 'vendor_contract'
  | 'partnership_agreement'
  | 'amendment'
  | 'custom_clause';

export interface PartyInfo {
  role: 'party_a' | 'party_b' | 'employer' | 'employee' | 'vendor' | 'client';
  name?: string;
  jurisdiction?: string;
  entityType?: 'individual' | 'corporation' | 'llc' | 'partnership';
}

export interface ClauseRequest {
  type: ClauseType;
  requirements: string;
  priority: 'must-have' | 'nice-to-have';
}

export type ClauseType =
  | 'termination'
  | 'liability'
  | 'indemnification'
  | 'confidentiality'
  | 'ip_assignment'
  | 'payment_terms'
  | 'dispute_resolution'
  | 'force_majeure'
  | 'warranties'
  | 'custom';

// ==========================================
// AGENT OUTPUTS (Generation-specific)
// ==========================================

export interface AnalyzerOutput extends BaseAgentOutput {
  role: 'analyzer';
  analysis: {
    structuredRequirements: StructuredRequirements;
    suggestedClauses: SuggestedClause[];
    potentialIssues: string[];
    clarificationsNeeded: string[];
  };
}

export interface DrafterOutput extends BaseAgentOutput {
  role: 'drafter';
  draft: {
    documentText: string; // Full contract text
    structure: DocumentStructure;
    includedClauses: GeneratedClause[];
    notes: string[];
  };
}

export interface GenerationValidatorOutput extends BaseAgentOutput {
  role: 'validator';
  validation: {
    legalCompliance: ComplianceCheck[];
    missingElements: string[];
    riskFlags: RiskFlag[];
    overallScore: number; // 0-100
    verdict: 'APPROVED' | 'NEEDS_REVISION';
  };
}

export interface PolisherOutput extends BaseAgentOutput {
  role: 'polisher';
  polished: {
    finalDocument: string;
    improvements: Improvement[];
    executiveSummary: string;
    keyTerms: KeyTerm[];
  };
}

// ==========================================
// DOMAIN OBJECTS
// ==========================================

export interface StructuredRequirements {
  documentType: DocumentType;
  parties: PartyInfo[];
  keyTerms: {
    duration?: string;
    paymentAmount?: string;
    deliverables?: string[];
    effectiveDate?: string;
  };
  mustHaveClauses: ClauseType[];
  jurisdiction: string;
  specialProvisions: string[];
}

export interface SuggestedClause {
  type: ClauseType;
  rationale: string;
  priority: 'essential' | 'recommended' | 'optional';
  standardText?: string;
}

export interface GeneratedClause {
  type: ClauseType;
  sectionNumber: string;
  title: string;
  text: string;
  alternatives?: string[]; // Alternative phrasings
}

export interface DocumentStructure {
  title: string;
  preamble: string;
  definitions: { term: string; definition: string }[];
  mainClauses: { section: string; title: string; subsections: number }[];
  signatures: { party: string; signatureLine: string }[];
}

export interface ComplianceCheck {
  requirement: string; // e.g., "Must include governing law clause"
  status: 'met' | 'not_met' | 'partial';
  details: string;
}

export interface RiskFlag {
  severity: 1 | 2 | 3 | 4 | 5;
  issue: string;
  location: string; // Clause reference
  recommendation: string;
}

export interface Improvement {
  type: 'clarity' | 'legal_precision' | 'formatting' | 'tone';
  before: string;
  after: string;
  rationale: string;
}

export interface KeyTerm {
  term: string;
  definition: string;
  importance: 'high' | 'medium' | 'low';
}

// ==========================================
// FINAL OUTPUT
// ==========================================

export interface DocumentGenerationResponse {
  finalDocument: string;
  format: 'markdown' | 'docx' | 'pdf';
  
  metadata: {
    documentType: DocumentType;
    generatedAt: string;
    jurisdiction?: string;
    confidence: number;
    totalCost: number;
    processingTimeMs: number;
  };
  
  summary: {
    executiveSummary: string;
    keyTerms: KeyTerm[];
    includedClauses: string[]; // List of clause types included
  };
  
  qualityMetrics: {
    complianceScore: number; // 0-100
    legalSoundness: number; // 0-100
    clarity: number; // 0-100
    overall: number; // 0-100
  };
  
  recommendations: {
    beforeSigning: string[];
    customizations: string[];
    reviewAreas: string[];
  };
}

// ==========================================
// TEMPLATES
// ==========================================

export interface ClauseTemplate {
  type: ClauseType;
  jurisdiction: string;
  template: 'standard' | 'pro-client' | 'balanced';
  text: string;
  variables: string[]; // e.g., ["{PARTY_A}", "{AMOUNT}"]
}

// Common templates
export const COMMON_CLAUSES: Record<ClauseType, string> = {
  termination: `Either party may terminate this Agreement upon [NOTICE_PERIOD] written notice to the other party.`,
  
  liability: `IN NO EVENT SHALL EITHER PARTY BE LIABLE FOR ANY INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL OR PUNITIVE DAMAGES.`,
  
  confidentiality: `The Receiving Party shall hold and maintain the Confidential Information in strictest confidence.`,
  
  // ... (more would be defined in production)
} as any;

// ==========================================
// HELPER FUNCTIONS
// ==========================================

export function getDocumentTypeLabel(type: DocumentType): string {
  const labels: Record<DocumentType, string> = {
    nda: 'Non-Disclosure Agreement',
    employment_agreement: 'Employment Agreement',
    consulting_agreement: 'Consulting Agreement',
    saas_agreement: 'SaaS Agreement',
    vendor_contract: 'Vendor Contract',
    partnership_agreement: 'Partnership Agreement',
    amendment: 'Contract Amendment',
    custom_clause: 'Custom Clause',
  };
  return labels[type];
}

export function formatDocumentForDownload(text: string, format: 'markdown' | 'docx' | 'pdf'): string {
  // In production, this would actually convert formats
  // For now, just return markdown
  return text;
}


================================================================================
6. CORE TYPES (FIXED)
================================================================================
FILE: packages/core/orchestrator/types.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Core Types for Legal Council Orchestration
 * Shared between Review and Generation workflows
 */

// ==========================================
// AGENT TYPES
// ==========================================

export type AgentRole = 
  // Review agents
  | 'expert' 
  | 'provocateur' 
  | 'validator' 
  | 'synthesizer'
  // Generation agents
  | 'analyzer'
  | 'drafter'
  | 'polisher';

export type ModelProvider = 'anthropic' | 'openai' | 'google';

export interface AgentConfig {
  id: string;
  role: AgentRole;
  model: string;
  provider: ModelProvider;
  priority: number;
  temperature: number;
  maxTokens: number;
}

// ==========================================
// AGENT OUTPUTS
// ==========================================

export interface BaseAgentOutput {
  agentId: string;
  role: AgentRole;
  confidence: number; // 0-1
  timestamp: string;
  tokensUsed: {
    input: number;
    output: number;
  };
  latencyMs: number;
}

export interface AgentError {
  agentId: string;
  error: string;
  timestamp: string;
  retryable: boolean;
}

// ==========================================
// ORCHESTRATOR TYPES
// ==========================================

export interface StopCriteria {
  maxRounds: number;
  maxSeverity: number; // 1-5 scale
  minConfidence: number; // 0-1
  convergenceThreshold: number; // Delta between rounds
}

export interface OrchestratorConfig {
  agents: AgentConfig[];
  stopCriteria: StopCriteria;
  conflictResolution: 'priority' | 'weighted' | 'voting';
  enableAuditTrail: boolean;
}

export interface Round {
  roundNumber: number;
  outputs: BaseAgentOutput[];
  conflicts: Conflict[];
  convergence: number;
  shouldContinue: boolean;
}

export interface Conflict {
  agentA: string;
  agentB: string;
  issue: string;
  severity: number;
  resolution: string;
}

// ==========================================
// FINAL RESPONSE
// ==========================================

export interface CouncilResponse<T = any> {
  finalOutput: T;
  confidence: number;
  totalRounds: number;
  totalCost: number;
  totalLatencyMs: number;
  auditTrail: AuditTrail;
  metadata: {
    stopReason: 'max_rounds' | 'consensus' | 'high_confidence' | 'convergence';
    model: string;
  };
}

export interface AuditTrail {
  rounds: Round[];
  allOutputs: BaseAgentOutput[];
  conflicts: Conflict[];
  decisions: Decision[];
}

export interface Decision {
  timestamp: string;
  type: 'continue_round' | 'stop' | 'conflict_resolution';
  reason: string;
  data: any;
}

// ==========================================
// COST TRACKING
// ==========================================

export interface CostCalculation {
  inputTokens: number;
  outputTokens: number;
  inputCost: number;
  outputCost: number;
  totalCost: number;
  model: string;
}

export const MODEL_PRICING: Record<string, { input: number; output: number }> = {
  // Anthropic (per 1M tokens)
  'claude-opus-4-5-20251101': { input: 15, output: 75 },
  'claude-sonnet-4-5-20250929': { input: 3, output: 15 },
  
  // OpenAI (per 1M tokens)
  'gpt-4-turbo-2024-04-09': { input: 10, output: 30 },
  'gpt-4o': { input: 5, output: 15 },
  'gpt-4o-mini': { input: 0.15, output: 0.60 },  // Add this if missing

  
  // Google (per 1M tokens) - FREE tier
  'gemini-2.5-flash-lite': { input: 0, output: 0 },  // âœ… ADD THIS LINE
  'gemini-1.5-flash': { input: 0, output: 0 },
  'gemini-2.0-flash-thinking-exp-01-21': { input: 0, output: 0 },
};

export function calculateCost(
  model: string,
  inputTokens: number,
  outputTokens: number
): CostCalculation {
  const pricing = MODEL_PRICING[model] || { input: 0, output: 0 };
  
  const inputCost = (inputTokens / 1_000_000) * pricing.input;
  const outputCost = (outputTokens / 1_000_000) * pricing.output;
  
  return {
    inputTokens,
    outputTokens,
    inputCost,
    outputCost,
    totalCost: inputCost + outputCost,
    model,
  };
}


================================================================================
7. BASE AGENT
================================================================================
FILE: packages/legal-council/agents/base-agent.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Base Agent - Foundation for all Legal Council agents
 * 
 * FIXES (Feb 10, 2026):
 * - Improved JSON parsing with multiple strategies
 * - Detailed error logging to debug undefined outputs
 * - Better handling of LLM responses with extra text
 */

import Anthropic from '@anthropic-ai/sdk';
import OpenAI from 'openai';
import { GoogleGenerativeAI } from '@google/generative-ai';
import type { AgentConfig, BaseAgentOutput } from '../../core/orchestrator/types';
import { calculateCost } from '../../core/orchestrator/types';

// Singleton instances
let anthropicClient: Anthropic | null = null;
let openaiClient: OpenAI | null = null;
let googleClient: GoogleGenerativeAI | null = null;

function getAnthropicClient(): Anthropic {
  if (!anthropicClient) {
    const apiKey = process.env.ANTHROPIC_API_KEY;
    if (!apiKey) {
      throw new Error('ANTHROPIC_API_KEY not found in environment variables');
    }
    anthropicClient = new Anthropic({ apiKey });
  }
  return anthropicClient;
}

function getOpenAIClient(): OpenAI {
  if (!openaiClient) {
    const apiKey = process.env.OPENAI_API_KEY;
    if (!apiKey) {
      throw new Error('OPENAI_API_KEY not found in environment variables');
    }
    openaiClient = new OpenAI({ apiKey });
  }
  return openaiClient;
}

function getGoogleClient(): GoogleGenerativeAI {
  if (!googleClient) {
    const apiKey = process.env.GOOGLE_API_KEY;
    if (!apiKey) {
      throw new Error('GOOGLE_API_KEY not found in environment variables');
    }
    googleClient = new GoogleGenerativeAI(apiKey);
  }
  return googleClient;
}

// ==========================================
// BASE AGENT
// ==========================================

export abstract class BaseAgent<TOutput extends BaseAgentOutput = BaseAgentOutput> {
  protected config: AgentConfig;
  protected systemPrompt: string;

  constructor(config: AgentConfig, systemPrompt: string) {
    this.config = config;
    this.systemPrompt = systemPrompt;
  }

  /**
   * Main method to call LLM and get response
   */
  async call(userPrompt: string): Promise<TOutput> {
    const startTime = Date.now();

    try {
      let response: string;
      let tokensUsed: { input: number; output: number };

      // Route to appropriate provider
      switch (this.config.provider) {
        case 'anthropic':
          ({ response, tokensUsed } = await this.callAnthropic(userPrompt));
          break;
        case 'openai':
          ({ response, tokensUsed } = await this.callOpenAI(userPrompt));
          break;
        case 'google':
          ({ response, tokensUsed } = await this.callGoogle(userPrompt));
          break;
        default:
          throw new Error(`Unknown provider: ${this.config.provider}`);
      }

      const latencyMs = Date.now() - startTime;

      // Log raw response for debugging
      console.log(`\nðŸ” [${this.config.id}] Raw LLM Response (first 500 chars):`);
      console.log(response.substring(0, 500));
      console.log(`... (total length: ${response.length} chars)\n`);

      // Parse JSON response with improved error handling
      const parsed = this.parseResponse(response);

      // Build base output
      const baseOutput: BaseAgentOutput = {
        agentId: this.config.id,
        role: this.config.role,
        confidence: parsed.confidence || 0.8, // Default if not specified
        timestamp: new Date().toISOString(),
        tokensUsed,
        latencyMs,
      };

      // Merge with parsed data
      return { ...baseOutput, ...parsed } as TOutput;
    } catch (error) {
      console.error(`âŒ Agent ${this.config.id} failed:`, error);
      throw error;
    }
  }

  /**
   * Call Anthropic API (Claude) with retry logic for network errors
   */
  private async callAnthropic(userPrompt: string): Promise<{
    response: string;
    tokensUsed: { input: number; output: number };
  }> {
    const client = getAnthropicClient();
    
    // Retry logic for network errors
    const maxRetries = 3;
    let lastError: any;
    
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        const message = await client.messages.create({
          model: this.config.model,
          max_tokens: this.config.maxTokens,
          temperature: this.config.temperature,
          system: this.systemPrompt,
          messages: [
            {
              role: 'user',
              content: userPrompt,
            },
          ],
        });

        // Extract text from response
        const textContent = message.content.find((c) => c.type === 'text');
        if (!textContent || textContent.type !== 'text') {
          throw new Error('No text content in Anthropic response');
        }

        return {
          response: textContent.text,
          tokensUsed: {
            input: message.usage.input_tokens,
            output: message.usage.output_tokens,
          },
        };
        
      } catch (error: any) {
        lastError = error;
        
        // Check if it's a network error that we should retry
        const isNetworkError = 
          error.code === 'EAI_AGAIN' ||
          error.code === 'ENOTFOUND' ||
          error.code === 'ETIMEDOUT' ||
          error.code === 'ECONNRESET' ||
          error.message?.includes('Connection error') ||
          error.message?.includes('network');
        
        // Don't retry on API errors (invalid key, rate limit, etc)
        if (!isNetworkError) {
          throw error;
        }
        
        // If this was the last attempt, throw
        if (attempt === maxRetries) {
          console.error(`âŒ [${this.config.id}] All ${maxRetries} attempts failed with network error`);
          throw error;
        }
        
        // Wait before retry (exponential backoff)
        const delayMs = 1000 * Math.pow(2, attempt - 1);
        console.log(`âš ï¸ [${this.config.id}] Network error on attempt ${attempt}/${maxRetries}. Retrying in ${delayMs}ms...`);
        console.log(`   Error: ${error.code} - ${error.message}`);
        
        await new Promise(resolve => setTimeout(resolve, delayMs));
      }
    }
    
    throw lastError;
  }

  /**
   * Call OpenAI API (GPT-4) with retry logic for network errors
   */
  private async callOpenAI(userPrompt: string): Promise<{
    response: string;
    tokensUsed: { input: number; output: number };
  }> {
    const client = getOpenAIClient();
    
    // Retry logic for network errors
    const maxRetries = 3;
    let lastError: any;
    
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        const completion = await client.chat.completions.create({
          model: this.config.model,
          max_tokens: this.config.maxTokens,
          temperature: this.config.temperature,
          messages: [
            {
              role: 'system',
              content: this.systemPrompt,
            },
            {
              role: 'user',
              content: userPrompt,
            },
          ],
        });

        const choice = completion.choices[0];
        if (!choice || !choice.message || !choice.message.content) {
          throw new Error('No content in OpenAI response');
        }

        return {
          response: choice.message.content,
          tokensUsed: {
            input: completion.usage?.prompt_tokens || 0,
            output: completion.usage?.completion_tokens || 0,
          },
        };
        
      } catch (error: any) {
        lastError = error;
        
        const isNetworkError = 
          error.code === 'EAI_AGAIN' ||
          error.code === 'ENOTFOUND' ||
          error.code === 'ETIMEDOUT' ||
          error.code === 'ECONNRESET' ||
          error.message?.includes('Connection error') ||
          error.message?.includes('network');
        
        if (!isNetworkError || attempt === maxRetries) {
          throw error;
        }
        
        const delayMs = 1000 * Math.pow(2, attempt - 1);
        console.log(`âš ï¸ [${this.config.id}] Network error on attempt ${attempt}/${maxRetries}. Retrying in ${delayMs}ms...`);
        await new Promise(resolve => setTimeout(resolve, delayMs));
      }
    }
    
    throw lastError;
  }

  /**
   * Call Google Gemini API
   */
  private async callGoogle(userPrompt: string): Promise<{
    response: string;
    tokensUsed: { input: number; output: number };
  }> {
    const client = getGoogleClient();
    const model = client.getGenerativeModel({ model: this.config.model });

    const fullPrompt = `${this.systemPrompt}\n\n${userPrompt}`;
    const result = await model.generateContent(fullPrompt);
    const response = result.response.text();

    // Google doesn't provide token counts, estimate
    const estimatedInputTokens = Math.ceil(fullPrompt.length / 4);
    const estimatedOutputTokens = Math.ceil(response.length / 4);

    return {
      response,
      tokensUsed: {
        input: estimatedInputTokens,
        output: estimatedOutputTokens,
      },
    };
  }

  /**
   * Parse JSON response with multiple strategies and detailed error logging
   */
  protected parseResponse(response: string): any {
    const originalResponse = response; // Save for error logging

    try {
      // Strategy 1: Clean up markdown fences
      let cleaned = response.trim();

      // Remove ```json and ``` if present
      if (cleaned.startsWith('```json')) {
        cleaned = cleaned.replace(/^```json\s*/, '').replace(/```\s*$/, '');
      } else if (cleaned.startsWith('```')) {
        cleaned = cleaned.replace(/^```\s*/, '').replace(/```\s*$/, '');
      }

      // Strategy 2: Try to find JSON object in the response
      // Look for first { and last }
      const firstBrace = cleaned.indexOf('{');
      const lastBrace = cleaned.lastIndexOf('}');

      if (firstBrace !== -1 && lastBrace !== -1 && firstBrace < lastBrace) {
        cleaned = cleaned.substring(firstBrace, lastBrace + 1);
      }

      // Attempt to parse
      const parsed = JSON.parse(cleaned);
      
      console.log(`âœ… [${this.config.id}] Successfully parsed JSON`);
      return parsed;

    } catch (error) {
      // Detailed error logging
      console.error(`\nâŒ [${this.config.id}] JSON Parsing Failed!`);
      console.error(`\nðŸ“„ Original Response (full):`);
      console.error(originalResponse);
      console.error(`\nðŸ” Response Length: ${originalResponse.length} characters`);
      console.error(`\nâš ï¸ Parse Error:`, error);
      console.error(`\nðŸ’¡ First 200 chars: ${originalResponse.substring(0, 200)}`);
      console.error(`\nðŸ’¡ Last 200 chars: ${originalResponse.substring(Math.max(0, originalResponse.length - 200))}`);
      
      // Check for common issues
      if (!originalResponse.includes('{')) {
        console.error(`\nðŸš¨ Response does not contain any '{' character - not JSON!`);
      }
      if (originalResponse.includes('I\'m sorry') || originalResponse.includes('I cannot')) {
        console.error(`\nðŸš¨ LLM appears to have refused the request!`);
      }

      throw new Error(`Invalid JSON response from ${this.config.id}: ${error}\nSee console for full response.`);
    }
  }

  /**
   * Calculate cost for this agent call
   */
  calculateCost(tokensUsed: { input: number; output: number }): number {
    const costCalc = calculateCost(
      this.config.model,
      tokensUsed.input,
      tokensUsed.output
    );
    return costCalc.totalCost;
  }

  /**
   * Log agent activity (for debugging)
   */
  protected log(message: string, data?: any): void {
    const timestamp = new Date().toISOString();
    console.log(`[${timestamp}] [${this.config.id}] ${message}`, data || '');
  }
}

// ==========================================
// ERROR HANDLING
// ==========================================

export class AgentError extends Error {
  constructor(
    public agentId: string,
    public originalError: Error,
    public retryable: boolean = true
  ) {
    super(`Agent ${agentId} failed: ${originalError.message}`);
    this.name = 'AgentError';
  }
}

/**
 * Retry wrapper with exponential backoff
 */
export async function withRetry<T>(
  fn: () => Promise<T>,
  maxRetries: number = 3,
  baseDelay: number = 1000
): Promise<T> {
  let lastError: Error;

  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error as Error;

      // Don't retry on certain errors
      if (
        error instanceof Error &&
        (error.message.includes('Invalid API key') ||
          error.message.includes('not found'))
      ) {
        throw error;
      }

      if (i < maxRetries - 1) {
        const delay = baseDelay * Math.pow(2, i);
        console.log(`Retry ${i + 1}/${maxRetries} after ${delay}ms...`);
        await new Promise((resolve) => setTimeout(resolve, delay));
      }
    }
  }

  throw lastError!;
}


================================================================================
8. EXPERT AGENT
================================================================================
FILE: packages/legal-council/agents/review/expert.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Expert Agent (Contract Review)
 * Comprehensive legal analysis of contracts
 * 
 * FIX (Feb 10, 2026): Validation expects flat structure from LLM
 */

import { BaseAgent } from '../base-agent';
import { buildExpertPrompt } from '../../config/review-prompts';
import { createReviewAgentConfigs } from '../../config/models';
import type { ExpertOutput, ContractReviewRequest } from '../../types/review-types';

export class ExpertAgent extends BaseAgent<ExpertOutput> {
  constructor() {
    const configs = createReviewAgentConfigs();
    const expertConfig = configs.find((c: any) => c.role === 'expert')!;

    // System prompt will be set dynamically based on contract type
    super(expertConfig, ''); // Empty for now, set in analyze()
  }

  /**
   * Analyze contract and return comprehensive expert opinion
   */
  async analyze(request: ContractReviewRequest): Promise<ExpertOutput> {
    // Build context-aware system prompt
    this.systemPrompt = await buildExpertPrompt(
      request.contractType,
      request.jurisdiction
    );

    // Build user prompt with all context
    const userPrompt = this.buildUserPrompt(request);

    // Call LLM
    const rawOutput = await this.call(userPrompt);

    // Transform flat structure to nested structure
    const output = this.transformOutput(rawOutput);

    // Validate output structure
    this.validateOutput(output);

    return output;
  }

  /**
   * Build comprehensive user prompt
   */
  private buildUserPrompt(request: ContractReviewRequest): string {
    let prompt = '# CONTRACT TO ANALYZE\n\n';
    prompt += '```\n';
    prompt += request.contractText;
    prompt += '\n```\n\n';

    // Add contract metadata
    prompt += '# CONTEXT\n\n';
    if (request.contractType) {
      prompt += `Contract Type: ${request.contractType}\n`;
    }
    if (request.jurisdiction) {
      prompt += `Jurisdiction: ${request.jurisdiction}\n`;
    }

    // Add specific questions if provided
    if (request.specificQuestions && request.specificQuestions.length > 0) {
      prompt += '\n# SPECIFIC QUESTIONS FROM CLIENT\n\n';
      request.specificQuestions.forEach((q: string, i: number) => {
        prompt += `${i + 1}. ${q}\n`;
      });
    }

    // Add focus areas if provided
    if (request.focusAreas && request.focusAreas.length > 0) {
      prompt += '\n# PRIORITY FOCUS AREAS\n\n';
      prompt += 'Pay special attention to:\n';
      request.focusAreas.forEach((area: any) => {
        prompt += `- ${area}\n`;
      });
    }

    prompt += '\n# YOUR TASK\n\n';
    prompt += 'Provide comprehensive analysis following the JSON structure specified in your system prompt.\n';
    prompt += 'Be thorough, specific, and reference exact clause numbers.\n';

    return prompt;
  }

  /**
   * Transform flat LLM output to nested ExpertOutput structure
   */
  private transformOutput(rawOutput: any): ExpertOutput {
    // LLM returns flat structure: { executiveSummary, keyIssues, ... }
    // We need nested: { analysis: { executiveSummary, keyIssues, ... } }
    
    return {
      ...rawOutput,
      analysis: {
        executiveSummary: rawOutput.executiveSummary,
        keyIssues: rawOutput.keyIssues,
        clauseAnalysis: rawOutput.clauseAnalysis,
        overallRiskScore: rawOutput.overallRiskScore,
        recommendations: rawOutput.recommendations,
      },
    } as ExpertOutput;
  }

  /**
   * Validate that output has required structure
   */
  private validateOutput(output: ExpertOutput): void {
    if (!output.analysis) {
      throw new Error('Expert output missing analysis object');
    }

    const required = [
      'executiveSummary',
      'keyIssues',
      'clauseAnalysis',
      'overallRiskScore',
      'recommendations',
    ];

    for (const field of required) {
      if (!(field in output.analysis)) {
        throw new Error(`Expert output missing required field: analysis.${field}`);
      }
    }

    // Validate risk score is in range
    if (
      output.analysis.overallRiskScore < 1 ||
      output.analysis.overallRiskScore > 10
    ) {
      console.warn(
        `âš ï¸ Expert risk score out of range: ${output.analysis.overallRiskScore}`
      );
    }

    // Validate issues have severity
    for (const issue of output.analysis.keyIssues) {
      if (!issue.severity || issue.severity < 1 || issue.severity > 5) {
        console.warn(`âš ï¸ Issue ${issue.id} has invalid severity: ${issue.severity}`);
      }
    }

    // Validate we have exactly 7 issues (as per optimized prompt)
    const issueCount = output.analysis.keyIssues.length;
    if (issueCount !== 7) {
      console.warn(`âš ï¸ Expert returned ${issueCount} issues, expected 7 (as per prompt optimization)`);
    }

    // Validate we don't have too many recommendations
    const recCount = output.analysis.recommendations.length;
    if (recCount > 4) {
      console.warn(`âš ï¸ Expert returned ${recCount} recommendations, max should be 4`);
    }
  }
}

// ==========================================
// CONVENIENCE FUNCTION
// ==========================================

/**
 * Quick way to get expert analysis
 */
export async function getExpertAnalysis(
  contractText: string,
  options?: {
    contractType?: ContractReviewRequest['contractType'];
    jurisdiction?: string;
    questions?: string[];
    focusAreas?: ContractReviewRequest['focusAreas'];
  }
): Promise<ExpertOutput> {
  const expert = new ExpertAgent();

  const request: ContractReviewRequest = {
    contractText,
    contractType: options?.contractType,
    jurisdiction: options?.jurisdiction || 'Ukraine',
    specificQuestions: options?.questions,
    focusAreas: options?.focusAreas,
  };

  return expert.analyze(request);
}


================================================================================
9. PROVOCATEUR AGENT
================================================================================
FILE: packages/legal-council/agents/review/provocateur.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Provocateur Agent (Contract Review)
 * Adversarial red-team critic - finds exploitable flaws
 * 
 * FIX (Feb 10, 2026): Transform flat LLM output to nested structure
 */

import { BaseAgent } from '../base-agent';
import { buildProvocateurPrompt } from '../../config/review-prompts';
import { createReviewAgentConfigs } from '../../config/models';
import type { ProvocateurOutput } from '../../types/review-types';
import type { ExpertOutput } from '../../types/review-types';

export class ProvocateurAgent extends BaseAgent<ProvocateurOutput> {
  constructor() {
    const configs = createReviewAgentConfigs();
    const provocateurConfig = configs.find((c) => c.role === 'provocateur')!;

    super(provocateurConfig, '');
  }

  /**
   * Critique contract and find exploitable flaws
   */
  async critique(
    contractText: string,
    expertAnalysis?: ExpertOutput
  ): Promise<ProvocateurOutput> {
    this.systemPrompt = await buildProvocateurPrompt();

    const userPrompt = this.buildUserPrompt(contractText, expertAnalysis);

    const rawOutput = await this.call(userPrompt);

    // Transform flat to nested structure
    const output = this.transformOutput(rawOutput);

    this.validateOutput(output);

    return output;
  }

  /**
   * Build adversarial user prompt
   */
  private buildUserPrompt(
    contractText: string,
    expertAnalysis?: ExpertOutput
  ): string {
    let prompt = '# CONTRACT TO ATTACK\n\n';
    prompt += '```\n';
    prompt += contractText;
    prompt += '\n```\n\n';

    if (expertAnalysis) {
      prompt += '# EXPERT ALREADY FOUND THESE ISSUES\n\n';
      prompt += `Expert identified ${expertAnalysis.analysis.keyIssues.length} issues:\n`;

      expertAnalysis.analysis.keyIssues.forEach((issue) => {
        prompt += `- ${issue.title} (severity ${issue.severity})\n`;
      });

      prompt += '\n**YOUR JOB: Find DIFFERENT flaws that Expert missed!**\n';
      prompt += 'Don\'t repeat what Expert found. Find NEW attack vectors.\n\n';
    }

    prompt += '# YOUR MISSION\n\n';
    prompt += 'You are opposing counsel. Find at least 3 critical flaws you can exploit.\n';
    prompt += 'Be ruthless. Be creative. This is war.\n';
    prompt += '\nOutput strict JSON format as specified in system prompt.\n';

    return prompt;
  }

  /**
   * Transform flat LLM output to nested structure
   */
  private transformOutput(rawOutput: any): ProvocateurOutput {
    return {
      ...rawOutput,
      critique: {
        flaws: rawOutput.flaws,
        maxSeverity: rawOutput.maxSeverity,
        exploitationScenarios: rawOutput.exploitationScenarios,
      },
    } as ProvocateurOutput;
  }

  /**
   * Validate output structure
   */
  private validateOutput(output: ProvocateurOutput): void {
    if (!output.critique || !output.critique.flaws) {
      throw new Error('Provocateur output missing critique.flaws');
    }

    const flawCount = output.critique.flaws.length;

    if (flawCount < 3) {
      console.warn(
        `âš ï¸ Provocateur only found ${flawCount} flaws (expected â‰¥3). Prompt may need adjustment.`
      );
    }

    // Validate max severity
    if (
      output.critique.maxSeverity < 1 ||
      output.critique.maxSeverity > 5
    ) {
      console.warn(
        `âš ï¸ Provocateur maxSeverity out of range: ${output.critique.maxSeverity}`
      );
    }

    // Validate we don't have too many flaws (optimized prompt says max 7)
    if (flawCount > 7) {
      console.warn(`âš ï¸ Provocateur returned ${flawCount} flaws, max should be 7`);
    }
  }
}

/**
 * Quick way to get provocateur critique
 */
export async function getProvocateurCritique(
  contractText: string,
  expertAnalysis?: ExpertOutput
): Promise<ProvocateurOutput> {
  const provocateur = new ProvocateurAgent();
  return provocateur.critique(contractText, expertAnalysis);
}


================================================================================
10. VALIDATOR AGENT (REVIEW)
================================================================================
FILE: packages/legal-council/agents/review/validator.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Validator Agent (Contract Review)
 * Checks completeness and consistency of analysis
 * 
 * FIX (Feb 10, 2026): Transform flat LLM output to nested structure
 */

import { BaseAgent } from '../base-agent';
import { buildValidatorPrompt } from '../../config/review-prompts';
import { createReviewAgentConfigs } from '../../config/models';
import type {
  ValidatorOutput,
  ExpertOutput,
  ProvocateurOutput,
  ContractReviewRequest,
} from '../../types/review-types';

export class ValidatorAgent extends BaseAgent<ValidatorOutput> {
  constructor() {
    const configs = createReviewAgentConfigs();
    const validatorConfig = configs.find((c) => c.role === 'validator')!;

    super(validatorConfig, '');
  }

  /**
   * Validate completeness of Expert and Provocateur analysis
   */
  async validate(
    request: ContractReviewRequest,
    expertOutput: ExpertOutput,
    provocateurOutput: ProvocateurOutput
  ): Promise<ValidatorOutput> {
    this.systemPrompt = await buildValidatorPrompt();

    const userPrompt = this.buildUserPrompt(request, expertOutput, provocateurOutput);

    const rawOutput = await this.call(userPrompt);

    // Transform flat to nested structure
    const output = this.transformOutput(rawOutput);

    this.validateOutput(output);

    return output;
  }

  /**
   * Build validation prompt with all inputs
   */
  private buildUserPrompt(
    request: ContractReviewRequest,
    expertOutput: ExpertOutput,
    provocateurOutput: ProvocateurOutput
  ): string {
    let prompt = '# ORIGINAL CONTRACT\n\n';
    prompt += '```\n';
    prompt += request.contractText;
    prompt += '\n```\n\n';

    // User's original request
    prompt += '# USER\'S QUERY\n\n';
    if (request.specificQuestions && request.specificQuestions.length > 0) {
      prompt += 'Specific questions asked:\n';
      request.specificQuestions.forEach((q, i) => {
        prompt += `${i + 1}. ${q}\n`;
      });
    }

    if (request.focusAreas && request.focusAreas.length > 0) {
      prompt += '\nFocus areas requested:\n';
      request.focusAreas.forEach((area) => {
        prompt += `- ${area}\n`;
      });
    }

    if (
      (!request.specificQuestions || request.specificQuestions.length === 0) &&
      (!request.focusAreas || request.focusAreas.length === 0)
    ) {
      prompt += 'General contract review requested (all aspects).\n';
    }

    // Expert's analysis
    prompt += '\n# EXPERT\'S ANALYSIS\n\n';
    prompt += '```json\n';
    prompt += JSON.stringify(expertOutput.analysis, null, 2);
    prompt += '\n```\n\n';

    // Provocateur's critique
    prompt += '# PROVOCATEUR\'S CRITIQUE\n\n';
    prompt += '```json\n';
    prompt += JSON.stringify(provocateurOutput.critique, null, 2);
    prompt += '\n```\n\n';

    // Validation task
    prompt += '# YOUR VALIDATION TASK\n\n';
    prompt += 'Check if Expert and Provocateur properly addressed ALL aspects:\n';
    prompt += '1. Did they cover everything the user asked about?\n';
    prompt += '2. Are there contradictions between Expert and Provocateur?\n';
    prompt += '3. Are standard clauses for this contract type reviewed?\n';
    prompt += '4. Are recommendations actionable?\n';
    prompt += '\nOutput strict JSON format as specified in system prompt.\n';

    return prompt;
  }

  /**
   * Transform flat LLM output to nested structure
   */
  private transformOutput(rawOutput: any): ValidatorOutput {
    return {
      ...rawOutput,
      validation: {
        isComplete: rawOutput.isComplete,
        completenessScore: rawOutput.completenessScore,
        missingAspects: rawOutput.missingAspects,
        contradictions: rawOutput.contradictions,
        verdict: rawOutput.verdict,
        reason: rawOutput.reason,
      },
    } as ValidatorOutput;
  }

  /**
   * Validate output structure
   */
  private validateOutput(output: ValidatorOutput): void {
    const required = [
      'isComplete',
      'completenessScore',
      'missingAspects',
      'contradictions',
      'verdict',
    ];

    for (const field of required) {
      if (!(field in output.validation)) {
        throw new Error(`Validator output missing required field: validation.${field}`);
      }
    }

    // Validate score is in range
    if (
      output.validation.completenessScore < 0 ||
      output.validation.completenessScore > 100
    ) {
      console.warn(
        `âš ï¸ Validator completeness score out of range: ${output.validation.completenessScore}`
      );
    }

    // Validate verdict is valid
    const validVerdicts = ['COMPLETE', 'NEEDS_REVISION'];
    if (!validVerdicts.includes(output.validation.verdict)) {
      throw new Error(
        `Invalid verdict: ${output.validation.verdict}. Must be COMPLETE or NEEDS_REVISION`
      );
    }
  }

  /**
   * Check if validation passed (analysis is complete)
   */
  isPassed(output: ValidatorOutput): boolean {
    return output.validation.verdict === 'COMPLETE';
  }

  /**
   * Get critical missing aspects (if any)
   */
  getCriticalGaps(output: ValidatorOutput): string[] {
    if (output.validation.isComplete) {
      return [];
    }
    return output.validation.missingAspects;
  }

  /**
   * Get contradictions that need Synthesizer attention
   */
  getContradictions(output: ValidatorOutput): ValidatorOutput['validation']['contradictions'] {
    return output.validation.contradictions;
  }
}

/**
 * Quick way to validate analysis
 */
export async function validateAnalysis(
  request: ContractReviewRequest,
  expertOutput: ExpertOutput,
  provocateurOutput: ProvocateurOutput
): Promise<ValidatorOutput> {
  const validator = new ValidatorAgent();
  return validator.validate(request, expertOutput, provocateurOutput);
}


================================================================================
11. SYNTHESIZER AGENT
================================================================================
FILE: packages/legal-council/agents/review/synthesizer.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Synthesizer Agent (Contract Review)
 * Combines all council outputs into final executive summary
 * 
 * FIX (Feb 10, 2026): Transform flat LLM output to nested structure
 */

import { BaseAgent } from '../base-agent';
import { buildSynthesizerPrompt } from '../../config/review-prompts';
import { createReviewAgentConfigs } from '../../config/models';
import type {
  SynthesizerOutput,
  ExpertOutput,
  ProvocateurOutput,
  ValidatorOutput,
} from '../../types/review-types';

export class SynthesizerAgent extends BaseAgent<SynthesizerOutput> {
  constructor() {
    const configs = createReviewAgentConfigs();
    const synthesizerConfig = configs.find((c) => c.role === 'synthesizer')!;

    super(synthesizerConfig, '');
  }

  /**
   * Synthesize all council outputs into final answer
   */
  async synthesize(
    expertOutput: ExpertOutput,
    provocateurOutput: ProvocateurOutput,
    validatorOutput: ValidatorOutput
  ): Promise<SynthesizerOutput> {
    this.systemPrompt = await buildSynthesizerPrompt();

    const userPrompt = this.buildUserPrompt(
      expertOutput,
      provocateurOutput,
      validatorOutput
    );

    const rawOutput = await this.call(userPrompt);

    // Transform flat to nested structure
    const output = this.transformOutput(rawOutput);

    this.validateOutput(output);

    return output;
  }

  /**
   * Build synthesis prompt with all council outputs
   */
  private buildUserPrompt(
    expertOutput: ExpertOutput,
    provocateurOutput: ProvocateurOutput,
    validatorOutput: ValidatorOutput
  ): string {
    let prompt = '# AI COUNCIL OUTPUTS TO SYNTHESIZE\n\n';

    // Expert analysis
    prompt += '## EXPERT ANALYSIS\n\n';
    prompt += '```json\n';
    prompt += JSON.stringify(expertOutput.analysis, null, 2);
    prompt += '\n```\n\n';
    prompt += `Expert Confidence: ${(expertOutput.confidence * 100).toFixed(0)}%\n\n`;

    // Provocateur critique
    prompt += '## PROVOCATEUR CRITIQUE (Red-Team)\n\n';
    prompt += '```json\n';
    prompt += JSON.stringify(provocateurOutput.critique, null, 2);
    prompt += '\n```\n\n';
    prompt += `Provocateur Confidence: ${(provocateurOutput.confidence * 100).toFixed(0)}%\n`;
    prompt += `Max Severity Found: ${provocateurOutput.critique.maxSeverity}/5\n\n`;

    // Validator results
    prompt += '## VALIDATOR ASSESSMENT\n\n';
    prompt += '```json\n';
    prompt += JSON.stringify(validatorOutput.validation, null, 2);
    prompt += '\n```\n\n';
    prompt += `Completeness: ${validatorOutput.validation.completenessScore}%\n`;
    prompt += `Verdict: ${validatorOutput.validation.verdict}\n\n`;

    // Synthesis instructions
    prompt += '# YOUR SYNTHESIS TASK\n\n';
    prompt += '1. **Prioritize by severity**: Lead with highest-risk issues\n';
    prompt += '2. **Resolve contradictions**: If Expert and Provocateur disagree, explain both views and make judgment\n';
    prompt += '3. **Consolidate duplicates**: Don\'t repeat same issue twice\n';
    prompt += '4. **Be actionable**: Every risk needs clear mitigation\n';
    prompt += '5. **Plain language**: Client-friendly, not overly technical\n';
    prompt += '6. **Balanced**: Honest about risks, but not alarmist\n';
    prompt += '\nIf Validator found contradictions, address them in keyDisagreements.\n';
    prompt += '\nOutput strict JSON format as specified in system prompt.\n';

    return prompt;
  }

  /**
   * Transform flat LLM output to nested structure
   */
  private transformOutput(rawOutput: any): SynthesizerOutput {
    return {
      ...rawOutput,
      synthesis: {
        summary: rawOutput.summary,
        criticalRisks: rawOutput.criticalRisks,
        recommendations: rawOutput.recommendations,
        confidence: rawOutput.confidence || rawOutput.synthesisConfidence || 0.8,
        keyDisagreements: rawOutput.keyDisagreements || [],
      },
    } as SynthesizerOutput;
  }

  /**
   * Validate output structure
   */
  private validateOutput(output: SynthesizerOutput): void {
    const required = ['summary', 'criticalRisks', 'recommendations', 'confidence'];

    for (const field of required) {
      if (!(field in output.synthesis)) {
        throw new Error(`Synthesizer output missing required field: synthesis.${field}`);
      }
    }

    // Validate confidence is in range
    if (
      output.synthesis.confidence < 0 ||
      output.synthesis.confidence > 1
    ) {
      console.warn(
        `âš ï¸ Synthesizer confidence out of range: ${output.synthesis.confidence}`
      );
    }

    // Validate we don't have too many risks/recommendations (optimized prompt says max 5 each)
    const riskCount = output.synthesis.criticalRisks.length;
    const recCount = output.synthesis.recommendations.length;

    if (riskCount > 5) {
      console.warn(`âš ï¸ Synthesizer returned ${riskCount} risks, max should be 5`);
    }

    if (recCount > 5) {
      console.warn(`âš ï¸ Synthesizer returned ${recCount} recommendations, max should be 5`);
    }
  }

  /**
   * Get high-priority action items for client
   */
  getActionItems(output: SynthesizerOutput) {
    return output.synthesis.recommendations
      .filter((rec) => rec.priority === 'high')
      .map((rec) => rec.action);
  }
}

/**
 * Quick way to synthesize council outputs
 */
export async function synthesizeAnalysis(
  expertOutput: ExpertOutput,
  provocateurOutput: ProvocateurOutput,
  validatorOutput: ValidatorOutput
): Promise<SynthesizerOutput> {
  const synthesizer = new SynthesizerAgent();
  return synthesizer.synthesize(expertOutput, provocateurOutput, validatorOutput);
}


================================================================================
12. ANALYZER AGENT
================================================================================
FILE: packages/legal-council/agents/generation/analyzer.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Analyzer Agent (Document Generation)
 * Parses user requirements into structured specifications
 */

import { BaseAgent } from '../base-agent';
import { buildAnalyzerPrompt } from '../../config/generation-prompts';
import { createGenerationAgentConfigs } from '../../config/models';
import type {
  AnalyzerOutput,
  DocumentGenerationRequest,
} from '../../types/generation-types';

export class AnalyzerAgent extends BaseAgent<AnalyzerOutput> {
  constructor() {
    const configs = createGenerationAgentConfigs();
    const analyzerConfig = configs.find((c) => c.role === 'analyzer')!;

    super(analyzerConfig, '');
  }

  /**
   * Analyze user requirements and structure them
   */
  async analyze(request: DocumentGenerationRequest): Promise<AnalyzerOutput> {
    this.systemPrompt = await buildAnalyzerPrompt(request.documentType);

    const userPrompt = this.buildUserPrompt(request);
    const output = await this.call(userPrompt);

    this.validateOutput(output);
    return output;
  }

  private buildUserPrompt(request: DocumentGenerationRequest): string {
    let prompt = '# USER REQUIREMENTS\n\n';
    prompt += request.requirements;
    prompt += '\n\n# DOCUMENT TYPE\n\n';
    prompt += `${request.documentType}\n\n`;

    if (request.jurisdiction) {
      prompt += `# JURISDICTION\n\n${request.jurisdiction}\n\n`;
    }

    if (request.parties && request.parties.length > 0) {
      prompt += '# PARTIES\n\n';
      request.parties.forEach((p) => {
        prompt += `- ${p.role}: ${p.name || '[to be filled]'}\n`;
      });
      prompt += '\n';
    }

    if (request.specificClauses && request.specificClauses.length > 0) {
      prompt += '# SPECIFIC CLAUSES REQUESTED\n\n';
      request.specificClauses.forEach((c) => {
        prompt += `- ${c.type} (${c.priority}): ${c.requirements}\n`;
      });
      prompt += '\n';
    }

    prompt += '# YOUR TASK\n\n';
    prompt += 'Parse these requirements into structured JSON format.\n';
    prompt += 'Make smart assumptions where info is missing.\n';
    prompt += 'Suggest additional clauses that are essential for this document type.\n';

    return prompt;
  }

  private validateOutput(output: any): void {
    if (!output.analysis || !output.analysis.structuredRequirements) {
      throw new Error('Analyzer output missing structuredRequirements');
    }

    const req = output.analysis.structuredRequirements;
    if (!req.documentType || !req.parties || !req.mustHaveClauses) {
      console.warn('âš ï¸ Analyzer output missing key fields');
    }
  }
}

export async function analyzeRequirements(
  request: DocumentGenerationRequest
): Promise<AnalyzerOutput> {
  const analyzer = new AnalyzerAgent();
  return analyzer.analyze(request);
}


================================================================================
13. DRAFTER AGENT
================================================================================
FILE: packages/legal-council/agents/generation/drafter.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Drafter Agent (Document Generation)
 * Generates Ð”Ð¡Ð¢Ð£-compliant Ukrainian contracts
 */

import { BaseAgent } from '../base-agent';
import { buildDrafterPrompt } from '../../config/generation-prompts';
import { createGenerationAgentConfigs } from '../../config/models';
import type { DrafterOutput, AnalyzerOutput, DocumentType } from '../../types/generation-types';

export class DrafterAgent extends BaseAgent<DrafterOutput> {
  constructor() {
    const configs = createGenerationAgentConfigs();
    const drafterConfig = configs.find((c) => c.role === 'drafter')!;

    super(drafterConfig, '');
  }

  /**
   * Draft complete contract based on structured requirements
   */
  async draft(
    documentType: DocumentType,
    analyzerOutput: AnalyzerOutput
  ): Promise<DrafterOutput> {
    this.systemPrompt = await buildDrafterPrompt(documentType);

    const userPrompt = this.buildUserPrompt(analyzerOutput);
    const output = await this.call(userPrompt);

    this.validateOutput(output);
    return output;
  }

  private buildUserPrompt(analyzerOutput: AnalyzerOutput): string {
    const req = analyzerOutput.analysis.structuredRequirements;

    let prompt = '# STRUCTURED REQUIREMENTS\n\n';
    prompt += '```json\n';
    prompt += JSON.stringify(req, null, 2);
    prompt += '\n```\n\n';

    prompt += '# SUGGESTED CLAUSES\n\n';
    analyzerOutput.analysis.suggestedClauses.forEach((clause) => {
      prompt += `- ${clause.type} (${clause.priority}): ${clause.rationale}\n`;
    });

    prompt += '\n# YOUR TASK\n\n';
    prompt += 'Generate complete Ð”Ð¡Ð¢Ð£-compliant contract in Ukrainian language.\n';
    prompt += 'Follow the EXACT structure from your system prompt.\n';
    prompt += 'Include all mandatory sections per Ukrainian law.\n';
    prompt += 'Output strict JSON with "documentText" field containing full Markdown contract.\n';

    return prompt;
  }

  private validateOutput(output: any): void {
    if (!output.draft || !output.draft.documentText) {
      throw new Error('Drafter output missing documentText');
    }

    const text = output.draft.documentText;

    // Basic Ð”Ð¡Ð¢Ð£ validation
    if (!text.includes('Ð”ÐžÐ“ÐžÐ’Ð†Ð ')) {
      console.warn('âš ï¸ Contract missing "Ð”ÐžÐ“ÐžÐ’Ð†Ð " title');
    }

    if (!text.includes('ÐŸÐ Ð•Ð”ÐœÐ•Ð¢ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£')) {
      console.warn('âš ï¸ Contract missing mandatory section: ÐŸÐ Ð•Ð”ÐœÐ•Ð¢ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£');
    }

    if (!text.includes('ÐŸÐ†Ð”ÐŸÐ˜Ð¡Ð˜ Ð¡Ð¢ÐžÐ Ð†Ð')) {
      console.warn('âš ï¸ Contract missing signature section');
    }
  }
}

export async function draftDocument(
  documentType: DocumentType,
  analyzerOutput: AnalyzerOutput
): Promise<DrafterOutput> {
  const drafter = new DrafterAgent();
  return drafter.draft(documentType, analyzerOutput);
}


================================================================================
14. VALIDATOR AGENT (GENERATION)
================================================================================
FILE: packages/legal-council/agents/generation/validator.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Generation Validator Agent
 * Checks legal compliance and Ð”Ð¡Ð¢Ð£ standards of drafted document
 */

import { BaseAgent } from '../base-agent';
import { buildGenerationValidatorPrompt } from '../../config/generation-prompts';
import { createGenerationAgentConfigs } from '../../config/models';
import type {
  GenerationValidatorOutput,
  DrafterOutput,
  AnalyzerOutput,
} from '../../types/generation-types';

export class GenerationValidatorAgent extends BaseAgent<GenerationValidatorOutput> {
  constructor() {
    const configs = createGenerationAgentConfigs();
    const validatorConfig = configs.find((c) => c.role === 'validator')!;

    super(validatorConfig, '');
  }

  /**
   * Validate drafted document for legal compliance
   */
  async validate(
    analyzerOutput: AnalyzerOutput,
    drafterOutput: DrafterOutput
  ): Promise<GenerationValidatorOutput> {
    this.systemPrompt = await buildGenerationValidatorPrompt();

    const userPrompt = this.buildUserPrompt(analyzerOutput, drafterOutput);
    const output = await this.call(userPrompt);

    this.validateOutput(output);
    return output;
  }

  private buildUserPrompt(
    analyzerOutput: AnalyzerOutput,
    drafterOutput: DrafterOutput
  ): string {
    let prompt = '# ORIGINAL REQUIREMENTS\n\n';
    prompt += '```json\n';
    prompt += JSON.stringify(analyzerOutput.analysis.structuredRequirements, null, 2);
    prompt += '\n```\n\n';

    prompt += '# DRAFTED DOCUMENT\n\n';
    prompt += '```\n';
    prompt += drafterOutput.draft.documentText;
    prompt += '\n```\n\n';

    prompt += '# YOUR VALIDATION TASK\n\n';
    prompt += 'Check this document against:\n';
    prompt += '1. Ukrainian law requirements (Ð¦ÐšÐ£ ÑÑ‚. 638)\n';
    prompt += '2. Ð”Ð¡Ð¢Ð£ 4163-2020 structure\n';
    prompt += '3. Completeness (all required clauses present)\n';
    prompt += '4. Legal risks (ambiguous terms, liability gaps)\n';
    prompt += '\nOutput strict JSON with compliance checks and risk flags.\n';

    return prompt;
  }

  private validateOutput(output: any): void {
    if (!output.validation || !output.validation.verdict) {
      throw new Error('Validator output missing verdict');
    }

    const validVerdicts = ['APPROVED', 'NEEDS_REVISION'];
    if (!validVerdicts.includes(output.validation.verdict)) {
      throw new Error(`Invalid verdict: ${output.validation.verdict}`);
    }
  }

  isPassed(output: GenerationValidatorOutput): boolean {
    return output.validation.verdict === 'APPROVED';
  }
}

export async function validateDocument(
  analyzerOutput: AnalyzerOutput,
  drafterOutput: DrafterOutput
): Promise<GenerationValidatorOutput> {
  const validator = new GenerationValidatorAgent();
  return validator.validate(analyzerOutput, drafterOutput);
}


================================================================================
15. POLISHER AGENT
================================================================================
FILE: packages/legal-council/agents/generation/polisher.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Polisher Agent (Document Generation)
 * Finalizes document with professional quality
 */

import { BaseAgent } from '../base-agent';
import { buildPolisherPrompt } from '../../config/generation-prompts';
import { createGenerationAgentConfigs } from '../../config/models';
import type {
  PolisherOutput,
  DrafterOutput,
  GenerationValidatorOutput,
  DocumentGenerationResponse,
} from '../../types/generation-types';

export class PolisherAgent extends BaseAgent<PolisherOutput> {
  constructor() {
    const configs = createGenerationAgentConfigs();
    const polisherConfig = configs.find((c) => c.role === 'polisher')!;

    super(polisherConfig, '');
  }

  /**
   * Polish draft into final executive-ready document
   */
  async polish(
    drafterOutput: DrafterOutput,
    validatorOutput: GenerationValidatorOutput
  ): Promise<PolisherOutput> {
    this.systemPrompt = await buildPolisherPrompt();

    const userPrompt = this.buildUserPrompt(drafterOutput, validatorOutput);
    const output = await this.call(userPrompt);

    this.validateOutput(output);
    return output;
  }

  private buildUserPrompt(
    drafterOutput: DrafterOutput,
    validatorOutput: GenerationValidatorOutput
  ): string {
    let prompt = '# DRAFT DOCUMENT\n\n';
    prompt += '```\n';
    prompt += drafterOutput.draft.documentText;
    prompt += '\n```\n\n';

    prompt += '# VALIDATOR FEEDBACK\n\n';
    prompt += '```json\n';
    prompt += JSON.stringify(validatorOutput.validation, null, 2);
    prompt += '\n```\n\n';

    if (validatorOutput.validation.riskFlags.length > 0) {
      prompt += '# ISSUES TO ADDRESS\n\n';
      validatorOutput.validation.riskFlags.forEach((flag) => {
        prompt += `- ${flag.issue} (severity ${flag.severity}): ${flag.recommendation}\n`;
      });
      prompt += '\n';
    }

    prompt += '# YOUR POLISHING TASK\n\n';
    prompt += '1. Fix any issues identified by Validator\n';
    prompt += '2. Improve clarity and readability\n';
    prompt += '3. Ensure consistency throughout\n';
    prompt += '4. Add executive summary for client\n';
    prompt += '\nOutput strict JSON with polished document and improvements made.\n';

    return prompt;
  }

  private validateOutput(output: any): void {
    if (!output.polished || !output.polished.finalDocument) {
      throw new Error('Polisher output missing finalDocument');
    }

    if (!output.polished.executiveSummary) {
      console.warn('âš ï¸ Polisher missing executive summary');
    }
  }

  buildFinalResponse(
    polisherOutput: PolisherOutput,
    analyzerOutput: any,
    drafterOutput: DrafterOutput,
    validatorOutput: GenerationValidatorOutput,
    metadata: {
      documentType: string;
      totalCost: number;
      processingTimeMs: number;
    }
  ): DocumentGenerationResponse {
    return {
      finalDocument: polisherOutput.polished.finalDocument,
      format: 'markdown',

      metadata: {
        documentType: metadata.documentType as any,
        generatedAt: new Date().toISOString(),
        jurisdiction: 'Ukraine',
        confidence: polisherOutput.confidence,
        totalCost: metadata.totalCost,
        processingTimeMs: metadata.processingTimeMs,
      },

      summary: {
        executiveSummary: polisherOutput.polished.executiveSummary,
        keyTerms: polisherOutput.polished.keyTerms,
        includedClauses: drafterOutput.draft.includedClauses.map((c) => c.type),
      },

      qualityMetrics: {
        complianceScore: validatorOutput.validation.overallScore,
        legalSoundness: validatorOutput.validation.overallScore,
        clarity: 85, // Could be calculated from polisher improvements
        overall: validatorOutput.validation.overallScore,
      },

      recommendations: {
        beforeSigning: [
          'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ñ‚Ðµ Ð²ÑÑ– Ñ€ÐµÐºÐ²Ñ–Ð·Ð¸Ñ‚Ð¸ ÑÑ‚Ð¾Ñ€Ñ–Ð½ Ð¿ÐµÑ€ÐµÐ´ Ð¿Ñ–Ð´Ð¿Ð¸ÑÐ°Ð½Ð½ÑÐ¼',
          'ÐŸÐµÑ€ÐµÐºÐ¾Ð½Ð°Ð¹Ñ‚ÐµÑÑ, Ñ‰Ð¾ Ð²ÑÑ– ÑÑƒÐ¼Ð¸ Ñ‚Ð° Ð´Ð°Ñ‚Ð¸ Ð·Ð°Ð¿Ð¾Ð²Ð½ÐµÐ½Ñ– Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾',
          'Ð—Ð²ÐµÑ€Ð½Ñ–Ñ‚ÑŒ ÑƒÐ²Ð°Ð³Ñƒ Ð½Ð° Ñ€Ð¾Ð·Ð´Ñ–Ð»Ð¸ Ð¿Ñ€Ð¾ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð»ÑŒÐ½Ñ–ÑÑ‚ÑŒ Ñ‚Ð° Ñ€Ð¾Ð·Ñ–Ñ€Ð²Ð°Ð½Ð½Ñ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
        ],
        customizations:
          polisherOutput.polished.improvements?.map((i) => i.rationale) || [],
        reviewAreas:
          validatorOutput.validation.riskFlags.map((f) => f.location) || [],
      },
    };
  }
}

export async function polishDocument(
  drafterOutput: DrafterOutput,
  validatorOutput: GenerationValidatorOutput
): Promise<PolisherOutput> {
  const polisher = new PolisherAgent();
  return polisher.polish(drafterOutput, validatorOutput);
}


================================================================================
16. REVIEW ORCHESTRATOR
================================================================================
FILE: packages/legal-council/orchestrators/review-orchestrator.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Review Orchestrator
 * Coordinates Expert â†’ Provocateur â†’ Validator â†’ Synthesizer
 * Implements tick-based cycle with stop criteria
 * 
 * FIX (Feb 11, 2026): buildFinalResponse moved to Orchestrator to avoid webpack cache issues
 */

import { ExpertAgent } from '../agents/review/expert';
import { ProvocateurAgent } from '../agents/review/provocateur';
import { ValidatorAgent } from '../agents/review/validator';
import { SynthesizerAgent } from '../agents/review/synthesizer';
import type {
  ContractReviewRequest,
  ContractReviewResponse,
  ExpertOutput,
  ProvocateurOutput,
  ValidatorOutput,
  SynthesizerOutput,
} from '../types/review-types';
import type { Round, AuditTrail } from '../../core/orchestrator/types';

export interface ReviewOrchestratorConfig {
  maxRounds: number; // Max iterations before forcing stop
  maxSeverityThreshold: number; // Stop if no issues >= this severity
  minConfidence: number; // Stop if all agents >= this confidence
  enableAuditTrail: boolean;
}

const DEFAULT_CONFIG: ReviewOrchestratorConfig = {
  maxRounds: 3,
  maxSeverityThreshold: 3, // Stop if no severity >= 3 issues remain
  minConfidence: 0.85,
  enableAuditTrail: true,
};

export class ReviewOrchestrator {
  private config: ReviewOrchestratorConfig;
  private expert: ExpertAgent;
  private provocateur: ProvocateurAgent;
  private validator: ValidatorAgent;
  private synthesizer: SynthesizerAgent;

  constructor(config: Partial<ReviewOrchestratorConfig> = {}) {
    this.config = { ...DEFAULT_CONFIG, ...config };

    // Initialize agents
    this.expert = new ExpertAgent();
    this.provocateur = new ProvocateurAgent();
    this.validator = new ValidatorAgent();
    this.synthesizer = new SynthesizerAgent();
  }

  /**
   * Main orchestration method
   */
  async analyze(request: ContractReviewRequest): Promise<ContractReviewResponse> {
    const startTime = Date.now();
    const rounds: Round[] = [];
    let totalCost = 0;

    console.log('ðŸ›¡ï¸ Legal Council Review Session Starting...');
    console.log(`   Max rounds: ${this.config.maxRounds}`);
    console.log(`   Stop criteria: severity < ${this.config.maxSeverityThreshold}, confidence > ${this.config.minConfidence}`);

    // Round 1: Initial analysis
    console.log('\nðŸ“‹ Round 1: Expert Analysis');
    const expertOutput = await this.expert.analyze(request);
    totalCost += this.expert.calculateCost(expertOutput.tokensUsed);
    console.log(`   âœ“ Found ${expertOutput.analysis.keyIssues.length} issues`);
    console.log(`   âœ“ Risk score: ${expertOutput.analysis.overallRiskScore}/10`);
    console.log(`   âœ“ Confidence: ${(expertOutput.confidence * 100).toFixed(0)}%`);

    // Round 2: Adversarial critique
    console.log('\nðŸ”¥ Round 2: Provocateur Critique');
    const provocateurOutput = await this.provocateur.critique(
      request.contractText,
      expertOutput
    );
    totalCost += this.provocateur.calculateCost(provocateurOutput.tokensUsed);
    console.log(`   âœ“ Found ${provocateurOutput.critique.flaws.length} flaws`);
    console.log(`   âœ“ Max severity: ${provocateurOutput.critique.maxSeverity}/5`);
    console.log(`   âœ“ Confidence: ${(provocateurOutput.confidence * 100).toFixed(0)}%`);

    // Round 3: Validation
    console.log('\nðŸ” Round 3: Validator Check');
    const validatorOutput = await this.validator.validate(
      request,
      expertOutput,
      provocateurOutput
    );
    totalCost += this.validator.calculateCost(validatorOutput.tokensUsed);
    console.log(`   âœ“ Completeness: ${validatorOutput.validation.completenessScore}%`);
    console.log(`   âœ“ Verdict: ${validatorOutput.validation.verdict}`);
    console.log(`   âœ“ Contradictions: ${validatorOutput.validation.contradictions.length}`);

    // Check stop criteria
    const shouldStop = this.checkStopCriteria(
      expertOutput,
      provocateurOutput,
      validatorOutput,
      1
    );

    if (shouldStop.shouldStop) {
      console.log(`\nâœ… Stop criteria met: ${shouldStop.reason}`);
    } else {
      console.log(`\nâ­ Continue criteria: ${shouldStop.reason}`);
      // In MVP, we don't actually iterate - just log
      // Future: Implement multi-round refinement
    }

    // Final: Synthesis
    console.log('\nðŸ“ Final: Synthesizer');
    const synthesizerOutput = await this.synthesizer.synthesize(
      expertOutput,
      provocateurOutput,
      validatorOutput
    );
    totalCost += this.synthesizer.calculateCost(synthesizerOutput.tokensUsed);
    console.log(`   âœ“ Critical risks: ${synthesizerOutput.synthesis.criticalRisks.length}`);
    console.log(`   âœ“ Recommendations: ${synthesizerOutput.synthesis.recommendations.length}`);
    console.log(`   âœ“ Confidence: ${(synthesizerOutput.synthesis.confidence * 100).toFixed(0)}%`);

    // Build final response
    const processingTimeMs = Date.now() - startTime;
    const finalResponse = this.buildFinalResponse(
      synthesizerOutput,
      expertOutput,
      provocateurOutput,
      validatorOutput,
      {
        contractType: request.contractType,
        jurisdiction: request.jurisdiction,
        totalCost,
        processingTimeMs,
      }
    );

    console.log(`\nâœ¨ Legal Council Review Complete!`);
    console.log(`   Total cost: $${totalCost.toFixed(4)}`);
    console.log(`   Processing time: ${(processingTimeMs / 1000).toFixed(1)}s`);
    console.log(`   Final confidence: ${(finalResponse.confidence * 100).toFixed(0)}%`);

    return finalResponse;
  }

  /**
   * Build final ContractReviewResponse from all outputs
   */
  private buildFinalResponse(
    synthesizerOutput: SynthesizerOutput,
    expertOutput: ExpertOutput,
    provocateurOutput: ProvocateurOutput,
    validatorOutput: ValidatorOutput,
    metadata: {
      contractType?: string;
      jurisdiction?: string;
      totalCost: number;
      processingTimeMs: number;
    }
  ): ContractReviewResponse {
    return {
      summary: synthesizerOutput.synthesis.summary,
      overallRiskScore: expertOutput.analysis.overallRiskScore,
      confidence: synthesizerOutput.synthesis.confidence,

      criticalRisks: synthesizerOutput.synthesis.criticalRisks,
      recommendations: synthesizerOutput.synthesis.recommendations,

      detailedAnalysis: {
        expertAnalysis: expertOutput.analysis,
        flawsFound: provocateurOutput.critique.flaws,
        validationResults: validatorOutput.validation,
      },

      metadata: {
        contractType: metadata.contractType as any,
        jurisdiction: metadata.jurisdiction,
        analyzedAt: new Date().toISOString(),
        totalCost: metadata.totalCost,
        processingTimeMs: metadata.processingTimeMs,
      },
    };
  }

  /**
   * Check if we should stop iteration
   */
  private checkStopCriteria(
    expertOutput: ExpertOutput,
    provocateurOutput: ProvocateurOutput,
    validatorOutput: ValidatorOutput,
    currentRound: number
  ): { shouldStop: boolean; reason: string } {
    // Criteria 1: Max rounds reached
    if (currentRound >= this.config.maxRounds) {
      return { shouldStop: true, reason: 'Max rounds reached' };
    }

    // Criteria 2: No high-severity issues
    const hasHighSeverityIssues =
      expertOutput.analysis.keyIssues.some(
        (i) => i.severity >= this.config.maxSeverityThreshold
      ) ||
      provocateurOutput.critique.flaws.some(
        (f) => f.severity >= this.config.maxSeverityThreshold
      );

    if (!hasHighSeverityIssues) {
      return {
        shouldStop: true,
        reason: `No issues with severity >= ${this.config.maxSeverityThreshold}`,
      };
    }

    // Criteria 3: High confidence from all agents
    const avgConfidence =
      (expertOutput.confidence +
        provocateurOutput.confidence +
        validatorOutput.confidence) /
      3;

    if (avgConfidence >= this.config.minConfidence) {
      return {
        shouldStop: true,
        reason: `Average confidence ${(avgConfidence * 100).toFixed(0)}% >= ${(this.config.minConfidence * 100).toFixed(0)}%`,
      };
    }

    // Criteria 4: Validator says COMPLETE
    if (validatorOutput.validation.verdict === 'COMPLETE') {
      return { shouldStop: true, reason: 'Validator verdict: COMPLETE' };
    }

    // Continue if none of the stop criteria met
    return {
      shouldStop: false,
      reason: `High severity issues remain (${hasHighSeverityIssues}), confidence low (${(avgConfidence * 100).toFixed(0)}%)`,
    };
  }

  /**
   * Get configuration
   */
  getConfig(): ReviewOrchestratorConfig {
    return { ...this.config };
  }

  /**
   * Update configuration
   */
  setConfig(config: Partial<ReviewOrchestratorConfig>): void {
    this.config = { ...this.config, ...config };
  }
}

// ==========================================
// CONVENIENCE FUNCTION
// ==========================================

/**
 * Quick way to analyze contract
 */
export async function analyzeContract(
  contractText: string,
  options?: {
    contractType?: ContractReviewRequest['contractType'];
    jurisdiction?: string;
    questions?: string[];
    focusAreas?: ContractReviewRequest['focusAreas'];
    config?: Partial<ReviewOrchestratorConfig>;
  }
): Promise<ContractReviewResponse> {
  const orchestrator = new ReviewOrchestrator(options?.config);

  const request: ContractReviewRequest = {
    contractText,
    contractType: options?.contractType,
    jurisdiction: options?.jurisdiction || 'Ukraine',
    specificQuestions: options?.questions,
    focusAreas: options?.focusAreas,
  };

  return orchestrator.analyze(request);
}


================================================================================
17. GENERATION ORCHESTRATOR
================================================================================
FILE: packages/legal-council/orchestrators/generation-orchestrator.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Generation Orchestrator
 * Coordinates Analyzer â†’ Drafter â†’ Validator â†’ Polisher
 */

import { AnalyzerAgent } from '../agents/generation/analyzer';
import { DrafterAgent } from '../agents/generation/drafter';
import { GenerationValidatorAgent } from '../agents/generation/validator';
import { PolisherAgent } from '../agents/generation/polisher';
import type {
  DocumentGenerationRequest,
  DocumentGenerationResponse,
} from '../types/generation-types';

export interface GenerationOrchestratorConfig {
  maxRevisions: number; // Max times to redraft if validator fails
  enableAuditTrail: boolean;
}

const DEFAULT_CONFIG: GenerationOrchestratorConfig = {
  maxRevisions: 2,
  enableAuditTrail: true,
};

export class GenerationOrchestrator {
  private config: GenerationOrchestratorConfig;
  private analyzer: AnalyzerAgent;
  private drafter: DrafterAgent;
  private validator: GenerationValidatorAgent;
  private polisher: PolisherAgent;

  constructor(config: Partial<GenerationOrchestratorConfig> = {}) {
    this.config = { ...DEFAULT_CONFIG, ...config };

    this.analyzer = new AnalyzerAgent();
    this.drafter = new DrafterAgent();
    this.validator = new GenerationValidatorAgent();
    this.polisher = new PolisherAgent();
  }

  /**
   * Main generation method
   */
  async generate(request: DocumentGenerationRequest): Promise<DocumentGenerationResponse> {
    const startTime = Date.now();
    let totalCost = 0;

    console.log('ðŸ“ Legal Council Generation Session Starting...');
    console.log(`   Document type: ${request.documentType}`);
    console.log(`   Max revisions: ${this.config.maxRevisions}`);

    // Step 1: Analyze requirements
    console.log('\nðŸ” Step 1: Analyzer');
    const analyzerOutput = await this.analyzer.analyze(request);
    totalCost += this.analyzer.calculateCost(analyzerOutput.tokensUsed);
    console.log(`   âœ“ Structured requirements`);
    console.log(
      `   âœ“ Must-have clauses: ${analyzerOutput.analysis.structuredRequirements.mustHaveClauses.length}`
    );
    console.log(
      `   âœ“ Suggested clauses: ${analyzerOutput.analysis.suggestedClauses.length}`
    );

    // Step 2: Draft document
    console.log('\nðŸ“„ Step 2: Drafter');
    const drafterOutput = await this.drafter.draft(
      request.documentType,
      analyzerOutput
    );
    totalCost += this.drafter.calculateCost(drafterOutput.tokensUsed);
    console.log(`   âœ“ Draft generated`);
    console.log(
      `   âœ“ Document length: ${drafterOutput.draft.documentText.length} chars`
    );
    console.log(
      `   âœ“ Clauses included: ${drafterOutput.draft.includedClauses.length}`
    );

    // Step 3: Validate
    console.log('\nâœ… Step 3: Validator');
    const validatorOutput = await this.validator.validate(analyzerOutput, drafterOutput);
    totalCost += this.validator.calculateCost(validatorOutput.tokensUsed);
    console.log(`   âœ“ Compliance score: ${validatorOutput.validation.overallScore}%`);
    console.log(`   âœ“ Verdict: ${validatorOutput.validation.verdict}`);
    console.log(
      `   âœ“ Risk flags: ${validatorOutput.validation.riskFlags.length}`
    );

    // Check if needs revision
    if (
      validatorOutput.validation.verdict === 'NEEDS_REVISION' &&
      validatorOutput.validation.riskFlags.some((f) => f.severity >= 4)
    ) {
      console.log('\nâš ï¸  Critical issues found - would need revision in production');
      console.log('   (MVP: proceeding to polisher anyway)');
      // In production: Loop back to drafter with validator feedback
    }

    // Step 4: Polish
    console.log('\nâœ¨ Step 4: Polisher');
    const polisherOutput = await this.polisher.polish(drafterOutput, validatorOutput);
    totalCost += this.polisher.calculateCost(polisherOutput.tokensUsed);
    console.log(`   âœ“ Document polished`);
    console.log(
      `   âœ“ Improvements made: ${polisherOutput.polished.improvements.length}`
    );
    console.log(`   âœ“ Executive summary prepared`);

    // Build final response
    const processingTimeMs = Date.now() - startTime;
    const finalResponse = this.polisher.buildFinalResponse(
      polisherOutput,
      analyzerOutput,
      drafterOutput,
      validatorOutput,
      {
        documentType: request.documentType,
        totalCost,
        processingTimeMs,
      }
    );

    console.log(`\nðŸŽ‰ Legal Council Generation Complete!`);
    console.log(`   Total cost: $${totalCost.toFixed(4)}`);
    console.log(`   Processing time: ${(processingTimeMs / 1000).toFixed(1)}s`);
    console.log(
      `   Quality score: ${finalResponse.qualityMetrics.overall}%`
    );

    return finalResponse;
  }

  getConfig(): GenerationOrchestratorConfig {
    return { ...this.config };
  }

  setConfig(config: Partial<GenerationOrchestratorConfig>): void {
    this.config = { ...this.config, ...config };
  }
}

// ==========================================
// CONVENIENCE FUNCTION
// ==========================================

export async function generateDocument(
  requirements: string,
  documentType: DocumentGenerationRequest['documentType'],
  options?: {
    jurisdiction?: string;
    parties?: DocumentGenerationRequest['parties'];
    config?: Partial<GenerationOrchestratorConfig>;
  }
): Promise<DocumentGenerationResponse> {
  const orchestrator = new GenerationOrchestrator(options?.config);

  const request: DocumentGenerationRequest = {
    documentType,
    requirements,
    jurisdiction: options?.jurisdiction || 'Ukraine',
    parties: options?.parties,
  };

  return orchestrator.generate(request);
}


================================================================================
18. UKRAINIAN LAW SERVICE (+ getAllLaws)
================================================================================
FILE: packages/legal-council/services/ukrainian-law-service.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Ukrainian Law Service
 * Provides legal references and context for Ukrainian jurisdiction
 * 
 * UPDATED: Added getAllLaws() method for generation-prompts integration
 */

import NodeCache from 'node-cache';

const lawCache = new NodeCache({ stdTTL: 86400 * 7 }); // Cache 7 days

// ==========================================
// COMMON UKRAINIAN LAWS (Hardcoded for MVP)
// ==========================================

interface LawInfo {
  fullName: string;
  code: string;
  url: string;
  keyArticles?: Record<string, string>;
}

const COMMON_LAWS: Record<string, LawInfo> = {
  'Ð¦ÐšÐ£': {
    fullName: 'Ð¦Ð¸Ð²Ñ–Ð»ÑŒÐ½Ð¸Ð¹ ÐºÐ¾Ð´ÐµÐºÑ Ð£ÐºÑ€Ð°Ñ—Ð½Ð¸',
    code: 'Ð¦ÐšÐ£',
    url: 'https://zakon.rada.gov.ua/laws/show/435-15',
    keyArticles: {
      '11': 'Ð¦Ð¸Ð²Ñ–Ð»ÑŒÐ½Ð° Ð¿Ñ€Ð°Ð²Ð¾Ð·Ð´Ð°Ñ‚Ð½Ñ–ÑÑ‚ÑŒ',
      '202': 'ÐŸÑ€Ð°Ð²Ð¾Ñ‡Ð¸Ð½',
      '203': 'Ð’Ð¸Ð´Ð¸ Ð¿Ñ€Ð°Ð²Ð¾Ñ‡Ð¸Ð½Ñ–Ð²',
      '215': 'ÐÐµÐ´Ñ–Ð¹ÑÐ½Ð¸Ð¹ Ð¿Ñ€Ð°Ð²Ð¾Ñ‡Ð¸Ð½',
      '626': 'Ð”Ð¾Ð³Ð¾Ð²Ñ–Ñ€ (Ð¿Ð¾Ð½ÑÑ‚Ñ‚Ñ)',
      '627': 'Ð—Ð¼Ñ–ÑÑ‚ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
      '628': 'Ð¡Ð²Ð¾Ð±Ð¾Ð´Ð° Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
      '638': 'Ð†ÑÑ‚Ð¾Ñ‚Ð½Ñ– ÑƒÐ¼Ð¾Ð²Ð¸ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
      '651': 'Ð¤Ð¾Ñ€Ð¼Ð° Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
      '526': 'Ð’Ð¸ÐºÐ¾Ð½Ð°Ð½Ð½Ñ Ð·Ð¾Ð±Ð¾Ð²\'ÑÐ·Ð°Ð½Ð½Ñ',
      '610': 'Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð»ÑŒÐ½Ñ–ÑÑ‚ÑŒ Ð·Ð° Ð½ÐµÐ²Ð¸ÐºÐ¾Ð½Ð°Ð½Ð½Ñ',
      '1212': 'Ð’Ñ–Ð´ÑˆÐºÐ¾Ð´ÑƒÐ²Ð°Ð½Ð½Ñ Ð¼Ð¾Ñ€Ð°Ð»ÑŒÐ½Ð¾Ñ— ÑˆÐºÐ¾Ð´Ð¸',
    },
  },
  
  'Ð“ÐšÐ£': {
    fullName: 'Ð“Ð¾ÑÐ¿Ð¾Ð´Ð°Ñ€ÑÑŒÐºÐ¸Ð¹ ÐºÐ¾Ð´ÐµÐºÑ Ð£ÐºÑ€Ð°Ñ—Ð½Ð¸',
    code: 'Ð“ÐšÐ£',
    url: 'https://zakon.rada.gov.ua/laws/show/436-15',
    keyArticles: {
      '173': 'Ð“Ð¾ÑÐ¿Ð¾Ð´Ð°Ñ€ÑÑŒÐºÐ¸Ð¹ Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€',
      '174': 'Ð’Ð¸Ð¼Ð¾Ð³Ð¸ Ð´Ð¾ Ð·Ð¼Ñ–ÑÑ‚Ñƒ Ð³Ð¾ÑÐ¿Ð¾Ð´Ð°Ñ€ÑÑŒÐºÐ¾Ð³Ð¾ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
      '181': 'Ð—Ð¼Ñ–ÑÑ‚ Ð³Ð¾ÑÐ¿Ð¾Ð´Ð°Ñ€ÑÑŒÐºÐ¾Ð³Ð¾ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
      '193': 'Ð—Ð¼Ñ–Ð½Ð° Ñ‚Ð° Ñ€Ð¾Ð·Ñ–Ñ€Ð²Ð°Ð½Ð½Ñ Ð³Ð¾ÑÐ¿Ð¾Ð´Ð°Ñ€ÑÑŒÐºÐ¾Ð³Ð¾ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
      '230': 'Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð»ÑŒÐ½Ñ–ÑÑ‚ÑŒ ÑÑƒÐ±\'Ñ”ÐºÑ‚Ñ–Ð² Ð³Ð¾ÑÐ¿Ð¾Ð´Ð°Ñ€ÑŽÐ²Ð°Ð½Ð½Ñ',
    },
  },
  
  'ÐšÐ—Ð¿ÐŸ': {
    fullName: 'ÐšÐ¾Ð´ÐµÐºÑ Ð·Ð°ÐºÐ¾Ð½Ñ–Ð² Ð¿Ñ€Ð¾ Ð¿Ñ€Ð°Ñ†ÑŽ Ð£ÐºÑ€Ð°Ñ—Ð½Ð¸',
    code: 'ÐšÐ—Ð¿ÐŸ',
    url: 'https://zakon.rada.gov.ua/laws/show/322-08',
    keyArticles: {
      '21': 'Ð¢Ñ€ÑƒÐ´Ð¾Ð²Ð¸Ð¹ Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€',
      '24': 'Ð¡Ñ‚Ñ€Ð¾ÐºÐ¾Ð²Ð¸Ð¹ Ñ‚Ñ€ÑƒÐ´Ð¾Ð²Ð¸Ð¹ Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€',
      '36': 'ÐŸÑ–Ð´ÑÑ‚Ð°Ð²Ð¸ Ð¿Ñ€Ð¸Ð¿Ð¸Ð½ÐµÐ½Ð½Ñ Ñ‚Ñ€ÑƒÐ´Ð¾Ð²Ð¾Ð³Ð¾ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
      '38': 'Ð Ð¾Ð·Ñ–Ñ€Ð²Ð°Ð½Ð½Ñ Ð·Ð° Ñ–Ð½Ñ–Ñ†Ñ–Ð°Ñ‚Ð¸Ð²Ð¾ÑŽ Ð¿Ñ€Ð°Ñ†Ñ–Ð²Ð½Ð¸ÐºÐ°',
      '40': 'Ð Ð¾Ð·Ñ–Ñ€Ð²Ð°Ð½Ð½Ñ Ð·Ð° Ñ–Ð½Ñ–Ñ†Ñ–Ð°Ñ‚Ð¸Ð²Ð¾ÑŽ Ð²Ð»Ð°ÑÐ½Ð¸ÐºÐ°',
      '94': 'ÐÐ¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð° Ñ‚Ñ€Ð¸Ð²Ð°Ð»Ñ–ÑÑ‚ÑŒ Ñ€Ð¾Ð±Ð¾Ñ‡Ð¾Ð³Ð¾ Ñ‡Ð°ÑÑƒ',
      '115': 'Ð©Ð¾Ñ€Ñ–Ñ‡Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ð½Ð° Ð²Ñ–Ð´Ð¿ÑƒÑÑ‚ÐºÐ°',
    },
  },
  
  'Ð—Ð£_ÐŸÐ”Ð’': {
    fullName: 'Ð—Ð°ÐºÐ¾Ð½ Ð£ÐºÑ€Ð°Ñ—Ð½Ð¸ "ÐŸÑ€Ð¾ Ð¿Ð¾Ð´Ð°Ñ‚Ð¾Ðº Ð½Ð° Ð´Ð¾Ð´Ð°Ð½Ñƒ Ð²Ð°Ñ€Ñ‚Ñ–ÑÑ‚ÑŒ"',
    code: 'ÐŸÐ”Ð’',
    url: 'https://zakon.rada.gov.ua/laws/show/168/97-%D0%B2%D1%80',
    keyArticles: {
      '1': 'Ð’Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ Ñ‚ÐµÑ€Ð¼Ñ–Ð½Ñ–Ð²',
      '3': 'ÐžÐ±\'Ñ”ÐºÑ‚ Ð¾Ð¿Ð¾Ð´Ð°Ñ‚ÐºÑƒÐ²Ð°Ð½Ð½Ñ',
      '7': 'Ð¡Ñ‚Ð°Ð²ÐºÐ¸ Ð¿Ð¾Ð´Ð°Ñ‚ÐºÑƒ',
    },
  },
};

// ==========================================
// Ð”Ð¡Ð¢Ð£ DOCUMENT STANDARDS
// ==========================================

export const DSTU_STRUCTURE = {
  sections: [
    '1. ÐŸÐ Ð•Ð”ÐœÐ•Ð¢ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£',
    '2. Ð’ÐÐ Ð¢Ð†Ð¡Ð¢Ð¬ Ð¢Ð ÐŸÐžÐ Ð¯Ð”ÐžÐš Ð ÐžÐ—Ð ÐÐ¥Ð£ÐÐšÐ†Ð’',
    '3. ÐŸÐ ÐÐ’Ð Ð¢Ð ÐžÐ‘ÐžÐ’\'Ð¯Ð—ÐšÐ˜ Ð¡Ð¢ÐžÐ Ð†Ð',
    '4. Ð’Ð†Ð”ÐŸÐžÐ’Ð†Ð”ÐÐ›Ð¬ÐÐ†Ð¡Ð¢Ð¬ Ð¡Ð¢ÐžÐ Ð†Ð',
    '5. Ð¡Ð¢Ð ÐžÐš Ð”Ð†Ð‡ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£',
    '6. Ð¤ÐžÐ Ð¡-ÐœÐÐ–ÐžÐ ÐÐ† ÐžÐ‘Ð¡Ð¢ÐÐ’Ð˜ÐÐ˜',
    '7. ÐŸÐžÐ Ð¯Ð”ÐžÐš Ð’Ð˜Ð Ð†Ð¨Ð•ÐÐÐ¯ Ð¡ÐŸÐžÐ Ð†Ð’',
    '8. Ð†ÐÐ¨Ð† Ð£ÐœÐžÐ’Ð˜',
    '9. Ð®Ð Ð˜Ð”Ð˜Ð§ÐÐ† ÐÐ”Ð Ð•Ð¡Ð˜ Ð¢Ð Ð Ð•ÐšÐ’Ð†Ð—Ð˜Ð¢Ð˜ Ð¡Ð¢ÐžÐ Ð†Ð',
    '10. ÐŸÐ†Ð”ÐŸÐ˜Ð¡Ð˜ Ð¡Ð¢ÐžÐ Ð†Ð',
  ],
  
  dateFormat: 'Ð”Ð”.ÐœÐœ.Ð Ð Ð Ð ', // 01.02.2025, not Feb 1, 2025
  
  currencyFormat: '10 000 (Ð´ÐµÑÑÑ‚ÑŒ Ñ‚Ð¸ÑÑÑ‡) Ð³Ñ€Ð¸Ð²ÐµÐ½ÑŒ 00 ÐºÐ¾Ð¿Ñ–Ð¹Ð¾Ðº',
  
  parties: {
    standard: ['Ð—Ð°Ð¼Ð¾Ð²Ð½Ð¸Ðº', 'Ð’Ð¸ÐºÐ¾Ð½Ð°Ð²ÐµÑ†ÑŒ'],
    employment: ['Ð Ð¾Ð±Ð¾Ñ‚Ð¾Ð´Ð°Ð²ÐµÑ†ÑŒ', 'ÐŸÑ€Ð°Ñ†Ñ–Ð²Ð½Ð¸Ðº'],
    vendor: ['ÐŸÐ¾ÐºÑƒÐ¿ÐµÑ†ÑŒ', 'ÐŸÑ€Ð¾Ð´Ð°Ð²ÐµÑ†ÑŒ'],
  },
};

// ==========================================
// UKRAINIAN LAW SERVICE
// ==========================================

export class UkrainianLawService {
  
  /**
   * Get law reference with optional article
   */
  getLawReference(
    lawCode: keyof typeof COMMON_LAWS,
    article?: string
  ): string {
    const law = COMMON_LAWS[lawCode];
    
    if (!law) {
      return `Ð—Ð°ÐºÐ¾Ð½ "${lawCode}"`;
    }
    
    if (article && law.keyArticles?.[article]) {
      return `${law.code}, ÑÑ‚Ð°Ñ‚Ñ‚Ñ ${article} "${law.keyArticles[article]}"`;
    }
    
    return `${law.fullName} (${law.code})`;
  }
  
  /**
   * Get full law info
   */
  getLawInfo(lawCode: keyof typeof COMMON_LAWS): LawInfo | null {
    return COMMON_LAWS[lawCode] || null;
  }
  
  /**
   * Get ALL laws (NEW - for generation-prompts integration)
   */
  getAllLaws(): Record<string, LawInfo> {
    return COMMON_LAWS;
  }
  
  /**
   * Get all applicable laws for document type
   */
  getApplicableLaws(documentType: string): LawInfo[] {
    const laws: LawInfo[] = [];
    
    // Always include Civil Code
    laws.push(COMMON_LAWS['Ð¦ÐšÐ£']);
    
    // Add specific laws based on type
    if (documentType.includes('employment') || documentType.includes('Ñ‚Ñ€ÑƒÐ´Ð¾Ð²')) {
      laws.push(COMMON_LAWS['ÐšÐ—Ð¿ÐŸ']);
    }
    
    if (documentType.includes('commercial') || documentType.includes('Ð³Ð¾ÑÐ¿Ð¾Ð´Ð°Ñ€ÑÑŒÐº')) {
      laws.push(COMMON_LAWS['Ð“ÐšÐ£']);
    }
    
    if (documentType.includes('vat') || documentType.includes('Ð¿Ð´Ð²')) {
      laws.push(COMMON_LAWS['Ð—Ð£_ÐŸÐ”Ð’']);
    }
    
    return laws;
  }
  
  /**
   * Generate legal context for LLM prompt
   */
  async getLegalContext(documentType: string): Promise<string> {
    const applicableLaws = this.getApplicableLaws(documentType);
    
    let context = 'Ð—ÐÐ¡Ð¢ÐžÐ¡ÐžÐ’ÐÐÐ• Ð—ÐÐšÐžÐÐžÐ”ÐÐ’Ð¡Ð¢Ð’Ðž Ð£ÐšÐ ÐÐ‡ÐÐ˜:\n\n';
    
    for (const law of applicableLaws) {
      context += `${law.fullName} (${law.code}):\n`;
      context += `Ð”Ð¶ÐµÑ€ÐµÐ»Ð¾: ${law.url}\n`;
      
      if (law.keyArticles) {
        context += 'ÐšÐ»ÑŽÑ‡Ð¾Ð²Ñ– ÑÑ‚Ð°Ñ‚Ñ‚Ñ–:\n';
        for (const [article, description] of Object.entries(law.keyArticles)) {
          context += `  - Ð¡Ñ‚Ð°Ñ‚Ñ‚Ñ ${article}: ${description}\n`;
        }
      }
      
      context += '\n';
    }
    
    return context;
  }
  
  /**
   * Validate contract section against Ukrainian law
   */
  validateSection(sectionContent: string, lawCode: string, article: string): {
    valid: boolean;
    issues: string[];
  } {
    // TODO: Implement actual validation logic
    // For MVP, just return valid
    return {
      valid: true,
      issues: [],
    };
  }
  
  /**
   * Search for relevant law articles by keyword
   */
  searchArticles(keyword: string): Array<{
    lawCode: string;
    article: string;
    description: string;
  }> {
    const results: Array<{
      lawCode: string;
      article: string;
      description: string;
    }> = [];
    
    const lowerKeyword = keyword.toLowerCase();
    
    for (const [code, law] of Object.entries(COMMON_LAWS)) {
      if (law.keyArticles) {
        for (const [article, description] of Object.entries(law.keyArticles)) {
          if (description.toLowerCase().includes(lowerKeyword)) {
            results.push({
              lawCode: code,
              article,
              description,
            });
          }
        }
      }
    }
    
    return results;
  }
}

// Export singleton instance
export const ukrainianLawService = new UkrainianLawService();


================================================================================
19. Ð”Ð¡Ð¢Ð£ SERVICE (NEW)
================================================================================
FILE: packages/legal-council/services/dstu-service.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * Ð”Ð¡Ð¢Ð£ 4163-2020 Service
 * Ukrainian document formatting standards and requirements
 */

export interface DstuRequirement {
  section: string;
  requirement: string;
  mandatory: boolean;
  description: string;
}

export interface DocumentTemplate {
  documentType: string;
  requiredSections: string[];
  requiredRequisites: string[];
  dstuReference: string;
}

/**
 * Ð”Ð¡Ð¢Ð£ 4163-2020: Ð”Ñ–Ð»Ð¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð¹ Ð°Ñ€Ñ…Ñ–Ð²Ð½Ð° ÑÐ¿Ñ€Ð°Ð²Ð°. Ð¢ÐµÑ€Ð¼Ñ–Ð½Ð¸ Ñ‚Ð° Ð²Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ
 * Document structure and formatting requirements
 */
export const DSTU_REQUIREMENTS: DstuRequirement[] = [
  // Ð—Ð°Ð³Ð°Ð»ÑŒÐ½Ñ– Ð²Ð¸Ð¼Ð¾Ð³Ð¸ Ð´Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ–Ð²
  {
    section: 'Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñƒ',
    requirement: 'ÐÐ°Ð·Ð²Ð° Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñƒ',
    mandatory: true,
    description: 'ÐšÐ¾Ð¶ÐµÐ½ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð¼Ð°Ñ‚Ð¸ Ñ‡Ñ–Ñ‚ÐºÑƒ Ð½Ð°Ð·Ð²Ñƒ (Ð”ÐžÐ“ÐžÐ’Ð†Ð , ÐšÐžÐÐ¢Ð ÐÐšÐ¢ Ñ‚Ð¾Ñ‰Ð¾)',
  },
  {
    section: 'Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñƒ',
    requirement: 'Ð”Ð°Ñ‚Ð° ÑÐºÐ»Ð°Ð´Ð°Ð½Ð½Ñ',
    mandatory: true,
    description: 'Ð”Ð°Ñ‚Ð° Ñƒ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ– "[Ð”Ð•ÐÐ¬] [ÐœÐ†Ð¡Ð¯Ð¦Ð¬] [Ð Ð†Ðš] Ñ€Ð¾ÐºÑƒ" (Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, "15 Ð»ÑŽÑ‚Ð¾Ð³Ð¾ 2026 Ñ€Ð¾ÐºÑƒ")',
  },
  {
    section: 'Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñƒ',
    requirement: 'Ð ÐµÑ”ÑÑ‚Ñ€Ð°Ñ†Ñ–Ð¹Ð½Ð¸Ð¹ Ð½Ð¾Ð¼ÐµÑ€',
    mandatory: true,
    description: 'Ð£Ð½Ñ–ÐºÐ°Ð»ÑŒÐ½Ð¸Ð¹ Ð½Ð¾Ð¼ÐµÑ€ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñƒ (Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, "â„– 123-Ð”Ð“")',
  },
  {
    section: 'Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñƒ',
    requirement: 'ÐœÑ–ÑÑ†Ðµ ÑÐºÐ»Ð°Ð´Ð°Ð½Ð½Ñ',
    mandatory: false,
    description: 'ÐÐ°ÑÐµÐ»ÐµÐ½Ð¸Ð¹ Ð¿ÑƒÐ½ÐºÑ‚ Ð´Ðµ ÑƒÐºÐ»Ð°Ð´Ð°Ñ”Ñ‚ÑŒÑÑ Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€ (Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, "Ð¼. ÐšÐ¸Ñ—Ð²")',
  },
  
  // ÐŸÑ€ÐµÐ°Ð¼Ð±ÑƒÐ»Ð°
  {
    section: 'ÐŸÑ€ÐµÐ°Ð¼Ð±ÑƒÐ»Ð°',
    requirement: 'ÐŸÐ¾Ð²Ð½Ð° Ð½Ð°Ð·Ð²Ð° ÑÑ‚Ð¾Ñ€Ñ–Ð½',
    mandatory: true,
    description: 'ÐŸÐ¾Ð²Ð½Ðµ Ð½Ð°Ð¹Ð¼ÐµÐ½ÑƒÐ²Ð°Ð½Ð½Ñ ÑŽÑ€Ð¸Ð´Ð¸Ñ‡Ð½Ð¸Ñ… Ð¾ÑÑ–Ð± Ð°Ð±Ð¾ ÐŸÐ†Ð‘ Ñ„Ñ–Ð·Ð¸Ñ‡Ð½Ð¸Ñ… Ð¾ÑÑ–Ð±',
  },
  {
    section: 'ÐŸÑ€ÐµÐ°Ð¼Ð±ÑƒÐ»Ð°',
    requirement: 'ÐŸÑ€Ð°Ð²Ð¾Ð²Ð° Ñ„Ð¾Ñ€Ð¼Ð°',
    mandatory: true,
    description: 'Ð¢ÐžÐ’, Ð¤ÐžÐŸ, ÐÐ¢, Ð¤Ñ–Ð·Ð¸Ñ‡Ð½Ð° Ð¾ÑÐ¾Ð±Ð° Ñ‚Ð¾Ñ‰Ð¾',
  },
  {
    section: 'ÐŸÑ€ÐµÐ°Ð¼Ð±ÑƒÐ»Ð°',
    requirement: 'ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²Ð½Ð¸ÐºÐ¸ ÑÑ‚Ð¾Ñ€Ñ–Ð½',
    mandatory: true,
    description: 'ÐŸÐ†Ð‘ Ñ‚Ð° Ð¿Ð¾ÑÐ°Ð´Ð° Ð¾ÑÐ¾Ð±Ð¸, ÑÐºÐ° Ð¿Ñ–Ð´Ð¿Ð¸ÑÑƒÑ” Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€',
  },
  {
    section: 'ÐŸÑ€ÐµÐ°Ð¼Ð±ÑƒÐ»Ð°',
    requirement: 'ÐŸÑ–Ð´ÑÑ‚Ð°Ð²Ð° Ð´Ñ–Ð¹',
    mandatory: true,
    description: 'Ð¡Ñ‚Ð°Ñ‚ÑƒÑ‚, ÐŸÐ¾Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ, Ð”Ð¾Ñ€ÑƒÑ‡ÐµÐ½Ð½Ñ Ñ‚Ð¾Ñ‰Ð¾',
  },
  {
    section: 'ÐŸÑ€ÐµÐ°Ð¼Ð±ÑƒÐ»Ð°',
    requirement: 'Ð£Ð¼Ð¾Ð²Ð½Ñ– Ð½Ð°Ð·Ð²Ð¸ ÑÑ‚Ð¾Ñ€Ñ–Ð½',
    mandatory: true,
    description: 'Ð†Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ñ– Ð½Ð°Ð´Ð°Ð»Ñ– "Ð—Ð°Ð¼Ð¾Ð²Ð½Ð¸Ðº" Ñ‚Ð° "Ð’Ð¸ÐºÐ¾Ð½Ð°Ð²ÐµÑ†ÑŒ" Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ð¾',
  },
  
  // ÐžÑÐ½Ð¾Ð²Ð½Ð¸Ð¹ Ñ‚ÐµÐºÑÑ‚
  {
    section: 'ÐŸÑ€ÐµÐ´Ð¼ÐµÑ‚ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
    requirement: 'Ð§Ñ–Ñ‚ÐºÐµ Ð²Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ñƒ',
    mandatory: true,
    description: 'Ð—Ð³Ñ–Ð´Ð½Ð¾ Ð¦ÐšÐ£ ÑÑ‚. 638 - Ñ–ÑÑ‚Ð¾Ñ‚Ð½Ð° ÑƒÐ¼Ð¾Ð²Ð° Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
  },
  {
    section: 'ÐŸÑ€Ð°Ð²Ð° Ñ‚Ð° Ð¾Ð±Ð¾Ð²\'ÑÐ·ÐºÐ¸',
    requirement: 'ÐŸÑ€Ð°Ð²Ð° ÑÑ‚Ð¾Ñ€Ñ–Ð½',
    mandatory: true,
    description: 'ÐŸÐµÑ€ÐµÐ»Ñ–Ðº Ð¿Ñ€Ð°Ð² ÐºÐ¾Ð¶Ð½Ð¾Ñ— ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð¸ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
  },
  {
    section: 'ÐŸÑ€Ð°Ð²Ð° Ñ‚Ð° Ð¾Ð±Ð¾Ð²\'ÑÐ·ÐºÐ¸',
    requirement: 'ÐžÐ±Ð¾Ð²\'ÑÐ·ÐºÐ¸ ÑÑ‚Ð¾Ñ€Ñ–Ð½',
    mandatory: true,
    description: 'ÐŸÐµÑ€ÐµÐ»Ñ–Ðº Ð¾Ð±Ð¾Ð²\'ÑÐ·ÐºÑ–Ð² ÐºÐ¾Ð¶Ð½Ð¾Ñ— ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð¸ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ',
  },
  {
    section: 'Ð’Ð°Ñ€Ñ‚Ñ–ÑÑ‚ÑŒ Ñ‚Ð° Ñ€Ð¾Ð·Ñ€Ð°Ñ…ÑƒÐ½ÐºÐ¸',
    requirement: 'Ð’Ð°Ñ€Ñ‚Ñ–ÑÑ‚ÑŒ/Ñ†Ñ–Ð½Ð°',
    mandatory: true,
    description: 'Ð—Ð³Ñ–Ð´Ð½Ð¾ Ð¦ÐšÐ£ ÑÑ‚. 632 - Ñ–ÑÑ‚Ð¾Ñ‚Ð½Ð° ÑƒÐ¼Ð¾Ð²Ð° Ð´Ð»Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ð½Ð¸Ñ… Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñ–Ð²',
  },
  {
    section: 'Ð’Ð°Ñ€Ñ‚Ñ–ÑÑ‚ÑŒ Ñ‚Ð° Ñ€Ð¾Ð·Ñ€Ð°Ñ…ÑƒÐ½ÐºÐ¸',
    requirement: 'ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ð¾Ð¿Ð»Ð°Ñ‚Ð¸',
    mandatory: true,
    description: 'Ð¢ÐµÑ€Ð¼Ñ–Ð½Ð¸, ÑÐ¿Ð¾ÑÑ–Ð±, Ñ€ÐµÐºÐ²Ñ–Ð·Ð¸Ñ‚Ð¸ Ð´Ð»Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ð¸',
  },
  {
    section: 'Ð¡Ñ‚Ñ€Ð¾Ðº Ð´Ñ–Ñ—',
    requirement: 'Ð”Ð°Ñ‚Ð° Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ð´Ñ–Ñ—',
    mandatory: true,
    description: 'Ð— ÑÐºÐ¾Ñ— Ð´Ð°Ñ‚Ð¸ Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€ Ð½Ð°Ð±ÑƒÐ²Ð°Ñ” Ñ‡Ð¸Ð½Ð½Ð¾ÑÑ‚Ñ–',
  },
  {
    section: 'Ð¡Ñ‚Ñ€Ð¾Ðº Ð´Ñ–Ñ—',
    requirement: 'Ð”Ð°Ñ‚Ð° Ð·Ð°ÐºÑ–Ð½Ñ‡ÐµÐ½Ð½Ñ Ð°Ð±Ð¾ ÑƒÐ¼Ð¾Ð²Ð¸',
    mandatory: true,
    description: 'Ð”Ð¾ ÑÐºÐ¾Ñ— Ð´Ð°Ñ‚Ð¸ Ð´Ñ–Ñ” Ð°Ð±Ð¾ ÑƒÐ¼Ð¾Ð²Ð¸ Ð¿Ñ€Ð¸Ð¿Ð¸Ð½ÐµÐ½Ð½Ñ',
  },
  {
    section: 'Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð»ÑŒÐ½Ñ–ÑÑ‚ÑŒ',
    requirement: 'Ð¡Ð°Ð½ÐºÑ†Ñ–Ñ— Ð·Ð° Ð¿Ð¾Ñ€ÑƒÑˆÐµÐ½Ð½Ñ',
    mandatory: true,
    description: 'Ð¨Ñ‚Ñ€Ð°Ñ„Ð¸, Ð¿ÐµÐ½Ñ, Ð½ÐµÑƒÑÑ‚Ð¾Ð¹ÐºÐ° Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ð¾ Ð´Ð¾ Ð¦ÐšÐ£',
  },
  {
    section: 'Ð’Ð¸Ñ€Ñ–ÑˆÐµÐ½Ð½Ñ ÑÐ¿Ð¾Ñ€Ñ–Ð²',
    requirement: 'ÐŸÑ€ÐµÑ‚ÐµÐ½Ð·Ñ–Ð¹Ð½Ð¸Ð¹ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº',
    mandatory: true,
    description: 'ÐžÐ±Ð¾Ð²\'ÑÐ·ÐºÐ¾Ð²Ð¸Ð¹ Ð´Ð»Ñ Ð³Ð¾ÑÐ¿Ð¾Ð´Ð°Ñ€ÑÑŒÐºÐ¸Ñ… Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñ–Ð²',
  },
  {
    section: 'Ð’Ð¸Ñ€Ñ–ÑˆÐµÐ½Ð½Ñ ÑÐ¿Ð¾Ñ€Ñ–Ð²',
    requirement: 'ÐŸÑ–Ð´ÑÑƒÐ´Ð½Ñ–ÑÑ‚ÑŒ',
    mandatory: true,
    description: 'Ð¯ÐºÐ¸Ð¹ ÑÑƒÐ´ Ñ€Ð¾Ð·Ð³Ð»ÑÐ´Ð°Ñ” ÑÐ¿Ð¾Ñ€Ð¸ (Ð³Ð¾ÑÐ¿Ð¾Ð´Ð°Ñ€ÑÑŒÐºÐ¸Ð¹/Ñ†Ð¸Ð²Ñ–Ð»ÑŒÐ½Ð¸Ð¹)',
  },
  
  // ÐŸÑ–Ð´Ð¿Ð¸ÑÐ¸
  {
    section: 'Ð ÐµÐºÐ²Ñ–Ð·Ð¸Ñ‚Ð¸ Ñ‚Ð° Ð¿Ñ–Ð´Ð¿Ð¸ÑÐ¸',
    requirement: 'ÐŸÐ¾Ð²Ð½Ñ– Ñ€ÐµÐºÐ²Ñ–Ð·Ð¸Ñ‚Ð¸ ÑÑ‚Ð¾Ñ€Ñ–Ð½',
    mandatory: true,
    description: 'ÐÐ´Ñ€ÐµÑÐ°, Ð„Ð”Ð ÐŸÐžÐ£/Ð ÐÐžÐšÐŸÐŸ, Ñ€/Ñ€, Ð±Ð°Ð½Ðº, ÐœÐ¤Ðž',
  },
  {
    section: 'Ð ÐµÐºÐ²Ñ–Ð·Ð¸Ñ‚Ð¸ Ñ‚Ð° Ð¿Ñ–Ð´Ð¿Ð¸ÑÐ¸',
    requirement: 'ÐŸÑ–Ð´Ð¿Ð¸ÑÐ¸',
    mandatory: true,
    description: 'ÐŸÐ¾ÑÐ°Ð´Ð°, ÐŸÐ†Ð‘, Ð¿Ñ–Ð´Ð¿Ð¸Ñ ÑƒÐ¿Ð¾Ð²Ð½Ð¾Ð²Ð°Ð¶ÐµÐ½Ð¸Ñ… Ð¾ÑÑ–Ð±',
  },
  {
    section: 'Ð ÐµÐºÐ²Ñ–Ð·Ð¸Ñ‚Ð¸ Ñ‚Ð° Ð¿Ñ–Ð´Ð¿Ð¸ÑÐ¸',
    requirement: 'ÐŸÐµÑ‡Ð°Ñ‚ÐºÐ¸',
    mandatory: false,
    description: 'ÐŸÐµÑ‡Ð°Ñ‚ÐºÐ¸ ÑŽÑ€Ð¸Ð´Ð¸Ñ‡Ð½Ð¸Ñ… Ð¾ÑÑ–Ð± (ÑÐºÑ‰Ð¾ Ñ”)',
  },
];

/**
 * Document templates by type
 */
export const DOCUMENT_TEMPLATES: DocumentTemplate[] = [
  {
    documentType: 'Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€_ÐºÑƒÐ¿Ñ–Ð²Ð»Ñ–_Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ñƒ',
    requiredSections: [
      '1. ÐŸÐ Ð•Ð”ÐœÐ•Ð¢ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£',
      '2. Ð¦Ð†ÐÐ Ð¢Ð ÐŸÐžÐ Ð¯Ð”ÐžÐš Ð ÐžÐ—Ð ÐÐ¥Ð£ÐÐšÐ†Ð’',
      '3. Ð¡Ð¢Ð ÐžÐšÐ˜ ÐŸÐ•Ð Ð•Ð”ÐÐ§Ð† Ð¢ÐžÐ’ÐÐ Ð£',
      '4. Ð¯ÐšÐ†Ð¡Ð¢Ð¬ Ð¢ÐžÐ’ÐÐ Ð£ Ð¢Ð Ð“ÐÐ ÐÐÐ¢Ð†Ð‡',
      '5. ÐŸÐ ÐÐ’Ð Ð¢Ð ÐžÐ‘ÐžÐ’\'Ð¯Ð—ÐšÐ˜ Ð¡Ð¢ÐžÐ Ð†Ð',
      '6. Ð’Ð†Ð”ÐŸÐžÐ’Ð†Ð”ÐÐ›Ð¬ÐÐ†Ð¡Ð¢Ð¬ Ð¡Ð¢ÐžÐ Ð†Ð',
      '7. ÐŸÐžÐ Ð¯Ð”ÐžÐš Ð’Ð˜Ð Ð†Ð¨Ð•ÐÐÐ¯ Ð¡ÐŸÐžÐ Ð†Ð’',
      '8. Ð¤ÐžÐ Ð¡-ÐœÐÐ–ÐžÐ ',
      '9. Ð¡Ð¢Ð ÐžÐš Ð”Ð†Ð‡ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£',
      '10. Ð—ÐÐšÐ›Ð®Ð§ÐÐ† ÐŸÐžÐ›ÐžÐ–Ð•ÐÐÐ¯',
      '11. Ð Ð•ÐšÐ’Ð†Ð—Ð˜Ð¢Ð˜ Ð¢Ð ÐŸÐ†Ð”ÐŸÐ˜Ð¡Ð˜ Ð¡Ð¢ÐžÐ Ð†Ð',
    ],
    requiredRequisites: [
      'Ð”Ð°Ñ‚Ð°',
      'ÐÐ¾Ð¼ÐµÑ€',
      'ÐœÑ–ÑÑ†Ðµ ÑƒÐºÐ»Ð°Ð´ÐµÐ½Ð½Ñ',
      'Ð¡Ñ‚Ð¾Ñ€Ð¾Ð½Ð¸',
      'ÐŸÑ€ÐµÐ´Ð¼ÐµÑ‚',
      'Ð¦Ñ–Ð½Ð°',
      'ÐŸÑ–Ð´Ð¿Ð¸ÑÐ¸',
    ],
    dstuReference: 'Ð”Ð¡Ð¢Ð£ 4163-2020, Ð¦ÐšÐ£ ÑÑ‚. 700-717',
  },
  {
    documentType: 'Ñ‚Ñ€ÑƒÐ´Ð¾Ð²Ð¸Ð¹_Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€',
    requiredSections: [
      '1. Ð—ÐÐ“ÐÐ›Ð¬ÐÐ† ÐŸÐžÐ›ÐžÐ–Ð•ÐÐÐ¯',
      '2. ÐŸÐ ÐÐ’Ð Ð¢Ð ÐžÐ‘ÐžÐ’\'Ð¯Ð—ÐšÐ˜ ÐŸÐ ÐÐ¦Ð†Ð’ÐÐ˜ÐšÐ',
      '3. ÐŸÐ ÐÐ’Ð Ð¢Ð ÐžÐ‘ÐžÐ’\'Ð¯Ð—ÐšÐ˜ Ð ÐžÐ‘ÐžÐ¢ÐžÐ”ÐÐ’Ð¦Ð¯',
      '4. ÐžÐŸÐ›ÐÐ¢Ð ÐŸÐ ÐÐ¦Ð†',
      '5. Ð Ð•Ð–Ð˜Ðœ Ð ÐžÐ‘ÐžÐ¢Ð˜ Ð¢Ð Ð’Ð†Ð”ÐŸÐžÐ§Ð˜ÐÐšÐ£',
      '6. Ð’Ð†Ð”ÐŸÐžÐ’Ð†Ð”ÐÐ›Ð¬ÐÐ†Ð¡Ð¢Ð¬ Ð¡Ð¢ÐžÐ Ð†Ð',
      '7. Ð¡Ð¢Ð ÐžÐš Ð”Ð†Ð‡ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£',
      '8. ÐŸÐ†Ð”Ð¡Ð¢ÐÐ’Ð˜ ÐŸÐ Ð˜ÐŸÐ˜ÐÐ•ÐÐÐ¯ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£',
      '9. Ð—ÐÐšÐ›Ð®Ð§ÐÐ† ÐŸÐžÐ›ÐžÐ–Ð•ÐÐÐ¯',
      '10. Ð Ð•ÐšÐ’Ð†Ð—Ð˜Ð¢Ð˜ Ð¢Ð ÐŸÐ†Ð”ÐŸÐ˜Ð¡Ð˜ Ð¡Ð¢ÐžÐ Ð†Ð',
    ],
    requiredRequisites: [
      'Ð”Ð°Ñ‚Ð°',
      'ÐÐ¾Ð¼ÐµÑ€',
      'ÐœÑ–ÑÑ†Ðµ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸',
      'ÐŸÐ¾ÑÐ°Ð´Ð°',
      'Ð”Ð°Ñ‚Ð° Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸',
      'Ð—Ð°Ñ€Ð¾Ð±Ñ–Ñ‚Ð½Ð° Ð¿Ð»Ð°Ñ‚Ð°',
      'ÐŸÑ–Ð´Ð¿Ð¸ÑÐ¸',
    ],
    dstuReference: 'Ð”Ð¡Ð¢Ð£ 4163-2020, ÐšÐ—Ð¿ÐŸ ÑÑ‚. 21-24',
  },
  {
    documentType: 'Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€_Ð¾Ñ€ÐµÐ½Ð´Ð¸',
    requiredSections: [
      '1. ÐŸÐ Ð•Ð”ÐœÐ•Ð¢ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£',
      '2. Ð¡Ð¢Ð ÐžÐš ÐžÐ Ð•ÐÐ”Ð˜',
      '3. ÐžÐ Ð•ÐÐ”ÐÐ ÐŸÐ›ÐÐ¢Ð Ð¢Ð ÐŸÐžÐ Ð¯Ð”ÐžÐš Ð ÐžÐ—Ð ÐÐ¥Ð£ÐÐšÐ†Ð’',
      '4. ÐŸÐ ÐÐ’Ð Ð¢Ð ÐžÐ‘ÐžÐ’\'Ð¯Ð—ÐšÐ˜ ÐžÐ Ð•ÐÐ”ÐÐ Ð¯',
      '5. ÐŸÐ ÐÐ’Ð Ð¢Ð ÐžÐ‘ÐžÐ’\'Ð¯Ð—ÐšÐ˜ ÐžÐ Ð•ÐÐ”ÐžÐ”ÐÐ’Ð¦Ð¯',
      '6. Ð’Ð†Ð”ÐŸÐžÐ’Ð†Ð”ÐÐ›Ð¬ÐÐ†Ð¡Ð¢Ð¬ Ð¡Ð¢ÐžÐ Ð†Ð',
      '7. ÐŸÐžÐ Ð¯Ð”ÐžÐš ÐŸÐ•Ð Ð•Ð”ÐÐ§Ð† Ð¢Ð ÐŸÐžÐ’Ð•Ð ÐÐ•ÐÐÐ¯ ÐœÐÐ™ÐÐ',
      '8. ÐŸÐžÐ Ð¯Ð”ÐžÐš Ð’Ð˜Ð Ð†Ð¨Ð•ÐÐÐ¯ Ð¡ÐŸÐžÐ Ð†Ð’',
      '9. Ð¤ÐžÐ Ð¡-ÐœÐÐ–ÐžÐ ',
      '10. Ð—ÐÐšÐ›Ð®Ð§ÐÐ† ÐŸÐžÐ›ÐžÐ–Ð•ÐÐÐ¯',
      '11. Ð Ð•ÐšÐ’Ð†Ð—Ð˜Ð¢Ð˜ Ð¢Ð ÐŸÐ†Ð”ÐŸÐ˜Ð¡Ð˜ Ð¡Ð¢ÐžÐ Ð†Ð',
    ],
    requiredRequisites: [
      'Ð”Ð°Ñ‚Ð°',
      'ÐÐ¾Ð¼ÐµÑ€',
      'ÐŸÑ€ÐµÐ´Ð¼ÐµÑ‚ Ð¾Ñ€ÐµÐ½Ð´Ð¸',
      'Ð¡Ñ‚Ñ€Ð¾Ðº Ð¾Ñ€ÐµÐ½Ð´Ð¸',
      'ÐžÑ€ÐµÐ½Ð´Ð½Ð° Ð¿Ð»Ð°Ñ‚Ð°',
      'ÐŸÑ–Ð´Ð¿Ð¸ÑÐ¸',
    ],
    dstuReference: 'Ð”Ð¡Ð¢Ð£ 4163-2020, Ð¦ÐšÐ£ ÑÑ‚. 759-786',
  },
  {
    documentType: 'Ð´Ð¾Ð³Ð¾Ð²Ñ–Ñ€_Ð¿Ñ–Ð´Ñ€ÑÐ´Ñƒ',
    requiredSections: [
      '1. ÐŸÐ Ð•Ð”ÐœÐ•Ð¢ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£',
      '2. Ð¡Ð¢Ð ÐžÐšÐ˜ Ð’Ð˜ÐšÐžÐÐÐÐÐ¯ Ð ÐžÐ‘Ð†Ð¢',
      '3. Ð¦Ð†ÐÐ Ð¢Ð ÐŸÐžÐ Ð¯Ð”ÐžÐš Ð ÐžÐ—Ð ÐÐ¥Ð£ÐÐšÐ†Ð’',
      '4. ÐŸÐ ÐÐ’Ð Ð¢Ð ÐžÐ‘ÐžÐ’\'Ð¯Ð—ÐšÐ˜ Ð—ÐÐœÐžÐ’ÐÐ˜ÐšÐ',
      '5. ÐŸÐ ÐÐ’Ð Ð¢Ð ÐžÐ‘ÐžÐ’\'Ð¯Ð—ÐšÐ˜ ÐŸÐ†Ð”Ð Ð¯Ð”ÐÐ˜ÐšÐ',
      '6. Ð—Ð”ÐÐ§Ð Ð¢Ð ÐŸÐ Ð˜Ð™ÐœÐÐÐÐ¯ Ð ÐžÐ‘Ð†Ð¢',
      '7. Ð’Ð†Ð”ÐŸÐžÐ’Ð†Ð”ÐÐ›Ð¬ÐÐ†Ð¡Ð¢Ð¬ Ð¡Ð¢ÐžÐ Ð†Ð',
      '8. ÐŸÐžÐ Ð¯Ð”ÐžÐš Ð’Ð˜Ð Ð†Ð¨Ð•ÐÐÐ¯ Ð¡ÐŸÐžÐ Ð†Ð’',
      '9. Ð¤ÐžÐ Ð¡-ÐœÐÐ–ÐžÐ ',
      '10. Ð—ÐÐšÐ›Ð®Ð§ÐÐ† ÐŸÐžÐ›ÐžÐ–Ð•ÐÐÐ¯',
      '11. Ð Ð•ÐšÐ’Ð†Ð—Ð˜Ð¢Ð˜ Ð¢Ð ÐŸÐ†Ð”ÐŸÐ˜Ð¡Ð˜ Ð¡Ð¢ÐžÐ Ð†Ð',
    ],
    requiredRequisites: [
      'Ð”Ð°Ñ‚Ð°',
      'ÐÐ¾Ð¼ÐµÑ€',
      'ÐŸÑ€ÐµÐ´Ð¼ÐµÑ‚ Ñ€Ð¾Ð±Ñ–Ñ‚',
      'Ð¡Ñ‚Ñ€Ð¾ÐºÐ¸',
      'Ð¦Ñ–Ð½Ð°',
      'ÐŸÑ–Ð´Ð¿Ð¸ÑÐ¸',
    ],
    dstuReference: 'Ð”Ð¡Ð¢Ð£ 4163-2020, Ð¦ÐšÐ£ ÑÑ‚. 837-862',
  },
  {
    documentType: 'NDA',
    requiredSections: [
      '1. Ð¢Ð•Ð ÐœÐ†ÐÐ˜ Ð¢Ð Ð’Ð˜Ð—ÐÐÐ§Ð•ÐÐÐ¯',
      '2. ÐŸÐ Ð•Ð”ÐœÐ•Ð¢ Ð”ÐžÐ“ÐžÐ’ÐžÐ Ð£',
      '3. Ð—ÐžÐ‘ÐžÐ’\'Ð¯Ð—ÐÐÐÐ¯ Ð¡Ð¢ÐžÐ Ð†Ð',
      '4. Ð’Ð˜ÐšÐ›Ð®Ð§Ð•ÐÐÐ¯ Ð— ÐšÐžÐÐ¤Ð†Ð”Ð•ÐÐ¦Ð†Ð™ÐÐžÐ‡ Ð†ÐÐ¤ÐžÐ ÐœÐÐ¦Ð†Ð‡',
      '5. Ð¡Ð¢Ð ÐžÐš Ð”Ð†Ð‡ Ð—ÐžÐ‘ÐžÐ’\'Ð¯Ð—ÐÐÐ¬',
      '6. Ð’Ð†Ð”ÐŸÐžÐ’Ð†Ð”ÐÐ›Ð¬ÐÐ†Ð¡Ð¢Ð¬ Ð—Ð Ð ÐžÐ—Ð“ÐžÐ›ÐžÐ¨Ð•ÐÐÐ¯',
      '7. ÐŸÐžÐ Ð¯Ð”ÐžÐš Ð’Ð˜Ð Ð†Ð¨Ð•ÐÐÐ¯ Ð¡ÐŸÐžÐ Ð†Ð’',
      '8. Ð—ÐÐšÐ›Ð®Ð§ÐÐ† ÐŸÐžÐ›ÐžÐ–Ð•ÐÐÐ¯',
      '9. Ð Ð•ÐšÐ’Ð†Ð—Ð˜Ð¢Ð˜ Ð¢Ð ÐŸÐ†Ð”ÐŸÐ˜Ð¡Ð˜ Ð¡Ð¢ÐžÐ Ð†Ð',
    ],
    requiredRequisites: [
      'Ð”Ð°Ñ‚Ð°',
      'ÐÐ¾Ð¼ÐµÑ€',
      'Ð¡Ñ‚Ð¾Ñ€Ð¾Ð½Ð¸',
      'ÐŸÑ€ÐµÐ´Ð¼ÐµÑ‚ ÐºÐ¾Ð½Ñ„Ñ–Ð´ÐµÐ½Ñ†Ñ–Ð¹Ð½Ð¾ÑÑ‚Ñ–',
      'Ð¡Ñ‚Ñ€Ð¾Ðº',
      'ÐŸÑ–Ð´Ð¿Ð¸ÑÐ¸',
    ],
    dstuReference: 'Ð”Ð¡Ð¢Ð£ 4163-2020, Ð¦ÐšÐ£ ÑÑ‚. 626-629',
  },
];

class DstuService {
  /**
   * Get Ð”Ð¡Ð¢Ð£ requirements by section
   */
  getRequirementsBySection(section: string): DstuRequirement[] {
    return DSTU_REQUIREMENTS.filter((req) => req.section === section);
  }

  /**
   * Get mandatory requirements
   */
  getMandatoryRequirements(): DstuRequirement[] {
    return DSTU_REQUIREMENTS.filter((req) => req.mandatory);
  }

  /**
   * Get document template by type
   */
  getTemplate(documentType: string): DocumentTemplate | null {
    return (
      DOCUMENT_TEMPLATES.find((tpl) => tpl.documentType === documentType) || null
    );
  }

  /**
   * Validate document structure against Ð”Ð¡Ð¢Ð£
   */
  validateStructure(
    documentType: string,
    sections: string[]
  ): { valid: boolean; missing: string[] } {
    const template = this.getTemplate(documentType);
    if (!template) {
      return { valid: false, missing: ['Template not found'] };
    }

    const missing = template.requiredSections.filter(
      (reqSection) =>
        !sections.some((section) =>
          section.toLowerCase().includes(reqSection.toLowerCase())
        )
    );

    return {
      valid: missing.length === 0,
      missing,
    };
  }

  /**
   * Get all document types
   */
  getDocumentTypes(): string[] {
    return DOCUMENT_TEMPLATES.map((tpl) => tpl.documentType);
  }
}

export const dstuService = new DstuService();


================================================================================
20. REVIEW API ROUTE (NEXT.JS 14)
================================================================================
FILE: app/api/review/route.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * API Route: Contract Review
 * POST /api/review
 * 
 * Accepts contract text, runs 4-agent analysis, returns comprehensive report
 */

import { NextRequest, NextResponse } from 'next/server';
import { ReviewOrchestrator } from '../../../packages/legal-council/orchestrators/review-orchestrator';
import type { ContractReviewRequest } from '../../../packages/legal-council/types/review-types';

// ==========================================
// NEXT.JS 14 ROUTE SEGMENT CONFIG
// ==========================================
// Replaced deprecated `export const config = {...}` with new format

// Maximum execution time (5 minutes for complex contracts)
export const maxDuration = 300;

// Force dynamic rendering (no static generation)
export const dynamic = 'force-dynamic';

// Runtime (nodejs, not edge)
export const runtime = 'nodejs';

// ==========================================
// POST HANDLER
// ==========================================

export async function POST(request: NextRequest) {
  try {
    // Parse request body (Next.js 14 app/ routes handle large bodies automatically)
    const body = await request.json();
    
    // Validate required fields
    if (!body.contractText || typeof body.contractText !== 'string') {
      return NextResponse.json(
        { error: 'Missing or invalid contractText field' },
        { status: 400 }
      );
    }

    // Build request
    const reviewRequest: ContractReviewRequest = {
      contractText: body.contractText,
      contractType: body.contractType,
      jurisdiction: body.jurisdiction || 'Ukraine',
      specificQuestions: body.specificQuestions,
      focusAreas: body.focusAreas,
    };

    console.log(`ðŸ“‹ Review request received (${reviewRequest.contractText.length} chars)`);

    // Initialize orchestrator
    const orchestrator = new ReviewOrchestrator({
      maxRounds: 3,
      maxSeverityThreshold: 3,
      minConfidence: 0.85,
      enableAuditTrail: true,
    });

    // Run analysis
    const startTime = Date.now();
    const result = await orchestrator.analyze(reviewRequest);
    const duration = Date.now() - startTime;

    console.log(`âœ… Review complete in ${(duration / 1000).toFixed(1)}s`);
    console.log(`   Cost: $${result.metadata.totalCost.toFixed(4)}`);
    console.log(`   Confidence: ${(result.confidence * 100).toFixed(0)}%`);

    // Return response
    return NextResponse.json({
      success: true,
      data: result,
      metadata: {
        processingTimeMs: duration,
        timestamp: new Date().toISOString(),
      },
    });

  } catch (error) {
    console.error('âŒ Review API error:', error);

    // Handle specific error types
    if (error instanceof Error) {
      // API key errors
      if (error.message.includes('API key')) {
        return NextResponse.json(
          { error: 'Invalid API configuration. Please check environment variables.' },
          { status: 500 }
        );
      }

      // Rate limit errors
      if (error.message.includes('rate limit')) {
        return NextResponse.json(
          { error: 'Rate limit exceeded. Please try again later.' },
          { status: 429 }
        );
      }

      // Generic error
      return NextResponse.json(
        { error: error.message },
        { status: 500 }
      );
    }

    // Unknown error
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}


================================================================================
21. GENERATE API ROUTE (NEXT.JS 14)
================================================================================
FILE: app/api/generate/route.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * API Route: Document Generation
 * POST /api/generate
 * 
 * Accepts requirements, generates Ð”Ð¡Ð¢Ð£-compliant Ukrainian contract
 */

import { NextRequest, NextResponse } from 'next/server';
import { GenerationOrchestrator } from '../../../packages/legal-council/orchestrators/generation-orchestrator';
import type { DocumentGenerationRequest } from '../../../packages/legal-council/types/generation-types';

// ==========================================
// NEXT.JS 14 ROUTE SEGMENT CONFIG
// ==========================================
// Replaced deprecated `export const config = {...}` with new format

// Maximum execution time (5 minutes for complex document generation)
export const maxDuration = 300;

// Force dynamic rendering (no static generation)
export const dynamic = 'force-dynamic';

// Runtime (nodejs, not edge)
export const runtime = 'nodejs';

// ==========================================
// POST HANDLER
// ==========================================

export async function POST(request: NextRequest) {
  try {
    // Parse request body (Next.js 14 app/ routes handle large bodies automatically)
    const body = await request.json();
    
    // Validate required fields
    if (!body.documentType || typeof body.documentType !== 'string') {
      return NextResponse.json(
        { error: 'Missing or invalid documentType field' },
        { status: 400 }
      );
    }

    if (!body.requirements || typeof body.requirements !== 'string') {
      return NextResponse.json(
        { error: 'Missing or invalid requirements field' },
        { status: 400 }
      );
    }

    // Build request
    const generationRequest: DocumentGenerationRequest = {
      documentType: body.documentType,
      requirements: body.requirements,
      jurisdiction: body.jurisdiction || 'Ukraine',
      parties: body.parties,
      specificClauses: body.specificClauses,
      template: body.template || 'balanced',
    };

    console.log(`ðŸ“ Generation request received: ${generationRequest.documentType}`);

    // Initialize orchestrator
    const orchestrator = new GenerationOrchestrator({
      maxRevisions: 2,
      enableAuditTrail: true,
    });

    // Run generation
    const startTime = Date.now();
    const result = await orchestrator.generate(generationRequest);
    const duration = Date.now() - startTime;

    console.log(`âœ… Generation complete in ${(duration / 1000).toFixed(1)}s`);
    console.log(`   Cost: $${result.metadata.totalCost.toFixed(4)}`);
    console.log(`   Quality: ${result.qualityMetrics.overall}%`);

    // Return response
    return NextResponse.json({
      success: true,
      data: result,
      metadata: {
        processingTimeMs: duration,
        timestamp: new Date().toISOString(),
      },
    });

  } catch (error) {
    console.error('âŒ Generation API error:', error);

    if (error instanceof Error) {
      // API key errors
      if (error.message.includes('API key')) {
        return NextResponse.json(
          { error: 'Invalid API configuration. Please check environment variables.' },
          { status: 500 }
        );
      }

      // Rate limit errors
      if (error.message.includes('rate limit')) {
        return NextResponse.json(
          { error: 'Rate limit exceeded. Please try again later.' },
          { status: 429 }
        );
      }

      // Validation errors
      if (error.message.includes('Invalid') || error.message.includes('Missing')) {
        return NextResponse.json(
          { error: error.message },
          { status: 400 }
        );
      }

      // Generic error
      return NextResponse.json(
        { error: error.message },
        { status: 500 }
      );
    }

    // Unknown error
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}


================================================================================
22. ENVIRONMENT VARIABLES
================================================================================
FILE: .env.example
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Legal Council - Environment Variables
# Copy this file to .env and fill in your actual values

# ==========================================
# LLM API KEYS (Required)
# ==========================================

# Anthropic Claude API Key
# Get from: https://console.anthropic.com/
ANTHROPIC_API_KEY=sk-ant-api03-xxx

# OpenAI GPT API Key
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-xxx

# Google Gemini API Key
# Get from: https://aistudio.google.com/apikey
GOOGLE_API_KEY=AIzaXXX

# ==========================================
# ENVIRONMENT MODE
# ==========================================

# Options: production | testing | development
# - production: Best quality, highest cost (Opus as Expert)
# - testing: Good quality, 70% cheaper (Sonnet as Expert) â† RECOMMENDED for MVP
# - development: Max savings (Gemini where possible)
LEGAL_COUNCIL_ENV=testing

# ==========================================
# NEXT.JS CONFIGURATION
# ==========================================

# Application URL (for CORS, webhooks, etc.)
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Node environment
NODE_ENV=development

# ==========================================
# OPTIONAL: DATABASE (Future)
# ==========================================

# PostgreSQL connection (if using database for audit logs)
# DATABASE_URL=postgresql://user:password@localhost:5432/legal_council

# ==========================================
# OPTIONAL: MONITORING (Future)
# ==========================================

# Sentry DSN for error tracking
# SENTRY_DSN=https://xxx@sentry.io/xxx

# ==========================================
# COST LIMITS (Optional Safety)
# ==========================================

# Maximum cost per query in USD (safety limit)
# MAX_COST_PER_QUERY=1.00

# Daily cost limit in USD
# DAILY_COST_LIMIT=50.00

# ==========================================
# FEATURE FLAGS (Optional)
# ==========================================

# Enable audit trail logging (true | false)
ENABLE_AUDIT_TRAIL=true

# Enable cost tracking (true | false)
ENABLE_COST_TRACKING=true

# ==========================================
# NOTES
# ==========================================

# 1. NEVER commit .env to Git (it's in .gitignore)
# 2. Keep .env.example up to date when adding new variables
# 3. For production deployment:
#    - Set LEGAL_COUNCIL_ENV=production
#    - Use environment variables in hosting platform (Vercel, Railway, etc.)
#    - Rotate API keys regularly
# 4. Cost estimates (testing mode):
#    - Contract Review: ~$0.14 per query
#    - Document Generation: ~$0.18 per query
#    - 100 queries/day = ~$16/day = ~$500/month


================================================================================
END OF FILE
================================================================================

Ð’ÐµÑ€ÑÑ–Ñ: 1.1.0
Ð”Ð°Ñ‚Ð°: 12 Ð»ÑŽÑ‚Ð¾Ð³Ð¾ 2026
Ð¢ÐµÑÑ‚Ñ–Ð² Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ð¾: 3/3 (100%)
Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: âœ… Fully Operational



═══════════════════════════════════════════════════════════════════════
PART 2: FRONTEND CODE (legal-council-ui-clean/)
═══════════════════════════════════════════════════════════════════════


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/app/(app)/history/page.tsx
═══════════════════════════════════════════════════════════════════════

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/shared/ui'

export default function HistoryPage() {
  return (
    <div className="container mx-auto max-w-7xl p-6">
      <div className="mb-8">
        <h1 className="text-3xl font-bold">Історія Аналізів</h1>
        <p className="text-gray-500">
          Перегляд попередніх аналізів контрактів
        </p>
      </div>

      <Card>
        <CardHeader>
          <CardTitle>Історія порожня</CardTitle>
          <CardDescription>
            Ви ще не проводили жодного аналізу
          </CardDescription>
        </CardHeader>
        <CardContent>
          <p className="text-sm text-gray-500">
            Почніть з аналізу вашого першого контракту на сторінці "Огляд Контрактів"
          </p>
        </CardContent>
      </Card>
    </div>
  )
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/app/(app)/layout.tsx
═══════════════════════════════════════════════════════════════════════

export default function AppLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return <>{children}</>
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/app/(app)/review/page.tsx
═══════════════════════════════════════════════════════════════════════

'use client'

import { useState } from 'react'
import { Card, CardContent, CardHeader, CardTitle, Button } from '@/shared/ui'
import { SplitView, RiskDashboard, AgentProgress } from '@/shared/components'
import { useAnalysisStore } from '@/stores/analysis'
import type { RiskSeverity } from '@/shared/types'

export default function ReviewPage() {
  const [contractText, setContractText] = useState('')
  const [contractType, setContractType] = useState<string>('оренда')
  const [showResults, setShowResults] = useState(false)
  const [risks, setRisks] = useState<any[]>([])
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)

  const {
    isAnalyzing,
    agents,
    startAnalysis,
    resetAnalysis,
    updateAgentStatus,
    completeAgent,
  } = useAnalysisStore()

  const handleAnalyze = async () => {
    if (!contractText.trim()) {
      alert('Будь ласка, введіть текст контракту')
      return
    }

    setIsLoading(true)
    setError(null)
    startAnalysis()
    setShowResults(true)

    try {
      // Simulate agent progress
      updateAgentStatus('expert', 'running', 'Аналізую відповідність законодавству...')
      
      setTimeout(() => {
        updateAgentStatus('expert', 'completed', '7 проблем знайдено')
        updateAgentStatus('provocateur', 'running', 'Шукаю приховані ризики...')
      }, 1000)
      
      setTimeout(() => {
        updateAgentStatus('provocateur', 'completed', '4 слабких місця виявлено')
        updateAgentStatus('validator', 'running', 'Перевіряю висновки...')
      }, 2000)

      // Call API
      const response = await fetch('/api/review', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contractText,
          contractType,
        }),
      })

      if (!response.ok) {
        throw new Error('API request failed')
      }

      const result = await response.json()
      
      // Update final agents
      updateAgentStatus('validator', 'completed', 'Суперечностей не знайдено')
      updateAgentStatus('synthesizer', 'running', 'Формую фінальний звіт...')
      
      setTimeout(() => {
        updateAgentStatus('synthesizer', 'completed', 'Звіт готовий')
        setRisks(result.data.risks || [])
        setIsLoading(false)
        resetAnalysis()
      }, 500)

    } catch (err) {
      console.error('Analysis error:', err)
      setError('Помилка при аналізі. Спробуйте ще раз.')
      setIsLoading(false)
      resetAnalysis()
    }
  }

  const handleReset = () => {
    setContractText('')
    setContractType('оренда')
    setShowResults(false)
    setRisks([])
    setError(null)
    resetAnalysis()
  }

  const handleRiskClick = (risk: any) => {
    // TODO: Implement "The Tether" animation - scroll to and highlight text
    console.log('Risk clicked:', risk)
    if (risk.lineNumber) {
      // Scroll to line in contract text
    }
  }

  // BEFORE analysis: Show upload form
  if (!showResults) {
    return (
      <div className="container mx-auto max-w-4xl p-6">
        {/* Header */}
        <div className="mb-8">
          <h1 className="text-heading-lg">Аналіз Контракту</h1>
          <p className="text-gray-500 mt-2">
            Завантажте договір для експертного аналізу з використанням 4 AI-агентів
          </p>
        </div>

        <Card>
          <CardHeader>
            <CardTitle>Введіть Контракт</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            {/* Contract Type */}
            <div>
              <label className="mb-2 block text-sm font-medium">
                Тип Договору
              </label>
              <select
                value={contractType}
                onChange={(e) => setContractType(e.target.value)}
                className="flex h-10 w-full rounded-md border border-input bg-white px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"
              >
                <option value="оренда">Оренда</option>
                <option value="поставка">Поставка</option>
                <option value="послуги">Послуги</option>
                <option value="трудовий">Трудовий</option>
                <option value="підряд">Підряд</option>
                <option value="купівля-продаж">Купівля-продаж</option>
                <option value="інше">Інше</option>
              </select>
            </div>

            {/* Contract Text */}
            <div>
              <label className="mb-2 block text-sm font-medium">
                Текст Договору
              </label>
              <textarea
                value={contractText}
                onChange={(e) => setContractText(e.target.value)}
                placeholder="Вставте текст договору тут...

Приклад:
ДОГОВІР ОРЕНДИ НЕРУХОМОГО МАЙНА

1. ПРЕДМЕТ ДОГОВОРУ
1.1. Орендодавець передає, а Орендатор приймає в строкове платне користування..."
                className="contract-text custom-scrollbar min-h-[400px] w-full rounded-md border border-input bg-white p-4 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"
              />
              <p className="mt-2 text-xs text-gray-500">
                Символів: {contractText.length}
              </p>
            </div>

            {/* Actions */}
            <div className="flex gap-3">
              <Button
                onClick={handleAnalyze}
                disabled={!contractText.trim()}
                className="flex-1"
              >
                Проаналізувати →
              </Button>
            </div>
          </CardContent>
        </Card>

        {/* Features info */}
        <div className="mt-8 grid gap-6 md:grid-cols-2">
          <Card>
            <CardContent className="pt-6">
              <div className="flex gap-3">
                <div className="text-2xl">⚡</div>
                <div>
                  <h4 className="font-semibold">Швидкий аналіз</h4>
                  <p className="text-sm text-gray-500">
                    Результат за 60-90 секунд
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="pt-6">
              <div className="flex gap-3">
                <div className="text-2xl">🔒</div>
                <div>
                  <h4 className="font-semibold">Конфіденційність</h4>
                  <p className="text-sm text-gray-500">
                    Ваші дані захищені
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    )
  }

  // DURING/AFTER analysis: Show split view
  return (
    <div className="flex flex-col">
      {/* Top Bar */}
      <div className="flex items-center justify-between border-b bg-white px-6 py-4">
        <div>
          <h1 className="text-xl font-semibold">Аналіз Контракту</h1>
          <p className="text-sm text-gray-500">
            {contractType.charAt(0).toUpperCase() + contractType.slice(1)} • {contractText.length} символів
          </p>
        </div>

        <div className="flex gap-2">
          {!isAnalyzing && (
            <>
              <Button variant="outline" size="sm" onClick={handleReset}>
                ← Новий аналіз
              </Button>
              <Button variant="outline" size="sm">
                Зберегти звіт
              </Button>
            </>
          )}
          {isAnalyzing && (
            <Button variant="outline" size="sm" onClick={handleReset}>
              Скасувати
            </Button>
          )}
        </div>
      </div>

      {/* SPLIT VIEW (All 3 AI: Unanimous choice!) */}
      <SplitView
        leftContent={
          <div className="space-y-md">
            <div className="sticky top-0 bg-white pb-2">
              <h2 className="text-lg font-semibold">Текст Договору</h2>
              <p className="text-sm text-gray-500">
                IBM Plex Serif для кращої читабельності
              </p>
            </div>
            
            {/* Contract text (DeepSeek: IBM Plex Serif 16px/1.75) */}
            <div className="contract-text custom-scrollbar whitespace-pre-wrap rounded-md border bg-white p-lg font-serif">
              {contractText || 'Текст контракту відсутній'}
            </div>
          </div>
        }
        rightContent={
          <div className="space-y-md">
            {isAnalyzing ? (
              <>
                {/* "War Room" Agent Progress (All 3 AI: Show work!) */}
                <Card>
                  <CardHeader>
                    <CardTitle>Процес Аналізу</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <AgentProgress
                      agents={Object.values(agents).map((agent) => ({
                        name: agent.name,
                        status: agent.status,
                        message: agent.message,
                      }))}
                    />
                  </CardContent>
                </Card>
              </>
            ) : (
              <>
                {/* Error message */}
                {error && (
                  <div className="rounded-md border border-red-200 bg-red-50 p-4 mb-4">
                    <div className="flex items-start gap-3">
                      <span className="text-xl">❌</span>
                      <div>
                        <h4 className="font-semibold text-red-900">Помилка</h4>
                        <p className="text-sm text-red-700">{error}</p>
                      </div>
                    </div>
                  </div>
                )}
                
                {/* Hybrid Risk Dashboard (All 3 AI: unanimous!) */}
                <RiskDashboard
                  risks={risks}
                  onRiskClick={handleRiskClick}
                />
              </>
            )}
          </div>
        }
      />
    </div>
  )
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/app/api/review/route.ts
═══════════════════════════════════════════════════════════════════════

/**
 * Mock API Route: Contract Review
 * POST /api/review
 * 
 * Returns simulated analysis after 3 seconds
 * TODO: Replace with real AI orchestrator when backend is integrated
 */

import { NextRequest, NextResponse } from 'next/server'

// Route config
export const maxDuration = 60
export const dynamic = 'force-dynamic'
export const runtime = 'nodejs'

// Simulate delay
const sleep = (ms: number) => new Promise(resolve => setTimeout(resolve, ms))

// Mock risks generator
function generateMockRisks(contractText: string) {
  const risks = []
  
  // Check for common issues
  if (!contractText.toLowerCase().includes('ціна') && !contractText.toLowerCase().includes('вартість')) {
    risks.push({
      id: '1',
      severity: 5,
      title: 'Відсутність ціни товару/послуг',
      description: 'Договір не містить чітко визначеної ціни, що суперечить істотним умовам договору',
      contractExcerpt: contractText.substring(0, 100) + '...',
      legalCitation: 'ЦКУ ст. 638 - Істотні умови договору',
      recommendation: 'Додайте конкретну ціну або механізм її визначення',
      confidence: 98,
      agentName: 'Експерт',
    })
  }
  
  if (!contractText.toLowerCase().includes('строк') && !contractText.toLowerCase().includes('термін')) {
    risks.push({
      id: '2',
      severity: 4,
      title: 'Нечіткі строки виконання',
      description: 'Термін виконання зобов\'язань не конкретизований',
      contractExcerpt: 'Роботи мають бути виконані в найкоротші терміни...',
      legalCitation: 'ЦКУ ст. 251 - Строки',
      recommendation: 'Вкажіть конкретну дату або кількість днів',
      confidence: 92,
      agentName: 'Провокатор',
    })
  }
  
  if (!contractText.toLowerCase().includes('спор') && !contractText.toLowerCase().includes('арбітраж')) {
    risks.push({
      id: '3',
      severity: 3,
      title: 'Відсутність механізму врегулювання спорів',
      description: 'Договір не визначає порядок вирішення конфліктів',
      contractExcerpt: '',
      legalCitation: 'ГКУ ст. 221',
      recommendation: 'Додайте розділ про порядок вирішення спорів',
      confidence: 85,
      agentName: 'Валідатор',
    })
  }
  
  if (!contractText.toLowerCase().includes('штраф') && !contractText.toLowerCase().includes('відповідальність')) {
    risks.push({
      id: '4',
      severity: 3,
      title: 'Відсутність відповідальності сторін',
      description: 'Не визначено штрафні санкції за порушення умов',
      contractExcerpt: '',
      legalCitation: 'ЦКУ ст. 611 - Відповідальність за порушення',
      recommendation: 'Додайте розділ з штрафними санкціями',
      confidence: 88,
      agentName: 'Експерт',
    })
  }
  
  // Add at least one positive finding
  risks.push({
    id: '5',
    severity: 1,
    title: 'Структура документу відповідає стандартам',
    description: 'Загальна структура договору відповідає вимогам',
    contractExcerpt: '',
    legalCitation: 'ДСТУ 4163-2020',
    recommendation: 'Структура документу в порядку',
    confidence: 95,
    agentName: 'Валідатор',
  })
  
  return risks
}

export async function POST(request: NextRequest) {
  try {
    const body = await request.json()
    
    // Validate
    if (!body.contractText || typeof body.contractText !== 'string') {
      return NextResponse.json(
        { error: 'Missing or invalid contractText field' },
        { status: 400 }
      )
    }
    
    console.log(`📋 Mock review: ${body.contractText.length} chars`)
    
    // Simulate AI processing time (3 seconds)
    await sleep(3000)
    
    // Generate mock risks
    const risks = generateMockRisks(body.contractText)
    
    // Calculate stats
    const criticalCount = risks.filter(r => r.severity === 5).length
    const highCount = risks.filter(r => r.severity === 4).length
    const avgConfidence = Math.round(
      risks.reduce((sum, r) => sum + r.confidence, 0) / risks.length
    )
    
    // Return mock response
    return NextResponse.json({
      success: true,
      data: {
        risks,
        summary: {
          totalRisks: risks.length,
          critical: criticalCount,
          high: highCount,
          medium: risks.filter(r => r.severity === 3).length,
          low: risks.filter(r => r.severity === 2).length,
          safe: risks.filter(r => r.severity === 1).length,
          averageConfidence: avgConfidence,
        },
        metadata: {
          contractLength: body.contractText.length,
          contractType: body.contractType || 'unknown',
          analysisDate: new Date().toISOString(),
          mode: 'MOCK',
        }
      },
      metadata: {
        processingTimeMs: 3000,
        timestamp: new Date().toISOString(),
      },
    })
    
  } catch (error) {
    console.error('❌ Mock API error:', error)
    
    return NextResponse.json(
      { error: error instanceof Error ? error.message : 'Internal server error' },
      { status: 500 }
    )
  }
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/app/layout.tsx
═══════════════════════════════════════════════════════════════════════

import type { Metadata } from 'next'
import { Inter, JetBrains_Mono, IBM_Plex_Serif } from 'next/font/google'
import { Header, Footer } from '@/shared/components'
import './globals.css'

// UI Font (Unanimous: Inter)
const inter = Inter({
  subsets: ['latin', 'cyrillic'],
  variable: '--font-inter',
  display: 'swap',
})

// Contract Font (DeepSeek: IBM Plex Serif for best Ukrainian Cyrillic)
const ibmPlexSerif = IBM_Plex_Serif({
  weight: ['400', '500', '600'],
  subsets: ['latin', 'cyrillic'],
  variable: '--font-ibm-plex-serif',
  display: 'swap',
})

// Code Font
const jetbrainsMono = JetBrains_Mono({
  subsets: ['latin', 'cyrillic'],
  variable: '--font-jetbrains-mono',
  display: 'swap',
})

export const metadata: Metadata = {
  title: 'Legal Council - Юридичний Аналіз Контрактів',
  description: 'AI-powered аналіз юридичних договорів відповідно до законодавства України',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="uk" suppressHydrationWarning>
      <body
        className={`${inter.variable} ${ibmPlexSerif.variable} ${jetbrainsMono.variable} font-sans antialiased`}
      >
        <div className="flex min-h-screen flex-col">
          <Header />
          <main className="flex-1">{children}</main>
          <Footer />
        </div>
      </body>
    </html>
  )
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/app/page.tsx
═══════════════════════════════════════════════════════════════════════

import Link from 'next/link'
import { Button } from '@/shared/ui'
import { RiskBadge } from '@/shared/components/RiskBadge'

/**
 * Landing Page - Legal Tech Hybrid Design
 * Based on consensus from DeepSeek, ChatGPT, Grok:
 * - Split hero layout (left: message, right: visual)
 * - Professional but not boring
 * - Trust signals prominent
 * - Navy blue brand color (#1E3A8A)
 */

export default function HomePage() {
  return (
    <div className="min-h-screen bg-gray-50">
      {/* HERO SECTION - Split Layout (All 3 AI recommended) */}
      <section className="container mx-auto px-6 py-24">
        <div className="grid gap-12 lg:grid-cols-2 lg:gap-16 items-center">
          {/* LEFT: Message (ChatGPT: "Punchy headline") */}
          <div className="space-y-8">
            <div className="space-y-4">
              <div className="inline-flex items-center gap-2 rounded-full bg-navy/10 px-4 py-2 text-sm font-medium text-navy">
                <span className="relative flex h-2 w-2">
                  <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-navy opacity-75"></span>
                  <span className="relative inline-flex rounded-full h-2 w-2 bg-navy"></span>
                </span>
                AI-аналіз за 90 секунд
              </div>
              
              <h1 className="text-4xl font-bold tracking-tight sm:text-5xl lg:text-6xl">
                Юридичний Аналіз Контрактів
                <span className="block text-navy mt-2">
                  З Відповідністю ЦКУ, ГКУ, КЗпП
                </span>
              </h1>
              
              <p className="text-lg text-gray-500 leading-relaxed">
                Професійний AI-асистент для перевірки договорів. 
                4 спеціалізовані агенти аналізують кожен пункт та виявляють критичні ризики.
              </p>
            </div>

            {/* CTA Buttons */}
            <div className="flex flex-col sm:flex-row gap-4">
              <Button asChild size="lg" className="text-base">
                <Link href="/review">
                  Проаналізувати Контракт →
                </Link>
              </Button>
              
              <Button asChild size="lg" variant="outline" className="text-base">
                <Link href="/history">
                  Переглянути Історію
                </Link>
              </Button>
            </div>

            {/* Trust indicators (All 3 AI: critical for lawyers) */}
            <div className="flex flex-wrap items-center gap-6 pt-4 text-sm text-gray-500">
              <div className="flex items-center gap-2">
                <svg className="h-5 w-5 text-navy" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
                <span>Відповідність законодавству</span>
              </div>
              <div className="flex items-center gap-2">
                <svg className="h-5 w-5 text-navy" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
                <span>Безпечна обробка даних</span>
              </div>
            </div>
          </div>

          {/* RIGHT: Visual (ChatGPT: "Live mini-preview") */}
          <div className="relative">
            <div className="rounded-lg border bg-white p-6 shadow-lg">
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <h3 className="font-semibold">Результат Аналізу</h3>
                  <RiskBadge severity={4} />
                </div>
                
                <div className="space-y-3">
                  <div className="flex items-start gap-3 rounded-md border border-risk-critical/20 bg-risk-critical/5 p-3">
                    <span className="text-lg">❗</span>
                    <div className="flex-1 space-y-1">
                      <p className="text-sm font-medium">Критичний ризик знайдено</p>
                      <p className="text-xs text-gray-500">
                        Відсутність ціни суперечить ЦКУ ст. 638
                      </p>
                    </div>
                  </div>
                  
                  <div className="flex items-start gap-3 rounded-md border border-risk-medium/20 bg-risk-medium/5 p-3">
                    <span className="text-lg">⚙️</span>
                    <div className="flex-1 space-y-1">
                      <p className="text-sm font-medium">Середній ризик</p>
                      <p className="text-xs text-gray-500">
                        Нечіткі строки виконання
                      </p>
                    </div>
                  </div>
                  
                  <div className="flex items-start gap-3 rounded-md border border-risk-safe/20 bg-risk-safe/5 p-3">
                    <span className="text-lg">✅</span>
                    <div className="flex-1 space-y-1">
                      <p className="text-sm font-medium">12 пунктів безпечні</p>
                      <p className="text-xs text-gray-500">
                        Відповідають стандартам
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            {/* Floating element */}
            <div className="absolute -bottom-4 -right-4 rounded-lg border bg-white p-4 shadow-md">
              <div className="flex items-center gap-3">
                <div className="flex -space-x-2">
                  <div className="flex h-8 w-8 items-center justify-center rounded-full bg-navy text-xs font-semibold text-white">
                    E
                  </div>
                  <div className="flex h-8 w-8 items-center justify-center rounded-full bg-destructive text-xs font-semibold text-white">
                    P
                  </div>
                  <div className="flex h-8 w-8 items-center justify-center rounded-full bg-risk-safe text-xs font-semibold text-white">
                    V
                  </div>
                </div>
                <div className="text-xs">
                  <p className="font-semibold">4 AI Агенти</p>
                  <p className="text-gray-500">Працюють разом</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* FEATURES SECTION (Grok: 4-5 core features) */}
      <section className="border-t bg-white py-24">
        <div className="container mx-auto px-6">
          <div className="mb-12 text-center">
            <h2 className="text-3xl font-bold">Як Це Працює</h2>
            <p className="mt-4 text-lg text-gray-500">
              4 спеціалізовані AI-агенти аналізують ваш договір
            </p>
          </div>

          <div className="grid gap-8 md:grid-cols-2 lg:grid-cols-4">
            {/* Feature 1 */}
            <div className="group hover-lift rounded-lg border bg-white p-6">
              <div className="mb-4 flex h-12 w-12 items-center justify-center rounded-lg bg-navy/10 text-2xl">
                🔍
              </div>
              <h3 className="mb-2 text-lg font-semibold">Експерт</h3>
              <p className="text-sm text-gray-500">
                Перевіряє відповідність ЦКУ, ГКУ, КЗпП. Знаходить юридичні неточності.
              </p>
            </div>

            {/* Feature 2 */}
            <div className="group hover-lift rounded-lg border bg-white p-6">
              <div className="mb-4 flex h-12 w-12 items-center justify-center rounded-lg bg-destructive/10 text-2xl">
                ⚔️
              </div>
              <h3 className="mb-2 text-lg font-semibold">Провокатор</h3>
              <p className="text-sm text-gray-500">
                Діє як опонент. Шукає слабкі місця та приховані ризики.
              </p>
            </div>

            {/* Feature 3 */}
            <div className="group hover-lift rounded-lg border bg-white p-6">
              <div className="mb-4 flex h-12 w-12 items-center justify-center rounded-lg bg-risk-safe/10 text-2xl">
                ✓
              </div>
              <h3 className="mb-2 text-lg font-semibold">Валідатор</h3>
              <p className="text-sm text-gray-500">
                Перевіряє висновки обох агентів. Усуває суперечності.
              </p>
            </div>

            {/* Feature 4 */}
            <div className="group hover-lift rounded-lg border bg-white p-6">
              <div className="mb-4 flex h-12 w-12 items-center justify-center rounded-lg bg-accent/10 text-2xl">
                📊
              </div>
              <h3 className="mb-2 text-lg font-semibold">Синтезатор</h3>
              <p className="text-sm text-gray-500">
                Формує фінальний звіт з рекомендаціями та висновками.
              </p>
            </div>
          </div>
        </div>
      </section>

      {/* TRUST SECTION (All 3 AI: Critical for lawyers!) */}
      <section className="border-t py-16">
        <div className="container mx-auto px-6">
          <div className="rounded-lg border bg-white p-8 md:p-12">
            <div className="grid gap-8 md:grid-cols-3">
              <div className="text-center">
                <div className="mb-4 text-4xl font-bold text-navy">95%+</div>
                <p className="text-sm text-gray-500">
                  Точність виявлення критичних ризиків
                </p>
              </div>
              
              <div className="text-center">
                <div className="mb-4 text-4xl font-bold text-navy">&lt;90s</div>
                <p className="text-sm text-gray-500">
                  Повний аналіз договору будь-якої складності
                </p>
              </div>
              
              <div className="text-center">
                <div className="mb-4 text-4xl font-bold text-navy">100%</div>
                <p className="text-sm text-gray-500">
                  Відповідність українському законодавству
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

    </div>
  )
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/components/AgentProgress.tsx
═══════════════════════════════════════════════════════════════════════

import { cn } from '@/shared/lib'
import type { AgentName, AgentStatus } from '@/shared/types'

interface AgentProgressProps {
  agents: {
    name: AgentName
    status: AgentStatus
    message?: string
  }[]
  className?: string
}

const AGENT_CONFIG = {
  expert: {
    label: 'Експерт',
    description: 'Аналізує відповідність ЦКУ, ГКУ, КЗпП',
    icon: '🔍',
  },
  provocateur: {
    label: 'Провокатор',
    description: 'Шукає слабкі місця та контраргументи',
    icon: '⚔️',
  },
  validator: {
    label: 'Валідатор',
    description: 'Перевіряє висновки та усуває суперечності',
    icon: '✓',
  },
  synthesizer: {
    label: 'Синтезатор',
    description: 'Формує фінальний звіт',
    icon: '📊',
  },
} as const

function getStatusColor(status: AgentStatus): string {
  switch (status) {
    case 'completed':
      return 'bg-risk-safe border-risk-safe'
    case 'running':
      return 'bg-brand-primary border-brand-primary animate-pulse'
    case 'error':
      return 'bg-risk-critical border-risk-critical'
    default:
      return 'bg-muted border-gray-200'
  }
}

function getStatusIcon(status: AgentStatus): string {
  switch (status) {
    case 'completed':
      return '✓'
    case 'running':
      return '⏳'
    case 'error':
      return '✗'
    default:
      return '⏸'
  }
}

export function AgentProgress({ agents, className }: AgentProgressProps) {
  return (
    <div className={cn('space-y-3', className)}>
      {agents.map((agent) => {
        const config = AGENT_CONFIG[agent.name]
        const statusColor = getStatusColor(agent.status)
        const statusIcon = getStatusIcon(agent.status)

        return (
          <div
            key={agent.name}
            className={cn(
              'flex items-start gap-3 rounded-lg border p-3 transition-all',
              agent.status === 'running' && 'ring-2 ring-brand-primary/20',
              agent.status === 'completed' && 'bg-risk-safe/5'
            )}
          >
            {/* Icon */}
            <div
              className={cn(
                'flex h-10 w-10 items-center justify-center rounded-full border-2 text-lg',
                statusColor
              )}
            >
              {agent.status === 'running' ? statusIcon : config.icon}
            </div>

            {/* Content */}
            <div className="flex-1 space-y-1">
              <div className="flex items-center justify-between">
                <h4 className="text-sm font-semibold">
                  {config.label}
                </h4>
                <span className="text-xs text-gray-500">
                  {agent.status === 'completed' && '✓ Завершено'}
                  {agent.status === 'running' && 'Аналізую...'}
                  {agent.status === 'pending' && 'Очікує'}
                  {agent.status === 'error' && 'Помилка'}
                </span>
              </div>

              <p className="text-xs text-gray-500">
                {agent.message || config.description}
              </p>

              {/* Progress bar for running agent */}
              {agent.status === 'running' && (
                <div className="h-1 overflow-hidden rounded-full bg-muted">
                  <div className="h-full w-full animate-[shimmer_1s_ease-in-out_infinite] bg-gradient-to-r from-transparent via-brand-primary to-transparent" />
                </div>
              )}
            </div>
          </div>
        )
      })}
    </div>
  )
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/components/Footer.tsx
═══════════════════════════════════════════════════════════════════════

import Link from 'next/link'

export function Footer() {
  const currentYear = new Date().getFullYear()
  
  return (
    <footer className="border-t bg-gray-50">
      <div className="container mx-auto px-6 py-8">
        {/* Top section */}
        <div className="grid gap-8 md:grid-cols-3">
          {/* About */}
          <div>
            <h3 className="mb-3 text-sm font-semibold text-gray-900">AGENTIS</h3>
            <p className="text-sm text-gray-600 leading-relaxed">
              AI-платформа для аналізу юридичних договорів відповідно до законодавства України
            </p>
          </div>
          
          {/* Quick Links */}
          <div>
            <h3 className="mb-3 text-sm font-semibold text-gray-900">Посилання</h3>
            <ul className="space-y-2 text-sm">
              <li>
                <Link href="/review" className="text-gray-600 hover:text-navy transition-colors">
                  Аналіз контракту
                </Link>
              </li>
              <li>
                <Link href="/history" className="text-gray-600 hover:text-navy transition-colors">
                  Історія аналізів
                </Link>
              </li>
            </ul>
          </div>
          
          {/* Legal */}
          <div>
            <h3 className="mb-3 text-sm font-semibold text-gray-900">Юридична інформація</h3>
            <ul className="space-y-2 text-sm">
              <li className="text-gray-600">
                Конфіденційність даних
              </li>
              <li className="text-gray-600">
                Умови використання
              </li>
            </ul>
          </div>
        </div>
        
        {/* Bottom section */}
        <div className="mt-8 border-t pt-6 flex flex-col md:flex-row items-center justify-between gap-4">
          <p className="text-xs text-gray-500">
            © {currentYear} AGENTIS. AI-асистент, не юридична консультація.
          </p>
          
          <div className="flex items-center gap-4 text-xs text-gray-500">
            <span>Powered by Claude Opus 4.5, GPT-4o, Gemini 2.5</span>
          </div>
        </div>
      </div>
    </footer>
  )
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/components/Header.tsx
═══════════════════════════════════════════════════════════════════════

'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { Logo } from './Logo'
import { cn } from '@/shared/lib'

const NAV_LINKS = [
  { href: '/', label: 'Головна', icon: '🏠' },
  { href: '/review', label: 'Аналіз', icon: '🔍' },
  { href: '/history', label: 'Історія', icon: '📊' },
]

export function Header() {
  const pathname = usePathname()
  
  return (
    <header className="sticky top-0 z-50 border-b bg-white shadow-sm">
      <div className="container mx-auto flex h-16 items-center justify-between px-6">
        {/* Logo */}
        <Link href="/" className="hover:opacity-80 transition-opacity">
          <Logo size="md" />
        </Link>
        
        {/* Navigation */}
        <nav className="flex items-center gap-1">
          {NAV_LINKS.map((link) => {
            const isActive = pathname === link.href || 
                            (link.href !== '/' && pathname.startsWith(link.href))
            
            return (
              <Link
                key={link.href}
                href={link.href}
                className={cn(
                  'flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors',
                  isActive 
                    ? 'bg-navy text-white' 
                    : 'text-gray-700 hover:bg-gray-100'
                )}
              >
                <span className="text-base">{link.icon}</span>
                <span>{link.label}</span>
              </Link>
            )
          })}
        </nav>
        
        {/* Right section - можна додати user menu пізніше */}
        <div className="flex items-center gap-3">
          <div className="text-xs text-gray-500">
            v1.0 Beta
          </div>
        </div>
      </div>
    </header>
  )
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/components/Logo.tsx
═══════════════════════════════════════════════════════════════════════

/**
 * AGENTIS Logo Component
 * Design: Shield + Balance (scales of justice)
 * Represents legal protection and fair analysis
 */

interface LogoProps {
  size?: 'sm' | 'md' | 'lg'
  showText?: boolean
  className?: string
}

const SIZES = {
  sm: { width: 165, height: 33, iconScale: 0.75, fontSize: 16.5 },
  md: { width: 220, height: 44, iconScale: 1, fontSize: 22 },
  lg: { width: 275, height: 55, iconScale: 1.25, fontSize: 27.5 },
}

export function Logo({ size = 'md', showText = true, className = '' }: LogoProps) {
  const { width, height, iconScale, fontSize } = SIZES[size]
  
  if (!showText) {
    // Icon only version
    return (
      <svg
        width={36 * iconScale}
        height={36 * iconScale}
        viewBox="0 0 32 36"
        xmlns="http://www.w3.org/2000/svg"
        className={className}
        role="img"
        aria-label="AGENTIS"
      >
        {/* Shield */}
        <path d="M16 0 L32 6 V20 C32 28 16 36 16 36 C16 36 0 28 0 20 V6 Z" fill="#1E3A8A"/>
        
        {/* Balance scales - white for visibility */}
        <g fill="white">
          <rect x="15" y="8" width="2" height="16"/>
          <rect x="8" y="12" width="16" height="2"/>
          <rect x="6" y="14" width="4" height="2"/>
          <rect x="22" y="14" width="4" height="2"/>
        </g>
      </svg>
    )
  }
  
  return (
    <svg
      width={width}
      height={height}
      viewBox="0 0 220 44"
      xmlns="http://www.w3.org/2000/svg"
      className={className}
      role="img"
      aria-label="AGENTIS logo"
    >
      {/* Icon */}
      <g transform="translate(4,4)">
        {/* Shield */}
        <path d="M16 0 L32 6 V20 C32 28 16 36 16 36 C16 36 0 28 0 20 V6 Z" fill="#1E3A8A"/>
        
        {/* Balance scales - white for visibility on navy background */}
        <g fill="white">
          <rect x="15" y="8" width="2" height="16"/>
          <rect x="8" y="12" width="16" height="2"/>
          <rect x="6" y="14" width="4" height="2"/>
          <rect x="22" y="14" width="4" height="2"/>
        </g>
      </g>
      
      {/* Wordmark */}
      <text
        x="56"
        y="30"
        fontFamily="Inter, Montserrat, system-ui, sans-serif"
        fontSize={fontSize}
        fontWeight="600"
        letterSpacing="1.4"
        fill="#1E3A8A"
      >
        AGENTIS
      </text>
    </svg>
  )
}

/**
 * Favicon version - 32x32 icon only
 */
export function LogoIcon({ size = 32 }: { size?: number }) {
  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 32 36"
      xmlns="http://www.w3.org/2000/svg"
      role="img"
      aria-label="AGENTIS"
    >
      {/* Shield */}
      <path d="M16 0 L32 6 V20 C32 28 16 36 16 36 C16 36 0 28 0 20 V6 Z" fill="#1E3A8A"/>
      
      {/* Balance scales - white for visibility */}
      <g fill="white">
        <rect x="15" y="8" width="2" height="16"/>
        <rect x="8" y="12" width="16" height="2"/>
        <rect x="6" y="14" width="4" height="2"/>
        <rect x="22" y="14" width="4" height="2"/>
      </g>
    </svg>
  )
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/components/RiskBadge.tsx
═══════════════════════════════════════════════════════════════════════

import { cn } from '@/shared/lib'
import type { RiskSeverity } from '@/shared/types'

interface RiskBadgeProps {
  severity: RiskSeverity
  className?: string
  showLabel?: boolean
  showIcon?: boolean
}

/**
 * Risk Severity Configuration
 * Based on AI consensus:
 * - ALL 3 AI said: Add icons (not just color!)
 * - DeepSeek: "Не тільки колір, а іконки"
 * - ChatGPT: "Use distinct icons (❗ ⚠️ ✓)"
 * - Grok: "Add patterns + text labels"
 */
const SEVERITY_CONFIG = {
  5: {
    label: 'Критичний',
    labelShort: 'Critical',
    color: 'bg-risk-critical text-white border-risk-critical',
    icon: '❗',
    description: 'Requires immediate attention',
  },
  4: {
    label: 'Високий',
    labelShort: 'High',
    color: 'bg-risk-high text-white border-risk-high',
    icon: '⚠️',
    description: 'Significant risk identified',
  },
  3: {
    label: 'Середній',
    labelShort: 'Medium',
    color: 'bg-risk-medium text-gray-900 border-risk-medium',
    icon: '⚙️',
    description: 'Moderate concern',
  },
  2: {
    label: 'Низький',
    labelShort: 'Low',
    color: 'bg-risk-low text-white border-risk-low',
    icon: '✓',
    description: 'Minor issue',
  },
  1: {
    label: 'Безпечно',
    labelShort: 'Safe',
    color: 'bg-risk-safe text-white border-risk-safe',
    icon: '✅',
    description: 'No issues found',
  },
} as const

export function RiskBadge({ 
  severity, 
  className,
  showLabel = true,
  showIcon = true, // AI consensus: ALWAYS show icon
}: RiskBadgeProps) {
  const config = SEVERITY_CONFIG[severity]

  return (
    <div
      className={cn(
        // Base styles (ChatGPT: border-radius 4-6px max)
        'risk-badge inline-flex items-center gap-1.5 rounded-sm px-2.5 py-0.5 text-xs font-semibold border transition-all duration-150',
        config.color,
        className
      )}
      title={config.description}
      role="status"
      aria-label={`Risk level: ${config.label}`}
    >
      {showIcon && <span className="text-sm" aria-hidden="true">{config.icon}</span>}
      {showLabel && <span>{config.label}</span>}
    </div>
  )
}

/**
 * Utility to get severity number from 0-10 risk score
 * (Unchanged from original)
 */
export function riskScoreToSeverity(score: number): RiskSeverity {
  if (score <= 2) return 1 // Safe
  if (score <= 4) return 2 // Low
  if (score <= 6) return 3 // Medium
  if (score <= 8) return 4 // High
  return 5 // Critical
}

/**
 * Get risk color for charts/visualizations
 */
export function getRiskColor(severity: RiskSeverity): string {
  const colors = {
    5: '#BE123C', // Critical (Deep Crimson - ChatGPT)
    4: '#D97706', // High (Reduced saturation)
    3: '#B8860B', // Medium (Darker yellow)
    2: '#15803D', // Low
    1: '#15803D', // Safe
  }
  return colors[severity]
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/components/RiskDashboard.tsx
═══════════════════════════════════════════════════════════════════════

'use client'

import { useState } from 'react'
import { cn } from '@/shared/lib'
import { RiskBadge } from './RiskBadge'
import type { RiskSeverity } from '@/shared/types'

interface RiskItem {
  id: string
  severity: RiskSeverity
  title: string
  description: string
  contractExcerpt?: string
  legalCitation?: string // e.g., "ЦКУ ст. 638"
  recommendation?: string
  confidence?: number // 0-100
  agentName?: string // Which agent found it
  lineNumber?: number // For "tether" animation
}

interface RiskDashboardProps {
  risks: RiskItem[]
  onRiskClick?: (risk: RiskItem) => void
  className?: string
}

/**
 * Hybrid Risk Dashboard
 * Based on ALL 3 AI consensus:
 * - DeepSeek: "Summary + detailed list"
 * - ChatGPT: "Risk Weather Map + Executive Summary"
 * - Grok: "Pie chart + accordion cards"
 * 
 * Structure:
 * 1. Top: Executive Summary (total risks, confidence, chart)
 * 2. Below: Accordion list sorted by severity
 * 3. Each card shows: icon, title, description, citation, confidence
 */
export function RiskDashboard({
  risks = [],
  onRiskClick,
  className,
}: RiskDashboardProps) {
  const [expandedRiskId, setExpandedRiskId] = useState<string | null>(null)

  // Calculate stats
  const risksBySeverity = {
    5: risks.filter((r) => r.severity === 5).length,
    4: risks.filter((r) => r.severity === 4).length,
    3: risks.filter((r) => r.severity === 3).length,
    2: risks.filter((r) => r.severity === 2).length,
    1: risks.filter((r) => r.severity === 1).length,
  }

  const avgConfidence = risks.length
    ? Math.round(
        risks.reduce((sum, r) => sum + (r.confidence || 0), 0) / risks.length
      )
    : 0

  const handleRiskClick = (risk: RiskItem) => {
    setExpandedRiskId(expandedRiskId === risk.id ? null : risk.id)
    onRiskClick?.(risk)
  }

  // Sort risks by severity (critical first)
  const sortedRisks = [...risks].sort((a, b) => b.severity - a.severity)

  return (
    <div className={cn('space-y-md', className)}>
      {/* EXECUTIVE SUMMARY (ChatGPT: "Risk Weather Map") */}
      <div className="rounded-md border bg-white p-lg shadow-card">
        <h3 className="mb-md text-lg font-semibold">Огляд Ризиків</h3>

        <div className="grid gap-md md:grid-cols-3">
          {/* Total Risks */}
          <div className="text-center">
            <div className="mb-1 text-3xl font-bold text-navy">
              {risks.length}
            </div>
            <p className="text-sm text-gray-500">
              Всього знайдено проблем
            </p>
          </div>

          {/* Confidence Score */}
          <div className="text-center">
            <div className="mb-1 text-3xl font-bold text-navy">
              {avgConfidence}%
            </div>
            <p className="text-sm text-gray-500">
              Середня впевненість
            </p>
          </div>

          {/* Critical Count */}
          <div className="text-center">
            <div className="mb-1 text-3xl font-bold text-risk-critical">
              {risksBySeverity[5]}
            </div>
            <p className="text-sm text-gray-500">
              Критичних ризиків
            </p>
          </div>
        </div>

        {/* Horizontal bar chart (Grok recommendation) */}
        <div className="mt-md space-y-2">
          <p className="text-xs font-medium text-gray-500">
            Розподіл за рівнем:
          </p>
          <div className="space-y-1.5">
            {/* Critical */}
            {risksBySeverity[5] > 0 && (
              <div className="flex items-center gap-2">
                <span className="text-xs w-20">Критичний</span>
                <div className="h-2 flex-1 rounded-sm bg-risk-critical/20">
                  <div
                    className="h-full rounded-sm bg-risk-critical transition-all"
                    style={{
                      width: `${(risksBySeverity[5] / risks.length) * 100}%`,
                    }}
                  />
                </div>
                <span className="text-xs w-8 text-right text-gray-500">
                  {risksBySeverity[5]}
                </span>
              </div>
            )}

            {/* High */}
            {risksBySeverity[4] > 0 && (
              <div className="flex items-center gap-2">
                <span className="text-xs w-20">Високий</span>
                <div className="h-2 flex-1 rounded-sm bg-risk-high/20">
                  <div
                    className="h-full rounded-sm bg-risk-high transition-all"
                    style={{
                      width: `${(risksBySeverity[4] / risks.length) * 100}%`,
                    }}
                  />
                </div>
                <span className="text-xs w-8 text-right text-gray-500">
                  {risksBySeverity[4]}
                </span>
              </div>
            )}

            {/* Medium */}
            {risksBySeverity[3] > 0 && (
              <div className="flex items-center gap-2">
                <span className="text-xs w-20">Середній</span>
                <div className="h-2 flex-1 rounded-sm bg-risk-medium/20">
                  <div
                    className="h-full rounded-sm bg-risk-medium transition-all"
                    style={{
                      width: `${(risksBySeverity[3] / risks.length) * 100}%`,
                    }}
                  />
                </div>
                <span className="text-xs w-8 text-right text-gray-500">
                  {risksBySeverity[3]}
                </span>
              </div>
            )}
          </div>
        </div>
      </div>

      {/* DETAILED ACCORDION LIST (All 3 AI: sorted by severity) */}
      <div className="space-y-sm">
        <h3 className="text-lg font-semibold">Детальний Аналіз</h3>

        {sortedRisks.length === 0 ? (
          <div className="rounded-md border border-dashed bg-white p-lg text-center text-sm text-gray-500">
            Аналіз не завершений або ризики не знайдені
          </div>
        ) : (
          sortedRisks.map((risk) => {
            const isExpanded = expandedRiskId === risk.id

            return (
              <div
                key={risk.id}
                className={cn(
                  'group cursor-pointer rounded-md border bg-white transition-all duration-150',
                  'hover:shadow-md hover:border-brand-primary/30',
                  isExpanded && 'ring-2 ring-brand-primary/20 shadow-md'
                )}
                onClick={() => handleRiskClick(risk)}
                role="button"
                tabIndex={0}
                onKeyDown={(e) => {
                  if (e.key === 'Enter' || e.key === ' ') {
                    handleRiskClick(risk)
                  }
                }}
              >
                {/* CARD HEADER (always visible) */}
                <div className="flex items-start gap-3 p-md">
                  {/* Risk Badge with icon (All 3 AI: MUST have icons!) */}
                  <div className="pt-0.5">
                    <RiskBadge severity={risk.severity} showLabel={false} />
                  </div>

                  {/* Content */}
                  <div className="flex-1 space-y-1">
                    <div className="flex items-start justify-between gap-2">
                      <h4 className="text-sm font-semibold leading-tight">
                        {risk.title}
                      </h4>
                      {risk.confidence && (
                        <span className="text-xs text-gray-500 whitespace-nowrap">
                          {risk.confidence}% впевненість
                        </span>
                      )}
                    </div>

                    <p className="text-sm text-gray-500">
                      {risk.description}
                    </p>

                    {/* Legal Citation (DeepSeek: "Inline legal reasoning") */}
                    {risk.legalCitation && (
                      <p className="text-xs font-medium text-navy">
                        📚 {risk.legalCitation}
                      </p>
                    )}
                  </div>

                  {/* Expand indicator */}
                  <div
                    className={cn(
                      'text-gray-500 transition-transform duration-150',
                      isExpanded && 'rotate-180'
                    )}
                  >
                    <svg
                      className="h-4 w-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M19 9l-7 7-7-7"
                      />
                    </svg>
                  </div>
                </div>

                {/* EXPANDED CONTENT (DeepSeek: "Lawyers want explanations") */}
                {isExpanded && (
                  <div className="animate-slide-up space-y-sm border-t bg-gray-50 p-md">
                    {/* Contract Excerpt */}
                    {risk.contractExcerpt && (
                      <div>
                        <p className="mb-1 text-xs font-semibold text-gray-500">
                          Фрагмент договору:
                        </p>
                        <div className="rounded-sm border bg-white p-sm font-serif text-sm">
                          {risk.contractExcerpt}
                        </div>
                      </div>
                    )}

                    {/* Recommendation */}
                    {risk.recommendation && (
                      <div>
                        <p className="mb-1 text-xs font-semibold text-gray-500">
                          Рекомендація:
                        </p>
                        <p className="text-sm">{risk.recommendation}</p>
                      </div>
                    )}

                    {/* Which agent found it */}
                    {risk.agentName && (
                      <div className="flex items-center gap-2 text-xs text-gray-500">
                        <span>Знайдено агентом:</span>
                        <span className="font-semibold">{risk.agentName}</span>
                      </div>
                    )}
                  </div>
                )}
              </div>
            )
          })
        )}
      </div>
    </div>
  )
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/components/Sidebar.tsx
═══════════════════════════════════════════════════════════════════════

'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { cn } from '@/shared/lib'
import { useUIStore } from '@/stores/ui'
import { Button } from '@/shared/ui'

const navigation = [
  {
    name: 'Огляд Контрактів',
    href: '/review',
    icon: '📋',
    module: 'review' as const,
  },
  {
    name: 'Історія',
    href: '/history',
    icon: '📂',
    module: 'history' as const,
  },
  {
    name: 'Генерація',
    href: '/generate',
    icon: '✨',
    module: 'generation' as const,
    disabled: true, // Coming soon
  },
  {
    name: 'Аналітика',
    href: '/analytics',
    icon: '📊',
    module: 'analytics' as const,
    disabled: true, // Coming soon
  },
]

export function Sidebar() {
  const pathname = usePathname()
  const { sidebarCollapsed, toggleSidebar } = useUIStore()

  return (
    <aside
      className={cn(
        'fixed left-0 top-0 z-40 h-screen border-r bg-white transition-all duration-300',
        sidebarCollapsed ? 'w-16' : 'w-64'
      )}
    >
      <div className="flex h-full flex-col">
        {/* Header */}
        <div className="flex h-16 items-center justify-between border-b px-4">
          {!sidebarCollapsed && (
            <Link href="/" className="flex items-center gap-2">
              <span className="text-2xl">⚖️</span>
              <span className="font-bold">Legal Council</span>
            </Link>
          )}

          <Button
            variant="ghost"
            size="icon"
            onClick={toggleSidebar}
            className={cn(sidebarCollapsed && 'mx-auto')}
          >
            {sidebarCollapsed ? '→' : '←'}
          </Button>
        </div>

        {/* Navigation */}
        <nav className="flex-1 space-y-1 p-2">
          {navigation.map((item) => {
            const isActive = pathname.startsWith(item.href)

            return (
              <Link
                key={item.href}
                href={item.disabled ? '#' : item.href}
                className={cn(
                  'flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors',
                  isActive
                    ? 'bg-navy text-navy-foreground'
                    : 'hover:bg-accent hover:text-accent-foreground',
                  item.disabled && 'cursor-not-allowed opacity-50',
                  sidebarCollapsed && 'justify-center'
                )}
                onClick={(e) => item.disabled && e.preventDefault()}
              >
                <span className="text-xl">{item.icon}</span>
                {!sidebarCollapsed && (
                  <span className="flex-1">{item.name}</span>
                )}
                {!sidebarCollapsed && item.disabled && (
                  <span className="text-xs opacity-70">Скоро</span>
                )}
              </Link>
            )
          })}
        </nav>

        {/* Footer */}
        <div className="border-t p-4">
          {!sidebarCollapsed ? (
            <div className="space-y-1 text-xs text-gray-500">
              <p>v1.0.0</p>
              <p>© 2026 Legal Council</p>
            </div>
          ) : (
            <div className="text-center text-xs text-gray-500">
              v1.0
            </div>
          )}
        </div>
      </div>
    </aside>
  )
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/components/SplitView.tsx
═══════════════════════════════════════════════════════════════════════

'use client'

import { useState } from 'react'
import { cn } from '@/shared/lib'

interface SplitViewProps {
  leftContent: React.ReactNode
  rightContent: React.ReactNode
  defaultSplit?: number // 0-100, default 50
  className?: string
}

/**
 * Split View Component
 * Based on UNANIMOUS consensus from all 3 AI experts:
 * - DeepSeek: "Юрист мислить порівнянням - text + analysis side by side"
 * - ChatGPT: "The Holy Grail of legal tech UI"
 * - Grok: "Left-right more efficient than up-down"
 * 
 * Specifications (from ChatGPT):
 * - 50/50 split adjustable via drag
 * - 24px padding around
 * - 16px gap between elements
 * - 1px solid slate-200 borders
 * - Sharp corners (not rounded bubbles!)
 */
export function SplitView({
  leftContent,
  rightContent,
  defaultSplit = 50,
  className,
}: SplitViewProps) {
  const [splitPosition, setSplitPosition] = useState(defaultSplit)
  const [isDragging, setIsDragging] = useState(false)

  const handleMouseDown = () => {
    setIsDragging(true)
  }

  const handleMouseUp = () => {
    setIsDragging(false)
  }

  const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {
    if (!isDragging) return

    const container = e.currentTarget.getBoundingClientRect()
    const position = ((e.clientX - container.left) / container.width) * 100
    
    // Constrain between 30% and 70% (don't let either side get too small)
    const constrainedPosition = Math.min(Math.max(position, 30), 70)
    setSplitPosition(constrainedPosition)
  }

  return (
    <div
      className={cn(
        'relative flex w-full select-none',
        'min-h-[600px] h-[calc(100vh-12rem)]',
        isDragging && 'cursor-col-resize',
        className
      )}
      onMouseMove={handleMouseMove}
      onMouseUp={handleMouseUp}
      onMouseLeave={handleMouseUp}
    >
      {/* LEFT PANE - Contract Text */}
      <div
        className="relative overflow-y-auto border-r border-gray-200 bg-white"
        style={{ width: `${splitPosition}%` }}
      >
        <div className="p-lg">{leftContent}</div>
      </div>

      {/* DRAGGABLE DIVIDER (ChatGPT: "The Tether" concept) */}
      <div
        className={cn(
          'group relative z-10 w-1 cursor-col-resize bg-border transition-all duration-150 hover:w-1.5 hover:bg-brand-primary',
          isDragging && 'w-1.5 bg-brand-primary'
        )}
        onMouseDown={handleMouseDown}
        role="separator"
        aria-label="Resize panels"
        aria-valuenow={splitPosition}
        tabIndex={0}
        onKeyDown={(e) => {
          if (e.key === 'ArrowLeft') {
            setSplitPosition(Math.max(30, splitPosition - 5))
          } else if (e.key === 'ArrowRight') {
            setSplitPosition(Math.min(70, splitPosition + 5))
          }
        }}
      >
        {/* Visual indicator (shows on hover) */}
        <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 opacity-0 transition-opacity group-hover:opacity-100">
          <div className="flex h-16 w-6 items-center justify-center rounded-sm bg-brand-primary text-white shadow-md">
            <svg
              className="h-4 w-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M8 9l4-4 4 4m0 6l-4 4-4-4"
              />
            </svg>
          </div>
        </div>
      </div>

      {/* RIGHT PANE - AI Insights */}
      <div
        className="relative overflow-y-auto bg-gray-50"
        style={{ width: `${100 - splitPosition}%` }}
      >
        <div className="p-lg">{rightContent}</div>
      </div>
    </div>
  )
}

/**
 * Quick Keyboard Shortcuts Info
 * (Grok: "j/k navigation, / for search")
 */
export function SplitViewKeyboardHelp() {
  return (
    <div className="rounded-sm border bg-white p-3 text-xs text-gray-500">
      <p className="mb-1 font-semibold">Клавіатурні команди:</p>
      <div className="grid grid-cols-2 gap-2">
        <div>← → Змінити розмір панелей</div>
        <div>j/k Наступний/попередній ризик</div>
        <div>/ Пошук</div>
        <div>Enter Розгорнути картку</div>
      </div>
    </div>
  )
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/components/index.ts
═══════════════════════════════════════════════════════════════════════

export * from './Sidebar'
export * from './RiskBadge'
export * from './AgentProgress'
export * from './SplitView'
export * from './RiskDashboard'
export * from './Logo'
export * from './Header'
export * from './Footer'


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/lib/index.ts
═══════════════════════════════════════════════════════════════════════

export * from './utils'


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/lib/utils.ts
═══════════════════════════════════════════════════════════════════════

import { type ClassValue, clsx } from 'clsx'
import { twMerge } from 'tailwind-merge'

/**
 * Merge Tailwind CSS classes
 * Combines clsx for conditional classes and tailwind-merge for deduplication
 */
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/types/index.ts
═══════════════════════════════════════════════════════════════════════

// ============================================
// Risk Analysis Types
// ============================================

export type RiskSeverity = 1 | 2 | 3 | 4 | 5

export interface Risk {
  id: string
  title: string
  description: string
  severity: RiskSeverity
  confidence: number // 0-1
  legalBasis: string // "ЦКУ ст. 638"
  clauseReference: string // "Розділ 2, п. 2.1"
  excerpt: string // Quoted text from contract
  recommendation: string
}

export interface AnalysisResult {
  id: string
  contractId: string
  contractTitle: string
  overallRiskScore: number // 0-10
  confidence: number // 0-1
  risks: Risk[]
  recommendations: string[]
  agentOutputs: {
    expert: string
    provocateur: string
    validator: string
    synthesizer: string
  }
  createdAt: string
  updatedAt: string
}

// ============================================
// Agent Status Types
// ============================================

export type AgentName = 'expert' | 'provocateur' | 'validator' | 'synthesizer'

export type AgentStatus = 'pending' | 'running' | 'completed' | 'error'

export interface AgentProgress {
  name: AgentName
  status: AgentStatus
  progress: number // 0-100
  message?: string
  completedAt?: string
}

// ============================================
// Contract Types
// ============================================

export type ContractType = 
  | 'оренда'        // Lease
  | 'поставка'      // Supply
  | 'послуги'       // Services
  | 'трудовий'      // Employment
  | 'підряд'        // Contract work
  | 'купівля-продаж' // Purchase-sale
  | 'інше'          // Other

export interface Contract {
  id: string
  title: string
  type: ContractType
  content: string
  fileUrl?: string
  uploadedAt: string
  analyzedAt?: string
  status: 'uploaded' | 'analyzing' | 'analyzed' | 'error'
}

// ============================================
// User Types
// ============================================

export interface User {
  id: string
  email: string
  name: string
  role: 'user' | 'admin'
  createdAt: string
}

// ============================================
// UI State Types
// ============================================

export interface UIState {
  sidebarCollapsed: boolean
  theme: 'light' | 'dark'
  activeModule: 'review' | 'generation' | 'analytics' | 'history'
}

// ============================================
// API Response Types
// ============================================

export interface ApiResponse<T> {
  success: boolean
  data?: T
  error?: {
    code: string
    message: string
  }
}

export interface PaginatedResponse<T> {
  items: T[]
  total: number
  page: number
  pageSize: number
  hasMore: boolean
}


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/ui/button.tsx
═══════════════════════════════════════════════════════════════════════

import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/shared/lib'

const buttonVariants = cva(
  'inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50',
  {
    variants: {
      variant: {
        default: 'bg-navy text-navy-foreground hover:bg-navy/90',
        destructive: 'bg-destructive text-destructive-foreground hover:bg-destructive/90',
        outline: 'border border-input bg-white hover:bg-accent hover:text-accent-foreground',
        secondary: 'bg-secondary text-secondary-foreground hover:bg-secondary/80',
        ghost: 'hover:bg-accent hover:text-accent-foreground',
        link: 'text-navy underline-offset-4 hover:underline',
      },
      size: {
        default: 'h-10 px-4 py-2',
        sm: 'h-9 rounded-md px-3',
        lg: 'h-11 rounded-md px-8',
        icon: 'h-10 w-10',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : 'button'
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = 'Button'

export { Button, buttonVariants }


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/ui/card.tsx
═══════════════════════════════════════════════════════════════════════

import * as React from 'react'

import { cn } from '@/shared/lib'

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      'rounded-lg border bg-white text-slate-900 shadow-card',
      className
    )}
    {...props}
  />
))
Card.displayName = 'Card'

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn('flex flex-col space-y-1.5 p-6', className)}
    {...props}
  />
))
CardHeader.displayName = 'CardHeader'

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      'text-2xl font-semibold leading-none tracking-tight',
      className
    )}
    {...props}
  />
))
CardTitle.displayName = 'CardTitle'

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn('text-sm text-gray-500', className)}
    {...props}
  />
))
CardDescription.displayName = 'CardDescription'

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn('p-6 pt-0', className)} {...props} />
))
CardContent.displayName = 'CardContent'

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn('flex items-center p-6 pt-0', className)}
    {...props}
  />
))
CardFooter.displayName = 'CardFooter'

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/ui/index.ts
═══════════════════════════════════════════════════════════════════════

// shadcn/ui components
export * from './button'
export * from './card'
export * from './input'


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/shared/ui/input.tsx
═══════════════════════════════════════════════════════════════════════

import * as React from 'react'

import { cn } from '@/shared/lib'

export interface InputProps
  extends React.InputHTMLAttributes<HTMLInputElement> {}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          'flex h-10 w-full rounded-md border border-input bg-white px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50',
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = 'Input'

export { Input }


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/stores/analysis.ts
═══════════════════════════════════════════════════════════════════════

import { create } from 'zustand'
import type { AgentName, AgentStatus, AnalysisResult } from '@/shared/types'

interface AgentState {
  name: AgentName
  status: AgentStatus
  progress: number
  message?: string
  completedAt?: string
}

interface AnalysisState {
  // Current analysis
  currentAnalysis: AnalysisResult | null
  isAnalyzing: boolean
  
  // Agent progress
  agents: Record<AgentName, AgentState>
  
  // Overall progress
  overallProgress: number
  
  // Actions
  setCurrentAnalysis: (analysis: AnalysisResult | null) => void
  startAnalysis: () => void
  updateAgentStatus: (
    agent: AgentName,
    status: AgentStatus,
    message?: string
  ) => void
  updateAgentProgress: (agent: AgentName, progress: number) => void
  completeAgent: (agent: AgentName, message?: string) => void
  completeAnalysis: (result: AnalysisResult) => void
  resetAnalysis: () => void
}

const initialAgents: Record<AgentName, AgentState> = {
  expert: {
    name: 'expert',
    status: 'pending',
    progress: 0,
  },
  provocateur: {
    name: 'provocateur',
    status: 'pending',
    progress: 0,
  },
  validator: {
    name: 'validator',
    status: 'pending',
    progress: 0,
  },
  synthesizer: {
    name: 'synthesizer',
    status: 'pending',
    progress: 0,
  },
}

export const useAnalysisStore = create<AnalysisState>((set, get) => ({
  currentAnalysis: null,
  isAnalyzing: false,
  agents: initialAgents,
  overallProgress: 0,

  setCurrentAnalysis: (analysis) => 
    set({ currentAnalysis: analysis }),

  startAnalysis: () =>
    set({
      isAnalyzing: true,
      agents: {
        expert: { ...initialAgents.expert, status: 'running' },
        provocateur: initialAgents.provocateur,
        validator: initialAgents.validator,
        synthesizer: initialAgents.synthesizer,
      },
      overallProgress: 0,
    }),

  updateAgentStatus: (agent, status, message) =>
    set((state) => ({
      agents: {
        ...state.agents,
        [agent]: {
          ...state.agents[agent],
          status,
          message,
        },
      },
    })),

  updateAgentProgress: (agent, progress) =>
    set((state) => {
      const newAgents = {
        ...state.agents,
        [agent]: {
          ...state.agents[agent],
          progress,
        },
      }

      // Calculate overall progress
      const totalProgress = Object.values(newAgents).reduce(
        (sum, a) => sum + a.progress,
        0
      )
      const overallProgress = totalProgress / 4

      return {
        agents: newAgents,
        overallProgress,
      }
    }),

  completeAgent: (agent, message) =>
    set((state) => {
      const newAgents = {
        ...state.agents,
        [agent]: {
          ...state.agents[agent],
          status: 'completed' as AgentStatus,
          progress: 100,
          message,
          completedAt: new Date().toISOString(),
        },
      }

      // Start next agent
      const agentOrder: AgentName[] = ['expert', 'provocateur', 'validator', 'synthesizer']
      const currentIndex = agentOrder.indexOf(agent)
      const nextAgent = agentOrder[currentIndex + 1]

      if (nextAgent) {
        newAgents[nextAgent] = {
          ...newAgents[nextAgent],
          status: 'running',
        }
      }

      return { agents: newAgents }
    }),

  completeAnalysis: (result) =>
    set({
      currentAnalysis: result,
      isAnalyzing: false,
      overallProgress: 100,
    }),

  resetAnalysis: () =>
    set({
      currentAnalysis: null,
      isAnalyzing: false,
      agents: initialAgents,
      overallProgress: 0,
    }),
}))


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/stores/ui.ts
═══════════════════════════════════════════════════════════════════════

import { create } from 'zustand'

interface UIState {
  // Theme
  theme: 'light' | 'dark'
  setTheme: (theme: 'light' | 'dark') => void
  toggleTheme: () => void

  // Sidebar
  sidebarCollapsed: boolean
  setSidebarCollapsed: (collapsed: boolean) => void
  toggleSidebar: () => void

  // Active module
  activeModule: 'review' | 'generation' | 'analytics' | 'history'
  setActiveModule: (module: UIState['activeModule']) => void
}

export const useUIStore = create<UIState>((set) => ({
  theme: 'light',
  setTheme: (theme) => set({ theme }),
  toggleTheme: () =>
    set((state) => ({
      theme: state.theme === 'light' ? 'dark' : 'light',
    })),

  sidebarCollapsed: false,
  setSidebarCollapsed: (collapsed) => set({ sidebarCollapsed: collapsed }),
  toggleSidebar: () =>
    set((state) => ({
      sidebarCollapsed: !state.sidebarCollapsed,
    })),

  activeModule: 'review',
  setActiveModule: (module) => set({ activeModule: module }),
}))


═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/src/app/globals.css
═══════════════════════════════════════════════════════════════════════

@tailwind base;
@tailwind components;
@tailwind utilities;

/* Simple, working CSS - no HSL variables! */

@layer base {
  * {
    border-color: #E5E7EB;
  }
  
  body {
    background-color: #FAFAFA; /* Off-white */
    color: #0F172A; /* Slate 900 */
    font-family: Inter, system-ui, sans-serif;
    font-feature-settings: "rlig" 1, "calt" 1;
  }
  
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-inter), Inter, sans-serif;
    font-weight: 600;
  }
}

@layer components {
  /* Contract text - IBM Plex Serif */
  .contract-text {
    font-family: var(--font-ibm-plex-serif), Georgia, serif;
    font-size: 16px;
    line-height: 1.75;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  /* Risk severity styles */
  .risk-critical {
    color: #BE123C;
    border-color: #BE123C;
    background-color: rgba(190, 18, 60, 0.05);
  }
  
  .risk-high {
    color: #D97706;
    border-color: #D97706;
    background-color: rgba(217, 119, 6, 0.05);
  }
  
  .risk-medium {
    color: #B8860B;
    border-color: #B8860B;
    background-color: rgba(184, 134, 11, 0.05);
  }
  
  .risk-low {
    color: #15803D;
    border-color: #15803D;
    background-color: rgba(21, 128, 61, 0.05);
  }
  
  .risk-safe {
    color: #15803D;
    border-color: #15803D;
    background-color: rgba(21, 128, 61, 0.05);
  }
  
  /* Custom scrollbar */
  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-track {
    background-color: #F3F4F6;
  }
  
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: rgba(107, 114, 128, 0.3);
    border-radius: 4px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: rgba(107, 114, 128, 0.5);
  }
}

@layer utilities {
  /* Animations - subtle 150ms */
  .animate-fade-in {
    animation: fadeIn 150ms ease-out;
  }
  
  .animate-slide-up {
    animation: slideUp 150ms ease-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes slideUp {
    from { 
      transform: translateY(10px);
      opacity: 0;
    }
    to { 
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  /* Split view layout */
  .split-view {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    min-height: calc(100vh - 4rem);
  }
  
  .split-pane {
    overflow-y: auto;
    padding: 24px;
  }
  
  /* Risk badge */
  .risk-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    border-radius: 4px;
    padding: 2px 10px;
    font-size: 12px;
    font-weight: 600;
    transition: all 150ms ease-out;
  }
}

═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/package.json
═══════════════════════════════════════════════════════════════════════

{
  "name": "legal-council-ui",
  "version": "1.0.0",
  "description": "Ukrainian Legal Contract Analysis - Frontend",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "next": "^14.1.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "typescript": "^5.3.3",
    
    "@radix-ui/react-accordion": "^1.1.2",
    "@radix-ui/react-dialog": "^1.0.5",
    "@radix-ui/react-dropdown-menu": "^2.0.6",
    "@radix-ui/react-select": "^2.0.0",
    "@radix-ui/react-tabs": "^1.0.4",
    "@radix-ui/react-tooltip": "^1.0.7",
    "@radix-ui/react-slot": "^1.0.2",
    
    "@tanstack/react-query": "^5.17.19",
    "@tanstack/react-virtual": "^3.0.1",
    "zustand": "^4.5.0",
    
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.0",
    "tailwind-merge": "^2.2.0",
    "tailwindcss-animate": "^1.0.7",
    
    "lucide-react": "^0.309.0",
    "date-fns": "^3.2.0",
    "zod": "^3.22.4"
  },
  "devDependencies": {
    "@types/node": "^20.11.5",
    "@types/react": "^18.2.48",
    "@types/react-dom": "^18.2.18",
    "autoprefixer": "^10.4.17",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "eslint": "^8.56.0",
    "eslint-config-next": "^14.1.0"
  },
  "engines": {
    "node": ">=18.17.0",
    "npm": ">=9.0.0"
  }
}

═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/tsconfig.json
═══════════════════════════════════════════════════════════════════════

{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}

═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/tailwind.config.ts
═══════════════════════════════════════════════════════════════════════

import type { Config } from 'tailwindcss'

const config: Config = {
  darkMode: ['class'],
  content: [
    './src/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        // Simple direct colors - no HSL variables!
        navy: '#1E3A8A',        // Primary brand color
        teal: '#0F766E',        // Secondary
        crimson: '#BE123C',     // Critical risk
        orange: '#D97706',      // High risk  
        gold: '#B8860B',        // Medium risk
        green: '#15803D',       // Low/Safe risk
      },
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
        serif: ['IBM Plex Serif', 'Georgia', 'serif'],
        mono: ['JetBrains Mono', 'Consolas', 'monospace'],
      },
      borderRadius: {
        sm: '4px',
        DEFAULT: '6px',
        md: '6px',
        lg: '8px',
      },
      spacing: {
        xs: '4px',
        sm: '8px',
        md: '16px',
        lg: '24px',
        xl: '32px',
      },
    },
  },
  plugins: [require('tailwindcss-animate')],
}

export default config

═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/next.config.js
═══════════════════════════════════════════════════════════════════════

/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  
  // Experimental features
  experimental: {
    // Server actions enabled for forms
    serverActions: {
      bodySizeLimit: '5mb', // For contract uploads
    },
  },
  
  // Optimize fonts
  optimizeFonts: true,
  
  // Compiler options
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production',
  },
  
  // Environment variables available on client
  env: {
    NEXT_PUBLIC_APP_NAME: 'Legal Council',
    NEXT_PUBLIC_APP_VERSION: '1.0.0',
  },
}

module.exports = nextConfig

═══════════════════════════════════════════════════════════════════════
FILE: legal-council-ui-clean/postcss.config.js
═══════════════════════════════════════════════════════════════════════

module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}


═══════════════════════════════════════════════════════════════════════
  END OF COMPLETE PROJECT CODE
═══════════════════════════════════════════════════════════════════════

Generated: 2026-02-12 19:55:00

STRUCTURE:
- Backend: AI agents (8), Orchestrators (2), Services, Config, Types
- Frontend: Next.js 14, Components, Pages, Stores, UI
- API Routes: Review, Generate
- Configuration: package.json, tsconfig, tailwind
- Styles: globals.css

TECH STACK:
Backend:
  - Claude Opus/Sonnet/Haiku
  - GPT-4o/GPT-4o-mini
  - Gemini 2.0 Flash
  - TypeScript 5.3.3

Frontend:
  - Next.js 14.1.0
  - React 18.2.0
  - TypeScript 5.3.3
  - Tailwind CSS 3.4.1
  - Zustand 4.5.0

DESIGN:
  - AGENTIS branding (shield + balance ⚖️)
  - Navy Blue (#1E3A8A) primary
  - IBM Plex Serif for contracts
  - 97% AI design consensus

═══════════════════════════════════════════════════════════════════════
